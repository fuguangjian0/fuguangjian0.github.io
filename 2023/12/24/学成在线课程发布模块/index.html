

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="fgj">
  <meta name="keywords" content="">
  
    <meta name="description" content="学成在线课程发布模块需求分析发布课程是一个确认操作，课程发布后学习者在网站搜索课程，查看课程详细信息，选课 支付 在线学习 课程编辑和发布的整体流程  审核课程内容，目的是使课程内容不违规，在课程发布之前运营方进行课程审核，审核通过才能发布 教学机构可以在课程发布前通过课程预览看到课程发布后的效果,哪里的课程信息存在问题, 及时修改 课程预览的效果图  教学机构确认课程ok, 提交审核, 平台对内">
<meta property="og:type" content="article">
<meta property="og:title" content="学成在线课程发布模块">
<meta property="og:url" content="http://example.com/2023/12/24/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E8%AF%BE%E7%A8%8B%E5%8F%91%E5%B8%83%E6%A8%A1%E5%9D%97/index.html">
<meta property="og:site_name" content="FGJ">
<meta property="og:description" content="学成在线课程发布模块需求分析发布课程是一个确认操作，课程发布后学习者在网站搜索课程，查看课程详细信息，选课 支付 在线学习 课程编辑和发布的整体流程  审核课程内容，目的是使课程内容不违规，在课程发布之前运营方进行课程审核，审核通过才能发布 教学机构可以在课程发布前通过课程预览看到课程发布后的效果,哪里的课程信息存在问题, 及时修改 课程预览的效果图  教学机构确认课程ok, 提交审核, 平台对内">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221221251630.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221221621545.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221224432470.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221224525755.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221224638657.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221224715727.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221225053333.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221225413532.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221225500489.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221225618999.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221225618999.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221230039407.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221230201212.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221230241087.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222111252295.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222113325862.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222113252215.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222112512975.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222112654679.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222113358898.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222113710927.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222114301571.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222114455577.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222115146493.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222115525584.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222115551832.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222121854045.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222121937256.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222121959011.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222122116518.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222123045642.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222123032722.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222142713872.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222144054999.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222144108331.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222144753913.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222144842231.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222154648570.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222155053498.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222155234179.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222160402181.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222160425622.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222162212477.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222164446204.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222164512645.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222171902870.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222174434962.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222174527966.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222174822888.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222182532558.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222182543866.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222182554000.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222195927107.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222200203226.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222200957823.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222201145071.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222201534950.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222201934948.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222202110197.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222212746420.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222213153997.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222213043022.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222214407627.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222214431593.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222215148988.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222215910507.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222220637768.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222225745586.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222230754215.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222232839207.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222232921975.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223104855659.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223105105645.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223105809135.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223121811000.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223133359144.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223143958631.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223144135450.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223144251788.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223144319705.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223144537156.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223162502680.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223162706043.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223162719752.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223162749215.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223162857611.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223171201518.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223171216094.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223171716839.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223201446995.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223172615572.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223185858797.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223190340405.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223201536512.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223201732623.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223202126690.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223202401031.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223202518923.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223205424732.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223205446338.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223205549946.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223220342249.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223220451365.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223220540803.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223220635687.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223220721183.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223220743738.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223221152059.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223224918738.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223231154129.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223231240118.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231224131504339.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231224131757064.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231224132427572.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231224133743094.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231224133815260.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231224133839643.png">
<meta property="article:published_time" content="2023-12-24T05:51:13.000Z">
<meta property="article:modified_time" content="2023-12-24T05:52:24.089Z">
<meta property="article:author" content="fgj">
<meta property="article:tag" content="学成在线">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221221251630.png">
  
  
  
  <title>学成在线课程发布模块 - FGJ</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Home</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://fgj2.oss-cn-beijing.aliyuncs.com/ddd.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="学成在线课程发布模块"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-12-24 13:51" pubdate>
          2023年12月24日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          116k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          965 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">学成在线课程发布模块</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="学成在线"><a href="#学成在线" class="headerlink" title="学成在线"></a>学成在线</h1><h2 id="课程发布模块"><a href="#课程发布模块" class="headerlink" title="课程发布模块"></a>课程发布模块</h2><h3 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h3><p>发布课程是一个确认操作，课程发布后学习者在网站搜索课程，查看课程详细信息，选课 支付 在线学习</p>
<p>课程编辑和发布的整体流程</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221221251630.png" srcset="/img/loading.gif" lazyload alt="image-20231221221251630"></p>
<p>审核课程内容，目的是使课程内容不违规，在课程发布之前运营方进行课程审核，<code>审核通过</code>才能发布</p>
<p>教学机构可以在课程发布前通过课程<code>预览</code>看到课程发布后的效果,哪里的课程信息存在<code>问题</code>, 及时<code>修改</code></p>
<p>课程预览的效果图</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221221621545.png" srcset="/img/loading.gif" lazyload alt="image-20231221221621545"></p>
<p>教学机构确认课程ok, 提交审核, 平台对内容审核, 审核ok后发布课程成功</p>
<p>课程发布模块包括三个功能:</p>
<h3 id="业务流程"><a href="#业务流程" class="headerlink" title="业务流程"></a>业务流程</h3><h4 id="课程预览"><a href="#课程预览" class="headerlink" title="课程预览"></a><code>课程预览</code></h4><p>在课程管理中对机构课程进行预览</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221224432470.png" srcset="/img/loading.gif" lazyload alt="image-20231221224432470"></p>
<p>点击预览进入<code>课程详情首页</code></p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221224525755.png" srcset="/img/loading.gif" lazyload alt="image-20231221224525755"></p>
<p>点击课程目录, 查看课程计划是否ok</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221224638657.png" srcset="/img/loading.gif" lazyload alt="image-20231221224638657"></p>
<p>点击目录中的章节,查看视频播放是否ok</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221224715727.png" srcset="/img/loading.gif" lazyload alt="image-20231221224715727"> 	</p>
<h4 id="课程审核"><a href="#课程审核" class="headerlink" title="课程审核"></a>课程审核</h4><p>包括自动审核和人工审核,  程序自动审核内容完整性,  人工通过课程预览进行审核</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221225053333.png" srcset="/img/loading.gif" lazyload alt="image-20231221225053333" style="zoom:50%;" />

<p>1、首先查询待审核的记录。</p>
<p>2、课程审核</p>
<p>具体审核的过程与课程预览的过程类似，运营人员查看课程信息、课程视频等内容。</p>
<p>如果存在问题则审核不通过，并附上审核不通过的原因供教学机构人员查看。</p>
<p>如果课程内容没有违规信息且课程内容全面则审核通过。</p>
<p>课程审核通过后教学机构发布课程成功。</p>
<h4 id="课程发布"><a href="#课程发布" class="headerlink" title="课程发布"></a>课程发布</h4><ol>
<li>教学机构在课程管理中对审核通过的课程进行<code>发布</code></li>
</ol>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221225413532.png" srcset="/img/loading.gif" lazyload alt="image-20231221225413532"></p>
<ol start="2">
<li>课程发布后可通过课程搜索查询到课程信息，并查看课程的详细信息</li>
</ol>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221225500489.png" srcset="/img/loading.gif" lazyload alt="image-20231221225500489"></p>
<ol start="3">
<li>点击一个课程,进入课程详情页</li>
</ol>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221225618999.png" srcset="/img/loading.gif" lazyload alt="image-20231221225618999"></p>
<h3 id="课程预览-1"><a href="#课程预览-1" class="headerlink" title="课程预览"></a>课程预览</h3><h4 id="需求分析-1"><a href="#需求分析-1" class="headerlink" title="需求分析"></a>需求分析</h4><p>把课程的相关信息进行整合，在课程详情界面进行展示，通过课程预览页面查看信息是否存在问题</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221225618999.png" srcset="/img/loading.gif" lazyload alt="image-20231221225618999"></p>
<p>课程预览的数据来源: 需要查询4张表</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221230039407.png" srcset="/img/loading.gif" lazyload alt="image-20231221230039407"></p>
<p>点击”视频播放图片”打开视频播放页面，通过视频播放页面查看课程计划对应的视频是否存在问题</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221230201212.png" srcset="/img/loading.gif" lazyload alt="image-20231221230201212"></p>
<p>课程预览的效果与最终课程发布后查看到的效果是一致的，所以课程预览时会通过网站门户域名地址进行预览，下图显示了整个课程预览的<code>流程图</code></p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231221230241087.png" srcset="/img/loading.gif" lazyload alt="image-20231221230241087"></p>
<p>说明：</p>
<ol>
<li>点击课程预览，通过Nginx, 后台服务网关请求内容管理服务进行课程预览</li>
<li>内容管理服务查询课程信息进行整合,通过模块引擎技术在服务端渲染生成页面,返回给浏览器</li>
<li>通过课程预览页面点击马上学习打开视频播放页面</li>
<li>视频播放页面通过Nginx请求后台服务网关,查询课程信息展示课程计划目录,请求媒资服务查询课程计划绑定的视频文件地址,在线浏览播放视频</li>
</ol>
<h4 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h4><p>课程预览是把课程相关信息整合, 在课程预览界面展示, 课程预览界面和课程发布课程详情界面一致</p>
<p>项目采用模板引擎实现课程预览界面</p>
<p>什么是模板引擎?<br>jsp thymeleaf 都是模板引擎</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222111252295.png" srcset="/img/loading.gif" lazyload alt="image-20231222111252295"></p>
<ol>
<li>浏览器请求web服务器</li>
<li>服务器渲染页面,渲染过程向jsp填充数据</li>
<li>服务器将渲染生成的页面返回浏览器</li>
</ol>
<p>所以模板引擎就是: 模板+数据&#x3D;输出  jsp页面是模板, 页面嵌入的jsp标签是数据, 两者结合输出html网页</p>
<p>本项目采用Freemarker作为模板引擎技术</p>
<p>Freemarker官方地址：<a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/">http://freemarker.foofun.cn/</a></p>
<p>下面在<code>内容管理接口层</code>搭建Freemarker的运行环境并进行测试</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs XML"><span class="hljs-comment">&lt;!-- Spring Boot 对结果视图 Freemarker 集成 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>在nacos为内容管理接口层配置freemarker, 公用配置组新加一个freemarker-config-dev.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">freemarker:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">cache:</span> <span class="hljs-literal">false</span>   <span class="hljs-comment">#关闭模板缓存，方便测试</span><br>    <span class="hljs-attr">settings:</span><br>      <span class="hljs-attr">template_update_delay:</span> <span class="hljs-number">0</span><br>    <span class="hljs-attr">suffix:</span> <span class="hljs-string">.ftl</span>   <span class="hljs-comment">#页面模板后缀名</span><br>    <span class="hljs-attr">charset:</span> <span class="hljs-string">UTF-8</span><br>    <span class="hljs-attr">template-loader-path:</span> <span class="hljs-string">classpath:/templates/</span>   <span class="hljs-comment">#页面模板位置(默认为 classpath:/templates/)</span><br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-attr">add-mappings:</span> <span class="hljs-literal">false</span>   <span class="hljs-comment">#关闭项目中的静态资源映射(static、resources文件夹下的资源) </span><br></code></pre></td></tr></table></figure>

<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222113325862.png" srcset="/img/loading.gif" lazyload alt="image-20231222113325862"></p>
<p>本地项目yml加入公用配置</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222113252215.png" srcset="/img/loading.gif" lazyload alt="image-20231222113252215"></p>
<p>添加模板, 在resources 下创建 templates 目录, 添加test.ftl模板文件 </p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222112512975.png" srcset="/img/loading.gif" lazyload alt="image-20231222112512975"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Hello World!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>Hello $&#123;name&#125;!<br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>编写controller方法, 准备模型数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.content.api;<br><br><span class="hljs-keyword">import</span> org.bouncycastle.math.raw.Mod;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.ModelAndView;<br><br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span> freemarker测试</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022/9/15 19:20</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FreemarkerController</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/testfreemarker&quot;)</span><br>    <span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">ModelAndView</span> <span class="hljs-variable">modelAndView</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelAndView</span>();<br>        <span class="hljs-comment">//设置模型数据</span><br>        modelAndView.addObject(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;小明&quot;</span>);<br>        <span class="hljs-comment">//设置模板名称</span><br>        modelAndView.setViewName(<span class="hljs-string">&quot;test&quot;</span>);<br>        <span class="hljs-keyword">return</span> modelAndView;<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222112654679.png" srcset="/img/loading.gif" lazyload alt="image-20231222112654679"></p>
<p>启动内容管理接口工程，访问<a target="_blank" rel="noopener" href="http://localhost:63040/content/testfreemarker">http://localhost:63040/content/testfreemarker</a></p>
<p>屏幕输出：Hello 小明！</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222113358898.png" srcset="/img/loading.gif" lazyload alt="image-20231222113358898"></p>
<p>freemarker提供很多指令用于解析各种类型的数据模型</p>
<p>参考地址：<a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/ref_directives.html">http://freemarker.foofun.cn/ref_directives.html</a></p>
<h4 id="测试静态页面"><a href="#测试静态页面" class="headerlink" title="测试静态页面"></a>测试静态页面</h4><h5 id="部署网站门户"><a href="#部署网站门户" class="headerlink" title="部署网站门户"></a>部署网站门户</h5><p>在课程预览节目要加载css js 图片等内容, 这里不是nginx来访问这些静态资源</p>
<p>对于 springboot  服务的静态资源由 Nginx 去代理请求</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222113710927.png" srcset="/img/loading.gif" lazyload alt="image-20231222113710927" style="zoom:50%;" />

<ol>
<li>在本机安装nginx, 启动</li>
</ol>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222114301571.png" srcset="/img/loading.gif" lazyload alt="image-20231222114301571"></p>
<ol start="2">
<li>从课程资料目录获取xc-ui-pc-static-portal.zip 并解压。</li>
</ol>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222114455577.png" srcset="/img/loading.gif" lazyload alt="image-20231222114455577" style="zoom:50%;" />

<ol start="3">
<li><p>修改本机hosts文件，加入127.0.0.1 <a target="_blank" rel="noopener" href="http://www.51xuecheng.cn/">www.51xuecheng.cn</a> 51xuecheng.cn ucenter.51xuecheng.cn teacher.51xuecheng.cn file.51xuecheng.cn。</p>
<p>window10操作系统hosts文件在C:\Windows\System32\drivers\etc下</p>
<p>Centos7操作系统的hosts文件在&#x2F;etc目录下。</p>
<p>在hosts文件加入如下配置</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span> www.<span class="hljs-number">51</span>xuecheng.cn <span class="hljs-number">51</span>xuecheng.cn ucenter.<span class="hljs-number">51</span>xuecheng.cn teacher.<span class="hljs-number">51</span>xuecheng.cn file.<span class="hljs-number">51</span>xuecheng.cn<br></code></pre></td></tr></table></figure>



<p>注意: <code>关闭代理</code></p>
<p>推荐使用工具   <code>SwitchHosts</code> (管理员权限)</p>
</li>
</ol>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222115146493.png" srcset="/img/loading.gif" lazyload alt="image-20231222115146493" style="zoom:50%;" />

<ol start="4">
<li>在nginx-1.23.1目录中找到conf目录，配置目录下的nginx.conf文件,  配置内容如下，注意更改xc-ui-pc-static-portal目录的路径：</li>
</ol>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">server</span> &#123;<br>        <span class="hljs-keyword">listen</span>       <span class="hljs-number">80</span>;<br>        server_name  www<span class="hljs-number">.51</span>xuecheng.cn localhost;<br>        #rewrite ^(.*) https://$server_name$<span class="language-bash">1 permanent;</span><br><span class="language-bash">        <span class="hljs-comment">#charset koi8-r;</span></span><br><span class="language-bash">        ssi on;</span><br><span class="language-bash">        ssi_silent_errors on;</span><br><span class="language-bash">        <span class="hljs-comment">#access_log  logs/host.access.log  main;</span></span><br><span class="language-bash"></span><br><span class="language-bash">        location / &#123;</span><br><span class="language-bash">            <span class="hljs-built_in">alias</span>   D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal/;</span><br><span class="language-bash">            index  index.html index.htm;</span><br><span class="language-bash">        &#125;</span><br><span class="language-bash">        <span class="hljs-comment">#静态资源</span></span><br><span class="language-bash">        location /static/img/ &#123;  </span><br><span class="language-bash">                <span class="hljs-built_in">alias</span>  D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal/img/;</span><br><span class="language-bash">        &#125; </span><br><span class="language-bash">        location /static/css/ &#123;  </span><br><span class="language-bash">                <span class="hljs-built_in">alias</span>   D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal/css/;</span><br><span class="language-bash">        &#125; </span><br><span class="language-bash">        location /static/js/ &#123;  </span><br><span class="language-bash">                <span class="hljs-built_in">alias</span>   D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal/js/;</span><br><span class="language-bash">        &#125; </span><br><span class="language-bash">        location /static/plugins/ &#123;  </span><br><span class="language-bash">                <span class="hljs-built_in">alias</span>   D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal/plugins/;</span><br><span class="language-bash">                add_header Access-Control-Allow-Origin http://ucenter.51xuecheng.cn;  </span><br><span class="language-bash">                add_header Access-Control-Allow-Credentials <span class="hljs-literal">true</span>;  </span><br><span class="language-bash">                add_header Access-Control-Allow-Methods GET;</span><br><span class="language-bash">        &#125; </span><br><span class="language-bash">        location /plugins/ &#123;  </span><br><span class="language-bash">                <span class="hljs-built_in">alias</span>   D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal/plugins/;</span><br><span class="language-bash">        &#125; </span><br><span class="language-bash"></span><br><span class="language-bash"></span><br><span class="language-bash"></span><br><span class="language-bash">        <span class="hljs-comment">#error_page  404              /404.html;</span></span><br><span class="language-bash"></span><br><span class="language-bash">        <span class="hljs-comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="language-bash">        <span class="hljs-comment">#</span></span><br><span class="language-bash">        error_page   500 502 503 504  /50x.html;</span><br><span class="language-bash">        location = /50x.html &#123;</span><br><span class="language-bash">            root   html;</span><br><span class="language-bash">        &#125;</span><br><span class="language-bash"></span><br><span class="language-bash">        <span class="hljs-comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span></span><br><span class="language-bash">        <span class="hljs-comment">#</span></span><br><span class="language-bash">        <span class="hljs-comment">#location ~ \.php$ &#123;</span></span><br><span class="language-bash">        <span class="hljs-comment">#    proxy_pass   http://127.0.0.1;</span></span><br><span class="language-bash">        <span class="hljs-comment">#&#125;</span></span><br><span class="language-bash"></span><br><span class="language-bash">        <span class="hljs-comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class="language-bash">        <span class="hljs-comment">#</span></span><br><span class="language-bash">        <span class="hljs-comment">#location ~ \.php$ &#123;</span></span><br><span class="language-bash">        <span class="hljs-comment">#    root           html;</span></span><br><span class="language-bash">        <span class="hljs-comment">#    fastcgi_pass   127.0.0.1:9000;</span></span><br><span class="language-bash">        <span class="hljs-comment">#    fastcgi_index  index.php;</span></span><br><span class="language-bash">        <span class="hljs-comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span></span><br><span class="language-bash">        <span class="hljs-comment">#    include        fastcgi_params;</span></span><br><span class="language-bash">        <span class="hljs-comment">#&#125;</span></span><br><span class="language-bash"></span><br><span class="language-bash">        <span class="hljs-comment"># deny access to .htaccess files, if Apache&#x27;s document root</span></span><br><span class="language-bash">        <span class="hljs-comment"># concurs with nginx&#x27;s one</span></span><br><span class="language-bash">        <span class="hljs-comment">#</span></span><br><span class="language-bash">        <span class="hljs-comment">#location ~ /\.ht &#123;</span></span><br><span class="language-bash">        <span class="hljs-comment">#    deny  all;</span></span><br><span class="language-bash">        <span class="hljs-comment">#&#125;</span></span><br><span class="language-bash">    &#125;</span><br><span class="language-bash"></span><br></code></pre></td></tr></table></figure>

<p>启动nginx</p>
<p>任务管理器杀死所有 nginx进程</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222115525584.png" srcset="/img/loading.gif" lazyload alt="image-20231222115525584" style="zoom: 50%;" />

<p>杀死后再次双击nginx.exe。</p>
<p>启动成功在任务管理器会出现nginx的进程。</p>
<p>日志文件在nginx安装目录下的logs目录</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222115551832.png" srcset="/img/loading.gif" lazyload alt="image-20231222115551832" style="zoom:50%;" />

<p>启动成功访问<a target="_blank" rel="noopener" href="http://www.51xuecheng.cn/">http://www.51xuecheng.cn</a> </p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222121854045.png" srcset="/img/loading.gif" lazyload alt="image-20231222121854045" style="zoom:50%;" />

<h5 id="课程详情页面"><a href="#课程详情页面" class="headerlink" title="课程详情页面"></a>课程详情页面</h5><p>course_template.html是一个静态html页面，里边还没有添加freemarker标签，如果要预览该页面需要借助Nginx进行预览，因为页面需要加载一些css样式表、图片等内容。</p>
<p>course_template.html文件在xc-ui-pc-static-portal\course目录下</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222121937256.png" srcset="/img/loading.gif" lazyload alt="image-20231222121937256"></p>
<p>通过浏览器访问：<a target="_blank" rel="noopener" href="http://www.51xuecheng.cn/course/course_template.html">http://www.51xuecheng.cn/course/course_template.html</a></p>
<p>效果如下:</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222121959011.png" srcset="/img/loading.gif" lazyload alt="image-20231222121959011" style="zoom:50%;" />

<h5 id="文件服务器"><a href="#文件服务器" class="headerlink" title="文件服务器"></a>文件服务器</h5><p>进行课程预览需要展示课程图片, 在线播放课程视频, 音乐, 图片等等在minio中存储, 下面统一由nginx代理, 通过文件服务域名统一访问</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222122116518.png" srcset="/img/loading.gif" lazyload alt="image-20231222122116518" style="zoom:50%;" />

<p>在hosts文件配置如下内容，如果已存在不要重复配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> www.51xuecheng.cn  file.51xuecheng.cn  <br></code></pre></td></tr></table></figure>

<p>在nginx.conf中配置文件服务器的代理地址</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs nginx"> <span class="hljs-comment">#文件服务</span><br><span class="hljs-section">upstream</span> fileserver&#123;<br>  <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.101.65:9000</span> weight=<span class="hljs-number">10</span>;<br>&#125; <br> <span class="hljs-section">server</span> &#123;<br>      <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>      <span class="hljs-attribute">server_name</span>  file.51xuecheng.cn;<br>      <span class="hljs-comment">#charset koi8-r;</span><br>      <span class="hljs-attribute">ssi</span> <span class="hljs-literal">on</span>;<br>      <span class="hljs-attribute">ssi_silent_errors</span> <span class="hljs-literal">on</span>;<br>      <span class="hljs-comment">#access_log  logs/host.access.log  main;</span><br>      <span class="hljs-section">location</span> /video &#123;<br>          <span class="hljs-attribute">proxy_pass</span>   http://fileserver;<br>      &#125;<br><br>      <span class="hljs-section">location</span> /mediafiles &#123;<br>          <span class="hljs-attribute">proxy_pass</span>   http://fileserver;<br>      &#125;<br> &#125;<br><br></code></pre></td></tr></table></figure>

<p>配置完毕，重新加载nginx配置文件。</p>
<p>通过cmd进入nginx.exe所在目录,运行如下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./nginx.exe -s reload<br></code></pre></td></tr></table></figure>

<p>通过			&#96;<a target="_blank" rel="noopener" href="http://file.51xuecheng.cn/mediafiles/%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%E5%9C%B0%E5%9D%80">http://file.51xuecheng.cn/mediafiles/图片文件地址</a> 			访问图片</p>
<p>在媒资数据库的文件表中找一个图片的地址进行测试</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222123045642.png" srcset="/img/loading.gif" lazyload alt="image-20231222123045642" style="zoom:50%;" />

<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222123032722.png" srcset="/img/loading.gif" lazyload alt="image-20231222123032722" style="zoom:50%;" />

<h5 id="视频播放界面"><a href="#视频播放界面" class="headerlink" title="视频播放界面"></a>视频播放界面</h5><p>进入课程详情页面，点击马上学习或课程目录下的小节的名称将打开视频播放页面</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222142713872.png" srcset="/img/loading.gif" lazyload alt="image-20231222142713872"></p>
<p>在nginx.conf中配置视频播放页面的地址</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">location /course/preview/learning.html &#123;<br><span class="hljs-built_in">alias</span> D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal/course/learning.html;<br>&#125; <br>location /course/search.html &#123;  <br>root   D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal;<br>&#125; <br>location /course/learning.html &#123;  <br>root   D:/itcast2022/xc_edu3.0/code_1/xc-ui-pc-static-portal;<br>&#125; <br><br></code></pre></td></tr></table></figure>

<p>加载nginx配置文件</p>
<p>点击课程详情页面上的视频播放链接，打开视频播放页面，如下图</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222144054999.png" srcset="/img/loading.gif" lazyload alt="image-20231222144054999" style="zoom:50%;" />

<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222144108331.png" srcset="/img/loading.gif" lazyload alt="image-20231222144108331"></p>
<p>下边需要配置learning.html页面的视频播放路径来测试视频播放页面，找到learning.html页面中videoObject对象的定义处，配置视频的播放地址(找一个minio里面存在的视频)</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222144753913.png" srcset="/img/loading.gif" lazyload alt="image-20231222144753913" style="zoom:50%;" />

<p>再次打开</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222144842231.png" srcset="/img/loading.gif" lazyload alt="image-20231222144842231" style="zoom: 25%;" />

<p>注意：此页面会去请求后台接口获取课程计划，这里暂时不处理，稍后在接口开发处进行处理。只要页面可以正常打开，可以播放视频就测试通过了。</p>
<h4 id="接口定义"><a href="#接口定义" class="headerlink" title="接口定义"></a>接口定义</h4><h5 id="定义课程预览接口"><a href="#定义课程预览接口" class="headerlink" title="定义课程预览接口"></a>定义课程预览接口</h5><p>课程预览接口是将课程信息整合, 在服务端渲染页面后返回给浏览器</p>
<p>分析课程预览接口:</p>
<ol>
<li>请求参数: 传入<code>课程id</code>, 表示要预览哪一门课程</li>
<li>响应结果: 输出<code>课程详情</code>页面到浏览器</li>
</ol>
<p>响应页面到浏览器用freemarker引擎技术实现, 资料获取课程预览页面course_template.html，拷贝至内容管理的接口工程的resources&#x2F;templates下，并将其在本目录复制一份命名为course_template.ftl</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222154648570.png" srcset="/img/loading.gif" lazyload alt="image-20231222154648570" style="zoom:50%;" />

<p>定义接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.content.api;<br><br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.ModelAndView;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 课程预览 发布</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 付广建 2023/12/22 15:38</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CoursePublishController</span> &#123;<br>    <br>    <span class="hljs-meta">@GetMapping(&quot;/coursepreview/&#123;courseId&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title function_">preview</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long courseId)</span>&#123;<br>        <span class="hljs-type">ModelAndView</span> <span class="hljs-variable">modelAndView</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelAndView</span>();<br>        modelAndView.addObject(<span class="hljs-string">&quot;model&quot;</span>, <span class="hljs-literal">null</span>);<br>        modelAndView.setViewName(<span class="hljs-string">&quot;course_template&quot;</span>);<br>        <span class="hljs-keyword">return</span> modelAndView;<br>    &#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure>

<p>启动内容管理接口工程 ,访问<a target="_blank" rel="noopener" href="http://localhost:63040/content/coursepreview/74">http://localhost:63040/content/coursepreview/74</a></p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222155053498.png" srcset="/img/loading.gif" lazyload alt="image-20231222155053498"></p>
<p>只有内容, 没有样式, 样式在nginx</p>
<h5 id="配置反向代理"><a href="#配置反向代理" class="headerlink" title="配置反向代理"></a>配置反向代理</h5><p>课程预览接口虽然可以正常访问，但是页面没有样式，查看浏览器请求记录，发现图片、样式无法正常访问</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222155234179.png" srcset="/img/loading.gif" lazyload alt="image-20231222155234179" style="zoom:50%;" />

<p>这些静态资源全在门户下，我们需要由Nginx反向代理访问课程预览接口，通过门户的URL去访问课程预览</p>
<p>1、在Nginx下配置：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment">#后台网关</span><br><span class="hljs-section">upstream</span> gatewayserver&#123;<br>    <span class="hljs-attribute">server</span> <span class="hljs-number">127.0.0.1:63010</span> weight=<span class="hljs-number">10</span>;<br>&#125; <br><br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">server_name</span>  www.51xuecheng.cn localhost;<br>	...<br>    <span class="hljs-comment">#api</span><br>    <span class="hljs-section">location</span> /api/ &#123;<br>        <span class="hljs-attribute">proxy_pass</span> http://gatewayserver/;<br>    &#125; <br>	...<br>&#125;<br></code></pre></td></tr></table></figure>

<p>2、重新加载Nginx配置文件</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">nginx.exe -s <span class="hljs-keyword">reload</span><br></code></pre></td></tr></table></figure>

<p>3、启动微服务网关</p>
<p>4、此时访问新地址： <a target="_blank" rel="noopener" href="http://www.51xuecheng.cn/api/content/coursepreview/74">http://www.51xuecheng.cn/api/content/coursepreview/74</a></p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222160402181.png" srcset="/img/loading.gif" lazyload alt="image-20231222160402181" style="zoom:50%;" />

<p>页面虽然正常，但是里边的内容都是静态内容，稍后接口层调用service方式获取模型数据并进行页面渲染。</p>
<p>目前的方式是通过Nginx访问网关，由网关再将请求转发到微服务，Nginx是整个的项目最前方的代理服务器，如下图：</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222160425622.png" srcset="/img/loading.gif" lazyload alt="image-20231222160425622" style="zoom:50%;" />

<h4 id="接口开发"><a href="#接口开发" class="headerlink" title="接口开发"></a>接口开发</h4><h5 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h5><p>课程预览是将课程基本信息, 营销信息, 课程计划, 师资等相关信息进行整合, 在预览页面进行展示</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222162212477.png" srcset="/img/loading.gif" lazyload alt="image-20231222162212477" style="zoom:50%;" />

<p>使用 freemarker 渲染生成视图需要<code>数据模型</code>, 包括基本信息, 营销信息, 课程计划, 师资等等</p>
<p>定义一个数据模型类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.content.model.dto;<br><br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.ToString;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span> 课程预览数据模型</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022/9/16 15:03</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br> <span class="hljs-meta">@Data</span><br> <span class="hljs-meta">@ToString</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CoursePreviewDto</span> &#123;<br><br>    <span class="hljs-comment">//课程基本信息,课程营销信息</span><br>    CourseBaseInfoDto courseBase;<br><br><br>    <span class="hljs-comment">//课程计划信息</span><br>    List&lt;TeachplanDto&gt; teachplans;<br>    <br>    <span class="hljs-comment">//师资信息暂时不加...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="service接口"><a href="#service接口" class="headerlink" title="service接口"></a>service接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.content.service.impl;<br><br><span class="hljs-keyword">import</span> com.xuecheng.content.model.dto.CourseBaseInfoDto;<br><span class="hljs-keyword">import</span> com.xuecheng.content.model.dto.CoursePreviewDto;<br><span class="hljs-keyword">import</span> com.xuecheng.content.model.dto.TeachplanDto;<br><span class="hljs-keyword">import</span> com.xuecheng.content.service.CourseBaseInfoService;<br><span class="hljs-keyword">import</span> com.xuecheng.content.service.CoursePublishService;<br><span class="hljs-keyword">import</span> com.xuecheng.content.service.TeachplanService;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 付广建 2023/12/22 16:26</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CoursePublishServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CoursePublishService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    CourseBaseInfoService courseBaseInfoService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    TeachplanService teachplanService;<br><br>    <span class="hljs-comment">//获取课程预览信息</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> CoursePreviewDto <span class="hljs-title function_">getCoursePreviewInfo</span><span class="hljs-params">(Long courseId)</span> &#123;<br>        <span class="hljs-comment">//课程基本信息，营销信息</span><br>        <span class="hljs-type">CourseBaseInfoDto</span> <span class="hljs-variable">courseBaseInfo</span> <span class="hljs-operator">=</span> courseBaseInfoService.getCourseBaseInfo(courseId);<br>        <span class="hljs-comment">//课程计划信息</span><br>        List&lt;TeachplanDto&gt; teachplanTree = teachplanService.findTeachplanTree(courseId);<br><br>        <span class="hljs-type">CoursePreviewDto</span> <span class="hljs-variable">coursePreviewDto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CoursePreviewDto</span>();<br>        coursePreviewDto.setCourseBase(courseBaseInfo);<br>        coursePreviewDto.setTeachplans(teachplanTree);<br>        <br>        <span class="hljs-keyword">return</span> coursePreviewDto;<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="完善controller"><a href="#完善controller" class="headerlink" title="完善controller"></a>完善controller</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.content.api;<br><br><span class="hljs-keyword">import</span> com.xuecheng.content.model.dto.CoursePreviewDto;<br><span class="hljs-keyword">import</span> com.xuecheng.content.service.CoursePublishService;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.ModelAndView;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 课程预览 发布</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 付广建 2023/12/22 15:38</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CoursePublishController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    CoursePublishService coursePublishService;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/coursepreview/&#123;courseId&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title function_">preview</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long courseId)</span>&#123;<br>        <span class="hljs-type">ModelAndView</span> <span class="hljs-variable">modelAndView</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelAndView</span>();<br>        <span class="hljs-comment">//查询课程的信息作为模型数据</span><br>        <span class="hljs-type">CoursePreviewDto</span> <span class="hljs-variable">coursePreviewInfo</span> <span class="hljs-operator">=</span> coursePublishService.getCoursePreviewInfo(courseId);<br>        <span class="hljs-comment">//指定模型</span><br>        modelAndView.addObject(<span class="hljs-string">&quot;model&quot;</span>, coursePreviewInfo);<br>        <span class="hljs-comment">//指定模板</span><br>        modelAndView.setViewName(<span class="hljs-string">&quot;course_template&quot;</span>);<br>        <span class="hljs-keyword">return</span> modelAndView;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="前后端联调"><a href="#前后端联调" class="headerlink" title="前后端联调"></a>前后端联调</h5><p>原来前端直接指向后台网关地址，现在要更改为Nginx的地址，如下</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222164446204.png" srcset="/img/loading.gif" lazyload alt="image-20231222164446204" style="zoom:50%;" />

<p>重启前端工程，进入课程列表点击”预览”按钮，正常打开课程预览页面</p>
<p><a target="_blank" rel="noopener" href="http://www.51xuecheng.cn/api/content/coursepreview/2">http://www.51xuecheng.cn/api/content/coursepreview/2</a></p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222164512645.png" srcset="/img/loading.gif" lazyload alt="image-20231222164512645"></p>
<p>-&gt;</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222171902870.png" srcset="/img/loading.gif" lazyload alt="image-20231222171902870" style="zoom:50%;" />

<h5 id="编写模板"><a href="#编写模板" class="headerlink" title="编写模板"></a>编写模板</h5><p>填充数据下一步将模型数据填充到course_template.ftl上, 填充时不要一次填充太多, 一边填充一边刷新调试</p>
<p>freemarker提供很多指令用于解析各种类型的数据模型，参考地址：</p>
<p><a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/ref_directives.html">http://freemarker.foofun.cn/ref_directives.html</a></p>
<p>修改模板后需要编译，如下图</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222174434962.png" srcset="/img/loading.gif" lazyload alt="image-20231222174434962" style="zoom:67%;" />

<p>在调试模板时，可以看出哪些信息有缺少，在课程管理处进行补充，比如下图显示课程计划信息不完整，需要进入课程计划界面添加课程计划</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222174527966.png" srcset="/img/loading.gif" lazyload alt="image-20231222174527966" style="zoom:50%;" />

<p>完整的course_template.ftl模板在课程资料目录下，差不多学会了freemarker标签的使用方法，将课程资料下的course_template.ftl覆盖自己的工程下的course_template.ftl。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;zh-CN&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;description&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;author&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;icon&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/static/img/asset-favicon.ico&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>学成在线-$&#123;model.courseBase.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/static/plugins/normalize-css/normalize.css&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/static/plugins/bootstrap/dist/css/bootstrap.css&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/static/css/page-learing-article.css&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">data-spy</span>=<span class="hljs-string">&quot;scroll&quot;</span> <span class="hljs-attr">data-target</span>=<span class="hljs-string">&quot;#articleNavbar&quot;</span> <span class="hljs-attr">data-offset</span>=<span class="hljs-string">&quot;150&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 页面头部 --&gt;</span><br><span class="hljs-comment">&lt;!--#include virtual=&quot;/include/header.html&quot;--&gt;</span><br><span class="hljs-comment">&lt;!--页面头部结束sss--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;learningArea&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;article-banner&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;banner-bg&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;banner-info&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;banner-left&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>$&#123;model.courseBase.mtName&#125;<span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>\ $&#123;model.courseBase.stName&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tit&quot;</span>&gt;</span>$&#123;model.courseBase.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;pic&quot;</span>&gt;</span><br>                &lt;#if model.courseBase.charge==&#x27;201000&#x27;&gt;<br>                    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;new-pic&quot;</span>&gt;</span>免费<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                &lt;#else&gt;<br>                    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;new-pic&quot;</span>&gt;</span>特惠价格￥$&#123;model.courseBase.price!&#x27;&#x27;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;old-pic&quot;</span>&gt;</span>原价￥$&#123;model.courseBase.originalPrice!&#x27;&#x27;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                &lt;/#if&gt;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;info&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span> @<span class="hljs-attr">click.prevent</span>=<span class="hljs-string">&quot;startLearning()&quot;</span>&gt;</span>马上学习<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>难度等级<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><br>                &lt;#if model.courseBase.grade==&#x27;204001&#x27;&gt;<br>                    初级<br>                 &lt;#elseif model.courseBase.grade==&#x27;204002&#x27;&gt;<br>                    中级<br>                &lt;#elseif model.courseBase.grade==&#x27;204003&#x27;&gt;<br>                    高级<br>                &lt;/#if&gt;<br>                <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>课程时长<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span>2小时27分<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>评分<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span>4.7分<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>授课模式<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><br>                 &lt;#if model.courseBase.teachmode==&#x27;200002&#x27;&gt;<br>                     录播<br>                 &lt;#elseif model.courseBase.teachmode==&#x27;200003&#x27;&gt;<br>                     直播<br>                 &lt;/#if&gt;<br>                <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;banner-rit&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://www.51xuecheng.cn/course/preview/learning.html?id=$&#123;model.courseBase.id&#125;&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span><br>                    &lt;#if model.courseBase.pic??&gt;<br>                        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://file.51xuecheng.cn$&#123;model.courseBase.pic&#125;&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;270&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;156&quot;</span>&gt;</span><br>                    &lt;#else&gt;<br>                        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/widget-video.png&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;270&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;156&quot;</span>&gt;</span><br>                    &lt;/#if&gt;<br><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;vid-act&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-heart&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>收藏 23 <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>分享 <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-weixin&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-qq&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;article-cont&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tit-list&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;javascript:;&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;articleClass&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;active&quot;</span>&gt;</span>课程介绍<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;javascript:;&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;articleItem&quot;</span>&gt;</span>目录<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;javascript:;&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;artcleAsk&quot;</span>&gt;</span>问答<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;javascript:;&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;artcleNot&quot;</span>&gt;</span>笔记<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;javascript:;&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;artcleCod&quot;</span>&gt;</span>评价<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--&lt;div class=&quot;down-fill&quot;&gt;</span><br><span class="hljs-comment">            &lt;span&gt;资料下载&lt;/span&gt;</span><br><span class="hljs-comment">            &lt;ul&gt;</span><br><span class="hljs-comment">                &lt;li&gt;java视频资料&lt;/li&gt;</span><br><span class="hljs-comment">                &lt;li&gt;java视频资料&lt;/li&gt;</span><br><span class="hljs-comment">                &lt;li&gt;java视频资料&lt;/li&gt;</span><br><span class="hljs-comment">            &lt;/ul&gt;</span><br><span class="hljs-comment">        &lt;/div&gt;--&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;article-box&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;articleClass&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display: block&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--&lt;div class=&quot;rit-title&quot;&gt;评价&lt;/div&gt;--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;article-cont&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;article-left-box&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span><br><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content-com suit&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>适用人群<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cont cktop&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> &gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>$&#123;model.courseBase.users!&quot;&quot;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-comment">&lt;!--&lt;span class=&quot;on-off&quot;&gt;更多 &lt;i class=&quot;i-chevron-bot&quot;&gt;&lt;/i&gt;&lt;/span&gt;--&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content-com course&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>课程制作<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cont&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;img-box&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/widget-myImg.jpg&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;info-box&quot;</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span>教学方：<span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>XX老师<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                    <span class="hljs-comment">&lt;!-- &lt;p class=&quot;lab&quot;&gt;高级前端开发工程师 10年开发经验&lt;/p&gt;--&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;info&quot;</span>&gt;</span>JavaEE开发与教学多年，精通JavaEE技术体系，对流行框架JQuery、DWR、Struts1/2，Hibernate，Spring，MyBatis、JBPM、Lucene等有深入研究。授课逻辑严谨，条理清晰，注重学生独立解决问题的能力。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                    <span class="hljs-comment">&lt;!-- &lt;p&gt;&lt;span&gt;难度等级&lt;/span&gt;中级&lt;/p&gt;</span><br><span class="hljs-comment">                                     &lt;p&gt;&lt;span&gt;课程时长&lt;/span&gt;8-16小时/周，共4周&lt;/p&gt;</span><br><span class="hljs-comment">                                     &lt;p&gt;&lt;span&gt;如何通过&lt;/span&gt;通过所有的作业及考核，作业共4份，考核为一次终极考核&lt;/p&gt;</span><br><span class="hljs-comment">                                     &lt;p&gt;&lt;span&gt;用户评分&lt;/span&gt;平均用户评分 &lt;em&gt;4.9&lt;/em&gt; &lt;a href=&quot;#&quot;&gt;查看全部评价&lt;/a&gt;&lt;/p&gt;</span><br><span class="hljs-comment">                                     &lt;p&gt;&lt;span&gt;课程价格&lt;/span&gt;特惠价格&lt;em&gt;￥999&lt;/em&gt; &lt;i&gt; 原价1999 &lt;/i&gt;&lt;/p&gt;--&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content-com about&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>课程介绍<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cont cktop&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> &gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>$&#123;model.courseBase.description!&quot;&quot;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-comment">&lt;!--&lt;span class=&quot;on-off&quot;&gt;更多 &lt;i class=&quot;i-chevron-bot&quot;&gt;&lt;/i&gt;&lt;/span&gt;--&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content-com prob&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>常见问题<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cont&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;on-off&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-chevron-bot&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 我什么时候能够访问课程视频与作业？<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;drop-down&quot;</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>课程安排灵活，课程费用支付提供180天全程准入和资格证书。自定进度课程建议的最后期限，但你不会受到惩罚错过期限，只要你赚你的证书在180天内。以会话为基础的课程可能要求你在截止日期前保持正轨，但如果你落后了，你可以切换到以后的会议，你完成的任何工作将与你转移。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;on-off&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-chevron-bot&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 如何需要额外的时间来完成课程会怎么样？<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;drop-down&quot;</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>课程安排灵活，课程费用支付提供180天全程准入和资格证书。自定进度课程建议的最后期限，但你不会受到惩罚错过期限，只要你赚你的证书在180天内。以会话为基础的课程可能要求你在截止日期前保持正轨，但如果你落后了，你可以切换到以后的会议，你完成的任何工作将与你转移。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;on-off&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-chevron-bot&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 我支付次课程之后会得到什么？<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;drop-down&quot;</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>课程安排灵活，课程费用支付提供180天全程准入和资格证书。自定进度课程建议的最后期限，但你不会受到惩罚错过期限，只要你赚你的证书在180天内。以会话为基础的课程可能要求你在截止日期前保持正轨，但如果你落后了，你可以切换到以后的会议，你完成的任何工作将与你转移。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;on-off&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-chevron-bot&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 退款条例是如何规定的？<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;drop-down&quot;</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>课程安排灵活，课程费用支付提供180天全程准入和资格证书。自定进度课程建议的最后期限，但你不会受到惩罚错过期限，只要你赚你的证书在180天内。以会话为基础的课程可能要求你在截止日期前保持正轨，但如果你落后了，你可以切换到以后的会议，你完成的任何工作将与你转移。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;on-off&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-chevron-bot&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 有助学金？<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;drop-down&quot;</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>课程安排灵活，课程费用支付提供180天全程准入和资格证书。自定进度课程建议的最后期限，但你不会受到惩罚错过期限，只要你赚你的证书在180天内。以会话为基础的课程可能要求你在截止日期前保持正轨，但如果你落后了，你可以切换到以后的会议，你完成的任何工作将与你转移。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>                <span class="hljs-comment">&lt;!--侧边栏--&gt;</span><br>                <span class="hljs-comment">&lt;!--#include virtual=&quot;/include/course_detail_side.html&quot;--&gt;</span><br>                <span class="hljs-comment">&lt;!--侧边栏--&gt;</span><br><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;articleItem&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display: none&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;article-cont-catalog&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;article-left-box&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span><br>                        &lt;#list model.teachplans as firstNode&gt;<br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title act&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-chevron-top&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>$&#123;firstNode.pname&#125;<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;time&quot;</span>&gt;</span>x小时<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;drop-down&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;height: 260px;&quot;</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;list-box&quot;</span>&gt;</span><br>                                        &lt;#list firstNode.teachPlanTreeNodes as secondNode&gt;<br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://www.51xuecheng.cn/course/preview/learning.html?id=$&#123;model.courseBase.id&#125;&amp;chapter=$&#123;secondNode.teachplanMedia.teachplanId!&#x27;&#x27;&#125;&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span>$&#123;secondNode.pname&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                        &lt;/#list&gt;<br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        &lt;/#list&gt;<br>                       &lt;#-- <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title act&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-chevron-top&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>第一阶段 HTTP协议基础详解<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;time&quot;</span>&gt;</span>8小时<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;about&quot;</span>&gt;</span>使用Java消息中间件处理异步消息成为了分布式系统中的必修课，通过本门课程可以深入浅出的学习如何在Java中使用消息中间件并且一步一步打造更优雅的最佳实践方案。<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;drop-down&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;height: 260px;&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;list-box&quot;</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;active&quot;</span>&gt;</span>1.1 阅读：分级政策细节 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>97’33”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.2 视频：为什么分为 A 部分、B 部分、C 部分 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>66’15”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.3 视频：软件安装介绍 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>86’42”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.4 阅读：Emacs安装 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>59’00”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.5 作业1：Emacs安装 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>93’29”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>阶段测试<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>--&gt;<br><br><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--侧边栏--&gt;</span><br>                <span class="hljs-comment">&lt;!--#include virtual=&quot;/include/course_detail_side.html&quot;--&gt;</span><br>                <span class="hljs-comment">&lt;!--侧边栏--&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        &lt;#--<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;articleItem&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display: none&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;article-cont-catalog&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;article-left-box&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title act&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-chevron-top&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>第一阶段 HTTP协议基础详解<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;time&quot;</span>&gt;</span>8小时<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;about&quot;</span>&gt;</span>使用Java消息中间件处理异步消息成为了分布式系统中的必修课，通过本门课程可以深入浅出的学习如何在Java中使用消息中间件并且一步一步打造更优雅的最佳实践方案。<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;drop-down&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;height: 260px;&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;list-box&quot;</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;active&quot;</span>&gt;</span>1.1 阅读：分级政策细节 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>97’33”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.2 视频：为什么分为 A 部分、B 部分、C 部分 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>66’15”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.3 视频：软件安装介绍 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>86’42”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.4 阅读：Emacs安装 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>59’00”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.5 作业1：Emacs安装 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>93’29”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>阶段测试<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-chevron-bot&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>第二阶段 HTTP协议基础详解<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;time&quot;</span>&gt;</span>8小时<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;about&quot;</span>&gt;</span>使用Java消息中间件处理异步消息成为了分布式系统中的必修课，通过本门课程可以深入浅出的学习如何在Java中使用消息中间件并且一步一步打造更优雅的最佳实践方案。<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;drop-down&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;list-box&quot;</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;active&quot;</span>&gt;</span>1.1 阅读：分级政策细节 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>97’33”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.2 视频：为什么分为 A 部分、B 部分、C 部分 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>66’15”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.3 视频：软件安装介绍 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>86’42”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.4 阅读：Emacs安装 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>59’00”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.5 作业1：Emacs安装 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>93’29”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>阶段测试<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-chevron-bot&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>第三阶段 HTTP协议基础详解<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;time&quot;</span>&gt;</span>3小时<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;about&quot;</span>&gt;</span>使用Java消息中间件处理异步消息成为了分布式系统中的必修课，通过本门课程可以深入浅出的学习如何在Java中使用消息中间件并且一步一步打造更优雅的最佳实践方案。<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;drop-down&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;list-box&quot;</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;active&quot;</span>&gt;</span>1.1 阅读：分级政策细节 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>97’33”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.2 视频：为什么分为 A 部分、B 部分、C 部分 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>66’15”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.3 视频：软件安装介绍 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>86’42”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.4 阅读：Emacs安装 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>59’00”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.5 作业1：Emacs安装 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>93’29”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>阶段测试<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-chevron-bot&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>第四阶段 HTTP协议基础详解<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;time&quot;</span>&gt;</span>3小时<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;about&quot;</span>&gt;</span>使用Java消息中间件处理异步消息成为了分布式系统中的必修课，通过本门课程可以深入浅出的学习如何在Java中使用消息中间件并且一步一步打造更优雅的最佳实践方案。<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;drop-down&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;list-box&quot;</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;active&quot;</span>&gt;</span>1.1 阅读：分级政策细节 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>97’33”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.2 视频：为什么分为 A 部分、B 部分、C 部分 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>66’15”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.3 视频：软件安装介绍 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>86’42”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.4 阅读：Emacs安装 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>59’00”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.5 作业1：Emacs安装 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>93’29”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>阶段测试<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-chevron-bot&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>第五阶段 HTTP协议基础详解<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;time&quot;</span>&gt;</span>3小时<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;about&quot;</span>&gt;</span>使用Java消息中间件处理异步消息成为了分布式系统中的必修课，通过本门课程可以深入浅出的学习如何在Java中使用消息中间件并且一步一步打造更优雅的最佳实践方案。<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;drop-down&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;list-box&quot;</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;active&quot;</span>&gt;</span>1.1 阅读：分级政策细节 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>97’33”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.2 视频：为什么分为 A 部分、B 部分、C 部分 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>66’15”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.3 视频：软件安装介绍 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>86’42”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.4 阅读：Emacs安装 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>59’00”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1.5 作业1：Emacs安装 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>93’29”<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>阶段测试<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;overwrite&quot;</span>&gt;</span>毕业考核<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--侧边栏&amp;ndash;&amp;gt;</span><br><span class="hljs-comment">                &lt;!--#include virtual=&quot;/include/course_detail_side.html&quot;&amp;ndash;&amp;gt;</span><br><span class="hljs-comment">                &lt;!--侧边栏&amp;ndash;&amp;gt;</span><br><span class="hljs-comment">            &lt;/div&gt;</span><br><span class="hljs-comment">        &lt;/div&gt;--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;artcleAsk&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display: none&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;article-cont-ask&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;article-left-box&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content-title&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;all&quot;</span>&gt;</span>全部<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>精选<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>我的<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;all&quot;</span>&gt;</span>全部<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>1.1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>1.2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>1.3<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>1.4<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>1.5<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;$&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;more&quot;</span>&gt;</span>更多 <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-chevron-bot&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-left&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/widget-myImg.jpg&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;60px&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>毛老师<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-right&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span>如何用微服务重构应用程序?<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>我来回答<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>2017-3-20 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>回答2<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>浏览2<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-left&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/widget-myImg.jpg&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;60px&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>毛老师<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-right&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span>如何用微服务重构应用程序?<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>在讨论如何将重构转化为微服务之前，退后一步，仔细观察微服务的内容和时间是很重要的。以下两个要点将会对任何微服务重构策略产生重大影响。 【最新 <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;new&quot;</span>&gt;</span>心跳347890<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 的回答】<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>2017-3-20 <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;action-box&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-answer&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>回答 2<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-browse&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>浏览 12<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-left&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/widget-myImg.jpg&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;60px&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>毛老师<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-right&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span>如何用微服务重构应用程序?<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>在讨论如何将重构转化为微服务之前，退后一步，仔细观察微服务的内容和时间是很重要的。以下两个要点将会对任何微服务重构策略产生重大影响。 【最新 <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;new&quot;</span>&gt;</span>心跳347890<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 的回答】<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>2017-3-20 <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;action-box&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-answer&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>回答 2<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-browse&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>浏览 12<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-left&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/widget-myImg.jpg&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;60px&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>毛老师<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-right&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span>如何用微服务重构应用程序?<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>在讨论如何将重构转化为微服务之前，退后一步，仔细观察微服务的内容和时间是很重要的。以下两个要点将会对任何微服务重构策略产生重大影响。 【最新 <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;new&quot;</span>&gt;</span>心跳347890<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 的回答】<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>2017-3-20 <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;action-box&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-answer&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>回答 2<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-browse&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>浏览 12<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-left&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/widget-myImg.jpg&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;60px&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>毛老师<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-right&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span>如何用微服务重构应用程序?<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>在讨论如何将重构转化为微服务之前，退后一步，仔细观察微服务的内容和时间是很重要的。以下两个要点将会对任何微服务重构策略产生重大影响。 【最新 <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;new&quot;</span>&gt;</span>心跳347890<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 的回答】<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>2017-3-20 <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;action-box&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-answer&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>回答 2<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-browse&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>浏览 12<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-left&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/widget-myImg.jpg&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;60px&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>毛老师<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-right&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span>如何用微服务重构应用程序?<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>在讨论如何将重构转化为微服务之前，退后一步，仔细观察微服务的内容和时间是很重要的。以下两个要点将会对任何微服务重构策略产生重大影响。 【最新 <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;new&quot;</span>&gt;</span>心跳347890<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 的回答】<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>2017-3-20 <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;action-box&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-answer&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>回答 2<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-browse&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>浏览 12<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;itemlast&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;overwrite&quot;</span>&gt;</span>显示更多问题<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--侧边栏--&gt;</span><br>                <span class="hljs-comment">&lt;!--#include virtual=&quot;/include/course_detail_side.html&quot;--&gt;</span><br>                <span class="hljs-comment">&lt;!--侧边栏--&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;artcleNot&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display: none;&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;article-cont-note&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;article-left-box&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content-title&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;all&quot;</span>&gt;</span>全部<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>精选<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>我的<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;all&quot;</span>&gt;</span>全部<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>1.1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>1.2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>1.3<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>1.4<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>1.5<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;$&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;more&quot;</span>&gt;</span>更多 <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-chevron-bot&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-left&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/widget-myImg.jpg&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;60px&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>毛老师<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-right&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;video-time&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-play&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>2`10`<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/widget-demo.png&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;221&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;action-box&quot;</span>&gt;</span>4小时前 <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;active-box&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-coll&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>采集<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-laud&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>赞<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-left&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/widget-myImg.jpg&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;60px&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>毛老师<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-right&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>在讨论如何将重构转化为微服务之前，退后一步，<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>仔细观察微服务的内容和时间是很重要的。<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>以下两个要点将会对任何微服务重构策略产生重大影响。 <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;action-box&quot;</span>&gt;</span>4小时前 <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;active-box&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-edt&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>编辑<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-del&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-laud&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>赞<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-left&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/widget-myImg.jpg&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;60px&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>毛老师<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-right&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>在讨论如何将重构转化为微服务之前，退后一步，<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>仔细观察微服务的内容和时间是很重要的。<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>以下两个要点将会对任何微服务重构策略产生重大影响。 <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;action-box&quot;</span>&gt;</span>4小时前 <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;active-box&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-edt&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>编辑<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-del&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-laud&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>赞<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-left&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/widget-myImg.jpg&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;60px&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>毛老师<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-right&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>在讨论如何将重构转化为微服务之前，退后一步，<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>仔细观察微服务的内容和时间是很重要的。<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>以下两个要点将会对任何微服务重构策略产生重大影响。 <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;action-box&quot;</span>&gt;</span>4小时前 <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;active-box&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-edt&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>编辑<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-del&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;i-laud&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>赞<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--侧边栏--&gt;</span><br>                <span class="hljs-comment">&lt;!--#include virtual=&quot;/include/course_detail_side.html&quot;--&gt;</span><br>                <span class="hljs-comment">&lt;!--侧边栏--&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;artcleCod&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display: none;&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;article-cont&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;article-left-box&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;comment-box&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;evaluate&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;eva-top&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tit&quot;</span>&gt;</span>课程评分 <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;star&quot;</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;score&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;star-score&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 分<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;eva-cont&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tit&quot;</span>&gt;</span>学员评语 <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-box&quot;</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">rows</span>=<span class="hljs-string">&quot;5&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;扯淡、吐槽、表扬、鼓励......想说啥说啥！&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-right&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>发表评论<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;course-evaluate&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;top-tit&quot;</span>&gt;</span>评论<br>                                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;eval&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">checked</span> /&gt;</span> 所有学生 <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;eval&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span> /&gt;</span> 完成者 <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;top-cont&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cont-top-left&quot;</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;star-scor&quot;</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;star-show&quot;</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;score&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;scor&quot;</span>&gt;</span>4.9分<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;all-scor&quot;</span>&gt;</span>总评分：12343<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cont-top-right&quot;</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;star-grade&quot;</span>&gt;</span>五星<br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;grade&quot;</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;grade-percent&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;percent-num&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>95<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>%<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;star-grade&quot;</span>&gt;</span>四星<br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;grade&quot;</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;grade-percent&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;percent-num&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>%<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;star-grade&quot;</span>&gt;</span>三星<br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;grade&quot;</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;grade-percent&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;percent-num&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>%<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;star-grade&quot;</span>&gt;</span>二星<br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;grade&quot;</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;grade-percent&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;percent-num&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>%<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;star-grade&quot;</span>&gt;</span>一星<br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;grade&quot;</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;grade-percent&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;percent-num&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>%<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;comment-item-box&quot;</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span>评论 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>12453条评论<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-left&quot;</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/widget-pic.png&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;60px&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>毛老师<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-cent&quot;</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>很受用，如果再深入下就更好了。虽然都是入门级别的，但是也很使用，后续就需要自己发挥了！虽然都是入门级别的，但是也很使用，后续就需要自己发挥了！虽然都是入门级别的，但是也很使用，后续就需要自己发挥了！虽然都是入门级别的，但是也很使用，后续就需要自己发挥了！<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;time&quot;</span>&gt;</span>2017-2-43<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-rit&quot;</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;star-show&quot;</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;score&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>评分 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>5星<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-left&quot;</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/widget-pic.png&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;60px&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>毛老师<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-cent&quot;</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>很受用，如果再深入下就更好了。虽然都是入门级别的，但是也很使用，后续就需要自己发挥了！虽然都是入门级别的，但是也很使用，后续就需要自己发挥了！虽然都是入门级别的，但是也很使用，后续就需要自己发挥了！虽然都是入门级别的，但是也很使用，后续就需要自己发挥了！<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;time&quot;</span>&gt;</span>2017-2-43<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-rit&quot;</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;star-show&quot;</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;score&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>评分 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>5星<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-left&quot;</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/widget-pic.png&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;60px&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>毛老师<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-cent&quot;</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>很受用，如果再深入下就更好了。虽然都是入门级别的，但是也很使用，后续就需要自己发挥了！虽然都是入门级别的，但是也很使用，后续就需要自己发挥了！虽然都是入门级别的，但是也很使用，后续就需要自己发挥了！虽然都是入门级别的，但是也很使用，后续就需要自己发挥了！<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;time&quot;</span>&gt;</span>2017-2-43<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-rit&quot;</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;star-show&quot;</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;score&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>评分 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>5星<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-left&quot;</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/widget-pic.png&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;60px&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>毛老师<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-cent&quot;</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>很受用，如果再深入下就更好了。虽然都是入门级别的，但是也很使用，后续就需要自己发挥了！虽然都是入门级别的，但是也很使用，后续就需要自己发挥了！虽然都是入门级别的，但是也很使用，后续就需要自己发挥了！虽然都是入门级别的，但是也很使用，后续就需要自己发挥了！<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;time&quot;</span>&gt;</span>2017-2-43<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-rit&quot;</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;star-show&quot;</span>&gt;</span><br>                                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;score&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>评分 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>5星<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;get-more&quot;</span>&gt;</span>页面加载中...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--侧边栏--&gt;</span><br>                <span class="hljs-comment">&lt;!--#include virtual=&quot;/include/course_detail_side.html&quot;--&gt;</span><br>                <span class="hljs-comment">&lt;!--侧边栏--&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;popup-course&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mask&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--欢迎访问课程弹窗- start --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;popup-course-box&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span>$&#123;model.courseBase.name&#125; <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;close-popup-course-box&quot;</span>&gt;</span>×<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>欢迎学习本课程，本课程免费您可以立即学习，也可加入我的课程表享受更优质的服务。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span> @<span class="hljs-attr">click.prevent</span>=<span class="hljs-string">&quot;addCourseTable()&quot;</span>&gt;</span>加入我的课程表<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span> @<span class="hljs-attr">click.prevent</span>=<span class="hljs-string">&quot;startLearngin()&quot;</span>&gt;</span>立即学习<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;popup-box&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mask&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--支付弹窗- start --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;popup-pay-box&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span>$&#123;model.courseBase.name&#125; <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;close-popup-pay-box&quot;</span>&gt;</span>×<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">&quot;qrcode&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;200&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;200&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;请点击支付宝支付按钮，并完成扫码支付。&quot;</span>/&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;info&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;info-tit&quot;</span>&gt;</span>$&#123;model.courseBase.name&#125;<span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>课程有效期:$&#123;model.courseBase.validDays&#125;天<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;info-pic&quot;</span>&gt;</span>课程价格 : <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>￥$&#123;model.courseBase.originalPrice!&#x27;&#x27;&#125;元<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;info-new-pic&quot;</span>&gt;</span>优惠价格 : <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>￥$&#123;model.courseBase.price!&#x27;&#x27;&#125;元<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fact-pic&quot;</span>&gt;</span>实际支付: <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>￥$&#123;model.courseBase.price!&#x27;&#x27;&#125;元<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;go-pay&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span> @<span class="hljs-attr">click.prevent</span>=<span class="hljs-string">&quot;wxPay()&quot;</span>&gt;</span>微信支付<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span> @<span class="hljs-attr">click.prevent</span>=<span class="hljs-string">&quot;aliPay()&quot;</span>&gt;</span>支付宝支付<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span> @<span class="hljs-attr">click.prevent</span>=<span class="hljs-string">&quot;querypayresult()&quot;</span>&gt;</span>支付完成<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span> @<span class="hljs-attr">click.prevent</span>=<span class="hljs-string">&quot;startLearngin()&quot;</span>&gt;</span>试学<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--支付弹窗- end --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;popup-comment-box&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 页面底部 --&gt;</span><br>    <span class="hljs-comment">&lt;!--底部版权--&gt;</span><br>    <span class="hljs-comment">&lt;!--#include virtual=&quot;/include/footer.html&quot;--&gt;</span><br>    <span class="hljs-comment">&lt;!--底部版权--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"><span class="hljs-keyword">var</span> courseId = <span class="hljs-string">&quot;$&#123;model.courseBase.id&#125;&quot;</span>;<span class="hljs-keyword">var</span> courseCharge = <span class="hljs-string">&quot;$&#123;model.courseBase.charge&#125;&quot;</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-comment">&lt;!--#include virtual=&quot;/include/course_detail_dynamic.html&quot;--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<h5 id="视频播放页面接口"><a href="#视频播放页面接口" class="headerlink" title="视频播放页面接口"></a>视频播放页面接口</h5><p>从课程详情页面进入视频播放页面</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222174822888.png" srcset="/img/loading.gif" lazyload alt="image-20231222174822888" style="zoom:50%;" />

<p>在此页面需要从后台获取课程信息, <code>根据课程计划获取对应的视频地址</code>，下边编写这两个接口：</p>
<p>获取课程信息接口：&#x2F;open&#x2F;content&#x2F;course&#x2F;whole&#x2F;{courseId}</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/open/</span>content<span class="hljs-regexp">/course/</span>whole/课程id<br><br>响应：同课程预览service接口返回数据<br></code></pre></td></tr></table></figure>

<p>根据课程计划获取视频地址接口：&#x2F;open&#x2F;media&#x2F;preview&#x2F;{mediaId}</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">/open/media/preview/课程计划<span class="hljs-built_in">id</span><br><br>响应：<br>&#123;<span class="hljs-string">&quot;code&quot;</span>:0,<span class="hljs-string">&quot;msg&quot;</span>:<span class="hljs-string">&quot;success&quot;</span>,<span class="hljs-string">&quot;result&quot;</span>:<span class="hljs-string">&quot;视频的url&quot;</span>,<span class="hljs-string">&quot;successful&quot;</span>:<span class="hljs-literal">true</span>&#125;<br><br></code></pre></td></tr></table></figure>

<p>1、在nginx配置如下地址</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment">#openapi</span><br><span class="hljs-section">location</span> /open/content/ &#123;<br>        <span class="hljs-attribute">proxy_pass</span> http://gatewayserver/content/open/;<br>&#125; <br><span class="hljs-section">location</span> /open/media/ &#123;<br>        <span class="hljs-attribute">proxy_pass</span> http://gatewayserver/media/open/;<br>&#125; <br></code></pre></td></tr></table></figure>

<p>配置运行nginx.exe -s reload加载nginx的配置文件 </p>
<p>2、在内容管理接口层定义CourseOpenController类，并定义接口：获取课程信息接口：&#x2F;open&#x2F;content&#x2F;course&#x2F;whole&#x2F;{courseId}</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.content.api;<br><br><span class="hljs-keyword">import</span> com.xuecheng.content.model.dto.CoursePreviewDto;<br><span class="hljs-keyword">import</span> com.xuecheng.content.service.CourseBaseInfoService;<br><span class="hljs-keyword">import</span> com.xuecheng.content.service.CoursePublishService;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 付广建 2023/12/22 17:52</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Api(value = &quot;视频公开查询接口&quot;, tags = &quot;课程公开查询接口&quot;)</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/open&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CourseOpenController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CourseBaseInfoService courseBaseInfoService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CoursePublishService coursePublishService;<br><br>    <span class="hljs-comment">//获取课程预览信息</span><br>    <span class="hljs-meta">@GetMapping(&quot;/course/whole/&#123;courseId&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> CoursePreviewDto <span class="hljs-title function_">getPreviewInfo</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;courseId&quot;)</span> Long courseId)</span>&#123;<br>        <span class="hljs-type">CoursePreviewDto</span> <span class="hljs-variable">coursePreviewInfo</span> <span class="hljs-operator">=</span> coursePublishService.getCoursePreviewInfo(courseId);<br>        <span class="hljs-keyword">return</span> coursePreviewInfo;<br>    &#125;<br><br>    <br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>3、在媒资管理服务media-api工程定义MediaOpenController类，并定义接口&#x2F;open&#x2F;media&#x2F;preview&#x2F;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.media.api;<br><br><span class="hljs-keyword">import</span> com.xuecheng.base.execption.XueChengPlusException;<br><span class="hljs-keyword">import</span> com.xuecheng.base.model.RestResponse;<br><span class="hljs-keyword">import</span> com.xuecheng.media.model.po.MediaFiles;<br><span class="hljs-keyword">import</span> com.xuecheng.media.service.MediaFileService;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.util.StringUtils;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 付广建 2023/12/22 17:55</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Api(value = &quot;媒资文件管理接口&quot;, tags = &quot;媒资文件管理接口&quot;)</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/open&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MediaOpenController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    MediaFileService mediaFileService;<br><br>    <span class="hljs-meta">@ApiOperation(&quot;预览文件&quot;)</span><br>    <span class="hljs-meta">@GetMapping(&quot;/preview/&#123;mediaId&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> RestResponse&lt;String&gt; <span class="hljs-title function_">getPlayUrlByMediaId</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long mediaId)</span>&#123;<br>        <span class="hljs-type">MediaFiles</span> <span class="hljs-variable">mediaFiles</span> <span class="hljs-operator">=</span> mediaFileService.getFileById(mediaId);<br>        <span class="hljs-keyword">if</span> (mediaFiles==<span class="hljs-literal">null</span>|| StringUtils.isEmpty(mediaFiles.getUrl()))&#123;<br>            XueChengPlusException.cast(<span class="hljs-string">&quot;视频没有转码处理&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> RestResponse.success(mediaFiles.getUrl());<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>5、测试</p>
<p>定义好后，启动内容管理、媒资管理、后台服务网关服务，测试视频播放页面是否可以正常获取课程计划，点击具体的课程计划是否正常可以播放视频。</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222182532558.png" srcset="/img/loading.gif" lazyload alt="image-20231222182532558" style="zoom:50%;" />

<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222182543866.png" srcset="/img/loading.gif" lazyload alt="image-20231222182543866" style="zoom: 50%;" />

<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222182554000.png" srcset="/img/loading.gif" lazyload alt="image-20231222182554000" style="zoom: 25%;" />

<h3 id="课程审核-1"><a href="#课程审核-1" class="headerlink" title="课程审核"></a>课程审核</h3><h4 id="需求分析-2"><a href="#需求分析-2" class="headerlink" title="需求分析"></a>需求分析</h4><h5 id="业务流程-1"><a href="#业务流程-1" class="headerlink" title="业务流程"></a>业务流程</h5><p>根据模块需求分析, 课程发布前需要先审核,审核通过才能发布, 审核及发布流程图</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222195927107.png" srcset="/img/loading.gif" lazyload alt="image-20231222195927107" style="zoom:67%;" />

<p>为什么课程审核通过才能发布呢?</p>
<p>防止课程违规暴力涉黄, 影响用户体验, 课程审核起监督作用, 帮助教学机构规范使用平台的手段</p>
<p>如何控制课程审核通过才能发布课程?</p>
<p>在课程表  course_base  设置课程审核状态(未提交  已提交{未审核} 审核通过 审核不通过)</p>
<p>课程状态转化关系</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222200203226.png" srcset="/img/loading.gif" lazyload alt="image-20231222200203226" style="zoom:67%;" />

<p>说明:</p>
<ol>
<li>课程新增后审核状态是：未提交，发布状态是：未发布</li>
<li>课程信息编辑完成，教学机构人员执行：提交审核，此时课程审核状态：已提交</li>
<li>当课程状态：已提交，运营平台人员对课程进行审核</li>
<li>运营平台人员审核课程，结果：审核通过，审核不通过</li>
<li>课程审核后不管状态是通过还是不通过，教学机构可以再次修改课程并提交审核，此时课程状态：已提交，此时运营平台人员再次审核课程</li>
<li>课程审核通过，教学机构人员可以发布课程，发布成功后课程的发布状态：已发布</li>
<li>课程发布后通过操作：下架，更改课程发布状态为：下架</li>
<li>课程下架后通过操作：上架，再次发布课程，上架后课程发布状态：上架</li>
</ol>
<h5 id="数据模型-1"><a href="#数据模型-1" class="headerlink" title="数据模型"></a>数据模型</h5><ol>
<li>课程提交审核后还允许修改课程吗？</li>
</ol>
<p>如果不允许修改不合理，因为提交审核后可以继续下一个阶段的课程内容，比如添加课程计划，上传课程视频等</p>
<p>如果允许修改那课程审核看到的课程内容从哪里来？如果从课程基本信息表，课程营销表，课程计划表查询会有什么问题？</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222200957823.png" srcset="/img/loading.gif" lazyload alt="image-20231222200957823" style="zoom:50%;" />

<p>运营人员审核课程和教学机构编辑课程操作的数据是同一份，此时会导致冲突，例如：运营人员正在审核时教学机构把数据修改了。</p>
<p>为了解决这个问题，专门设计了<strong>课程预发布表</strong></p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222201145071.png" srcset="/img/loading.gif" lazyload alt="image-20231222201145071"></p>
<p>提交课程审核，将课程信息汇总写入课程预发布表，课程预发布表记录了教学机构在<strong>某个时间点</strong>要发布的课程信息。</p>
<p>课程审核人员从预发布表查询信息进行审核。</p>
<p>课程审核同时可以对课程进行修改，修改的内容不会写入课程预发布表。</p>
<p>课程审核通过执行<strong>课程发布</strong>，将课程预发布表信息写入课程发布表。</p>
<ol start="2">
<li>提交审核课程后，也修改了课程信息，可以再次提交审核吗？</li>
</ol>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222201534950.png" srcset="/img/loading.gif" lazyload alt="image-20231222201534950" style="zoom:67%;" />

<p>提交审核课程后，必须等到课程审核完成才能再次提交课程</p>
<p>课程审核功能设计教学机构提交审核，运营人员进行课程审核。这里只模拟审核结果，课程审核结果通过手动修改数据库来实现。</p>
<p>提交审核将信息写入<strong>课程预发布表</strong>，结构：</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222201934948.png" srcset="/img/loading.gif" lazyload alt="image-20231222201934948"></p>
<p>更新课程基本信息表的课程审核状态为：已经提交</p>
<p>课程审核后更新课程基本信息表的审核状态，课程预发布表的审核状态，并将审核结果写入课程审核记录</p>
<p>审核记录表结构：</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222202110197.png" srcset="/img/loading.gif" lazyload alt="image-20231222202110197"></p>
<h4 id="接口定义-1"><a href="#接口定义-1" class="headerlink" title="接口定义"></a>接口定义</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 课程审核</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@PostMapping(&quot;/courseaudit/commit/&#123;courseId&#125;&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">commitAudit</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long courseId)</span>&#123;<br>    <span class="hljs-type">Long</span> <span class="hljs-variable">companyId</span> <span class="hljs-operator">=</span> <span class="hljs-number">1232141425L</span>;<br>    coursePublishService.commitAudit(companyId, courseId);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="接口开发-1"><a href="#接口开发-1" class="headerlink" title="接口开发"></a>接口开发</h4><h5 id="DAO开发"><a href="#DAO开发" class="headerlink" title="DAO开发"></a>DAO开发</h5><ol>
<li>查询课程基本信息，课程营销信息，课程计划信息等课程相关信息，整合为课程预发布信息</li>
<li>向课程预发布表course_publish_pre插入一条记录，如果已经存在则更新，审核状态：已提交</li>
<li>更新课程基本表 course_base 课程审核状态：已提交</li>
</ol>
<p>约束:</p>
<ol>
<li>对已提交审核的课程不允许提交审核</li>
<li>本机构只允许提交本机构的课程</li>
<li>没有上传图片不允许提交审核</li>
<li>没有添加课程计划不允许提交审核</li>
</ol>
<p>使用代码生成器生成课程发布表的PO，mapper，拷贝到响应工程下</p>
<h5 id="service开发"><a href="#service开发" class="headerlink" title="service开发"></a>service开发</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//课程审核</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">commitAudit</span><span class="hljs-params">(Long companyId, Long courseId)</span> &#123;<br>    <span class="hljs-comment">//约束</span><br>    <span class="hljs-type">CourseBase</span> <span class="hljs-variable">courseBase</span> <span class="hljs-operator">=</span> courseBaseMapper.selectById(courseId);<br>    <span class="hljs-comment">//审核状态</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">auditStatus</span> <span class="hljs-operator">=</span> courseBase.getAuditStatus();<br>    <span class="hljs-comment">//当前审核状态为已提交不允许再次提交</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;202003&quot;</span>.equals(auditStatus))&#123;<br>        XueChengPlusException.cast(<span class="hljs-string">&quot;当前为等待审核状态，审核完成可以再次提交&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">//本机构只允许提交本机构的课程</span><br>    <span class="hljs-keyword">if</span> (!Objects.equals(courseBase.getCompanyId(), companyId))&#123;<br>        XueChengPlusException.cast(<span class="hljs-string">&quot;不允许提交其他机构的课程&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">//课程图片是否添加</span><br>    <span class="hljs-keyword">if</span> (StringUtils.isEmpty(courseBase.getPic()))&#123;<br>        XueChengPlusException.cast(<span class="hljs-string">&quot;提交失败，请上传课程图片&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">//添加课程预发布记录</span><br>    <span class="hljs-type">CoursePublishPre</span> <span class="hljs-variable">coursePublishPre</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CoursePublishPre</span>();<br>    <span class="hljs-comment">//课程预发布记录 = 课程基本信息 + 营销信息 + 课程计划信息</span><br>    <span class="hljs-comment">//1.课程基本信息</span><br>    <span class="hljs-type">CourseBaseInfoDto</span> <span class="hljs-variable">courseBaseInfo</span> <span class="hljs-operator">=</span> courseBaseInfoService.getCourseBaseInfo(courseId);<br>    BeanUtils.copyProperties(courseBaseInfo, coursePublishPre);<br><br>    <span class="hljs-comment">//2.部分营销信息</span><br>    <span class="hljs-type">CourseMarket</span> <span class="hljs-variable">courseMarket</span> <span class="hljs-operator">=</span> courseMarketMapper.selectById(courseId);<br>    <span class="hljs-comment">// bean -&gt; json</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">courseMarketJson</span> <span class="hljs-operator">=</span> JSON.toJSONString(courseMarket);<br>    <span class="hljs-comment">// 将课程营销信息json数据放入课程预发布表</span><br>    coursePublishPre.setMarket(courseMarketJson);<br><br>    <span class="hljs-comment">//3.查询课程计划信息</span><br>    List&lt;TeachplanDto&gt; teachplanTree = teachplanService.findTeachplanTree(courseId);<br>    <span class="hljs-keyword">if</span> (teachplanTree.size() == <span class="hljs-number">0</span>)&#123;<br>        XueChengPlusException.cast(<span class="hljs-string">&quot;提交失败，没有添加课程计划&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// bean -&gt; json</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">teachplanTreeJson</span> <span class="hljs-operator">=</span> JSON.toJSONString(teachplanTree);<br>    <span class="hljs-comment">// 将课程计划信息json数据放入课程预发布表</span><br>    coursePublishPre.setTeachplan(teachplanTreeJson);<br><br>    <span class="hljs-comment">//设置预发布记录状态，已提交</span><br>    coursePublishPre.setStatus(<span class="hljs-string">&quot;202003&quot;</span>);<br>    <span class="hljs-comment">//教学机构id</span><br>    coursePublishPre.setCompanyId(companyId);<br>    <span class="hljs-comment">//提交时间</span><br>    coursePublishPre.setCreateDate(LocalDateTime.now());<br>    <span class="hljs-type">CoursePublishPre</span> <span class="hljs-variable">coursePublishPreUpdate</span> <span class="hljs-operator">=</span> coursePublishPreMapper.selectById(courseId);<br>    <span class="hljs-comment">//添加课程预发布记录</span><br>    <span class="hljs-keyword">if</span> (coursePublishPreUpdate!=<span class="hljs-literal">null</span>)&#123;<br>        coursePublishPreMapper.insert(coursePublishPre);<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        coursePublishPreMapper.updateById(coursePublishPre);<br>    &#125;<br>    <span class="hljs-comment">//更新课程基本表的审核状态</span><br>    courseBase.setAuditStatus(<span class="hljs-string">&quot;202003&quot;</span>);<br>    courseBaseMapper.updateById(courseBase);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="接口测试"><a href="#接口测试" class="headerlink" title="接口测试"></a>接口测试</h4><p>使用前端提前课程审核：</p>
<ol>
<li>找一门信息不全的课程，测试各约束条件</li>
<li>正常提交后，观察数据库课程预发布表内容是否完整</li>
<li>测试审核后再次提交，提交后观察数据库中课程预发布表记录内容是否正确</li>
</ol>
<p>审核通过手动修改数据库：</p>
<ol>
<li>修改课程预发布表状态为审核通过202004</li>
<li>修改课程基本表的审核状态为审核通过202004</li>
</ol>
<h3 id="课程发布-1"><a href="#课程发布-1" class="headerlink" title="课程发布"></a>课程发布</h3><h4 id="需求分析-3"><a href="#需求分析-3" class="headerlink" title="需求分析"></a>需求分析</h4><p>教学机构审核通过后即可发布课程，课程发布后公开展示在网站供学生查看，选课，学习</p>
<p>在网站展示课程信息需要解决课程信息显示的性能问题，如果速度慢会影响用户体验</p>
<p>如何<strong>快速搜索课程</strong>?</p>
<p>打开课程详情页面仍然查询数据库可行吗？太慢了</p>
<p>为了提高网站的速度需要将课程信息进行缓存，并将课程信息加入索引库方便搜索，下面展示课程发布后课程信息流转情况：</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222212746420.png" srcset="/img/loading.gif" lazyload alt="image-20231222212746420" style="zoom:67%;" />

<ol>
<li>向内容管理数据库的课程发布表存储课程发布信息，更新课程基本信息表的发布状态为已发布</li>
<li>向Redis存储课程缓存信息</li>
<li>向Elasticsearch存储课程索引信息</li>
<li>请求分布文件系统存储课程静态化页面（minio存html页面），实现快速浏览课程详情页面</li>
</ol>
<p>课程发布表的数据来源于课程预发布表，他们的结构基本一样，只是课程发布表中的<strong>状态</strong>是课程发布状态</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222213153997.png" srcset="/img/loading.gif" lazyload alt="image-20231222213153997"></p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222213043022.png" srcset="/img/loading.gif" lazyload alt="image-20231222213043022"></p>
<p>redis中的课程缓存信息是将课程发布表中的数据转json进行存储</p>
<p>es 中的课程索引信息是根据课程搜索需要将课程名称，课程介绍等信息进行<strong>索引存储</strong></p>
<p>minio 中存储了课程的静态化页面文件（html页面），查看课程详情通过文件系统去浏览课程详情页面</p>
<h4 id="分布式事务技术"><a href="#分布式事务技术" class="headerlink" title="分布式事务技术"></a>分布式事务技术</h4><h5 id="分布式事务"><a href="#分布式事务" class="headerlink" title="分布式事务"></a>分布式事务</h5><p>一次课程发布操作需要向 DB  redis es minio写4份数据， 这里存在分布式事务问题</p>
<blockquote>
<p><strong>本地事务</strong></p>
<p>平常我们在程序中通过spring去控制事务是利用数据库本身的事务特性实现，因此叫数据库事务，由于应用主要靠关系数据库来控制事务，此数据库只属于该应用，所以基于本应用自己的关系型数据库的事务又称为本地事务</p>
<p>本地事务具有ACID特性，数据库事务在实现时将一次事务涉及的所有操作全部纳入一个不可分割的执行单元，该执行单元所有操作要么成功，要么失败，只要其中任何一个操作失败，将会导致整个事务回滚</p>
<p><strong>分布式事务</strong></p>
<p>现在需求是课程发布操作后将数据写入数据库，redis，es，minio 4个地方，这些不限制在一个数据库中，由4个分散的服务去提供，与4个服务去通信需要网络通信，而网络存在不可到达型，这种分布式系统环境下，通过与不同的服务进行网络通信去完成事务称之为 <strong>分布式事务</strong></p>
<p>在分布式系统中分布式事务的场景很多：</p>
<p>例如用户注册送积分，银行转账，创建订单减库存，这些都是分布式事务。</p>
<p>拿转账举例：</p>
<p>我们知道本地事务依赖数据库本身提供的事务特性来实现，因此以下逻辑可以控制本地事务： </p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arduino">Java<br>begin transaction； <br><span class="hljs-comment">//1.本地数据库操作：张三减少金额 </span><br><span class="hljs-comment">//2.本地数据库操作：李四增加金额 </span><br>commit transation; <br><br></code></pre></td></tr></table></figure>

<p>但是在分布式环境下，会变成下边这样：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arduino">begin transaction； <br><span class="hljs-comment">//1.本地数据库操作：张三减少金额 </span><br><span class="hljs-comment">//2.远程调用：让李四增加金额 </span><br><br>commit transation;<br></code></pre></td></tr></table></figure>

<p>当远程调用让李四增加金额成功了，由于网络问题远程调用并没有返回，此时本地事务提交失败就回滚了张三减少金额的操作，此时张三和李四的数据就不一致了。 </p>
<p>因此在分布式架构的基础上，传统数据库事务就无法使用了，张三和李四的账户不在一个数据库中甚至不在一个应 用系统里，实现转账事务需要通过远程调用，由于网络问题就会导致分布式事务问题。 </p>
<p>下边的场景都会产生分布式事务：</p>
<p>微服务架构下</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222214407627.png" srcset="/img/loading.gif" lazyload alt="image-20231222214407627" style="zoom:50%;" />

<p>单服务多数据库</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222214431593.png" srcset="/img/loading.gif" lazyload alt="image-20231222214431593" style="zoom:50%;" />

<p>多服务单数据库</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222215148988.png" srcset="/img/loading.gif" lazyload alt="image-20231222215148988" style="zoom:50%;" />


</blockquote>
<h5 id="CAP-理论"><a href="#CAP-理论" class="headerlink" title="CAP 理论"></a>CAP 理论</h5><p>控制分布式事务首先需要理解CAP理论</p>
<p>CAP是Consistency、Availability、Partition tolerance三个词语的缩写，分别表示一致性、可用性、分区容忍性。</p>
<p>使用下边的分布式系统结构 进行说明：</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222215910507.png" srcset="/img/loading.gif" lazyload alt="image-20231222215910507" style="zoom:50%;" />

<p>客户端经过网关访问用户服务的两个节点：</p>
<p>一致性是指用户不管访问哪一个节点拿到的<strong>数据都是最新的</strong>，比如查询小明的信息，不能出现<strong>数据没有改变</strong>的情况两次查询结果不一样</p>
<p>可用性是指任何时候查询用户信息可以查询到结果，但不保证查询到最新的数据（可以用）</p>
<p>分区容忍性也叫分区容错型，当系统采用分布式架构时由于网络通信异常导致请求中断，消息丢失，但系统依然对外提供服务</p>
<p>CAP 理论强调的是分布式系统这三点不可能全部满足，由于是分布式系统就要满足分区容忍性，因为服务之间难免出现网络异常，不能因为局部网络异常导致整个系统不可用</p>
<p>满足P那么C和A不能同时满足</p>
<p>比如我们添加一个用户小明的信息，该信息先添加到结点1中，再同步到结点2中，如下图：</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222220637768.png" srcset="/img/loading.gif" lazyload alt="image-20231222220637768" style="zoom:50%;" />

<p>如果要满足C一致型， 必须等待小明信息同步完成，系统才可用，否则会出现请求到节点2时查不到数据，违反了一致性，在信息同步过程中系统是不可用的，所以满足C的同时无法满足A</p>
<p>如果要满足A可用性，必须时刻保证系统可用就不用等待信息同步完成，此时系统的一致型无法满足</p>
<p>所以在分布式系统中进行分布式事务控制，要么保证CP，要么保证AP</p>
<h5 id="分布式事务控制方案"><a href="#分布式事务控制方案" class="headerlink" title="分布式事务控制方案"></a>分布式事务控制方案</h5><p>学习了CAP理论应如何控制分布式事务？</p>
<p>在C和A做出取舍，保证一致性就不要保证可用性，保证可用性就不要保证一致，首先你确认是要CP还是AP，具体要根据应用场景进行判断  <strong>CP  or  AP</strong></p>
<p>CP 的场景： 满足C舍弃A，强调一致性</p>
<p>跨行转账：一次转账请求要等待双方银行系统都完成整个事务才算完成，只要其中一个失败另一方执行回滚操作。</p>
<p>开户操作：在业务系统开户同时要在运营商开户，任何一方开户失败该用户都不可使用，所以要满足CP。</p>
<p>AP的场景：满足A舍弃C，强调可用性</p>
<p>订单退款，今日退款成功，明日账户到账，只要用户可以接受在一定时间内到账即可。</p>
<p>注册送积分，注册成功积分在24分到账。</p>
<p>支付短信通信，支付成功发短信，短信发送可以有延迟，甚至没有发送成功。</p>
<p>在实际应用中符合AP的场景较多，其实虽然AP舍弃C一致性，实际上最终数据还是达到了一致，也就满足了最终一致性，所以业界定义了<strong>BASE理论</strong>。</p>
<blockquote>
<p>BASE 理论</p>
<p>Basically Available(基本可用)、Soft state(软状态)和 Eventually consistent (最终一致性)三个短语的缩写</p>
<p>基本可用：当系统无法满足全部可用是保证核心服务可用即可，比如一个外卖系统，每到中午12点左右系统并发量很高，此时要保证下单流程涉及的服务可用，其它服务暂时不可用。</p>
<p>软状态：指可以存在中间状态；比如：打印自己的社保统计情况，该操作不会立即出现结果，而是提示你打印中，请在XXX时间后查收。虽然出现了中间状态，但最终状态是正确的。</p>
<p>最终一致性：退款操作没有及时到账，经过一定时间账户到账，舍弃强一致性，满足最终一致性</p>
</blockquote>
<p>分布式事务控制有哪些常用的技术方案？</p>
<ol>
<li>实现CP就是实现强一致性：</li>
</ol>
<p>使用Seata框架基于AT模式实现</p>
<p>使用Seata框架基于TCC模式实现</p>
<ol start="2">
<li>实现AP则要保证最终数据一致性:</li>
</ol>
<p>使用消息队列通知的方式去实现，通知失败自动重试，达到最大失败次数需要人工处理；</p>
<p>使用任务调度的方案，启动任务调度将课程信息由数据库同步到elasticsearch、MinIO、redis中。</p>
<h5 id="课程发布的事务控制方案"><a href="#课程发布的事务控制方案" class="headerlink" title="课程发布的事务控制方案"></a>课程发布的事务控制方案</h5><p>学习了这么多的理论，回到课程发布，执行课程发布操作后要向数据库、redis、elasticsearch、MinIO写四份数据，这个场景用哪种方案？</p>
<p>满足CP？</p>
<p>如果要满足CP就表示课程发布操作后向数据库、redis、elasticsearch、MinIO写四份数据，只要有一份写失败其它的全部回滚。</p>
<p>满足AP？</p>
<p>课程发布操作后，先更新数据库中的课程发布状态，更新后向redis、elasticsearch、MinIO写课程信息，只要在一定时间内最终向redis、elasticsearch、MinIO写数据成功即可。</p>
<p>目前我们已经有了<strong>任务调度</strong>的技术积累，这里选用任务调度的方案去实现分布式事务控制，课程发布满足AP即可。</p>
<p>下图是具体的技术方案：</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222225745586.png" srcset="/img/loading.gif" lazyload alt="image-20231222225745586" style="zoom:67%;" />

<ol>
<li>在内容管理服务的数据库添加一个<strong>消息表</strong>，消息表和课程发布表在同一个数据库</li>
<li>点击课程发布通过本地事务向课程发布表写入课程发布信息，同时向消息表写入课程发布的消息。通过数据库进行事务控制，只要课程发布表插入成功，则消息表也插入成功，消息表的数据就记录了某门<strong>课程发布的任务</strong></li>
<li>启动任务调度系统定时调度内容管理服务去定时<strong>扫描消息表的记录</strong></li>
<li>当扫描到课程发布的消息即开始向redis es minio<strong>同步数据</strong>的操作</li>
<li>同步数据的任务完成后删除消息表记录</li>
</ol>
<p>时序图如下：</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222230754215.png" srcset="/img/loading.gif" lazyload alt="image-20231222230754215" style="zoom: 50%;" />

<p>1、执行发布操作，内容管理服务存储课程发布表的同时向消息表添加一条“课程发布任务”。这里使用本地事务保证课程发布信息保存成功，同时消息表也保存成功。</p>
<p>2、任务调度服务定时调度内容管理服务扫描消息表，由于课程发布操作后向消息表插入一条课程发布任务，此时扫描到一条任务。</p>
<p>3、拿到任务开始执行任务，分别向redis、elasticsearch及文件系统存储数据。</p>
<p>4、任务完成后删除消息表记录。</p>
<h4 id="课程发布接口"><a href="#课程发布接口" class="headerlink" title="课程发布接口"></a>课程发布接口</h4><h5 id="接口定义-2"><a href="#接口定义-2" class="headerlink" title="接口定义"></a>接口定义</h5><p>根据课程发布的分布式事务控制方案，课程发布操作首先通过本地事务向课程发布表写入课程发布信息并向消息表插入一条消息，这里定义的课程发布接口要实现该功能。</p>
<p>在内容管理接口工程中定义课程发布接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 课程发布</span><br><span class="hljs-meta">@ApiOperation(&quot;课程发布&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@PostMapping(&quot;/coursepublish/&#123;courseId&#125;&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">coursepublish</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;courseId&quot;)</span> Long courseId)</span> &#123;<br>    <span class="hljs-type">Long</span> <span class="hljs-variable">companyId</span> <span class="hljs-operator">=</span> <span class="hljs-number">1232141425L</span>;<br>    coursePublishService.publish(companyId, courseId);<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="DAO-开发"><a href="#DAO-开发" class="headerlink" title="DAO 开发"></a>DAO 开发</h5><p>课程发布对数据库操作：</p>
<ol>
<li>向数据发布表course_publish插入一条记录， 记录来源于课程预发布表，如果存在则更新，发布状态为：已发布</li>
<li>更新course_base表的课程发布状态为：已发布</li>
<li>删除课程预发布表的对应记录</li>
<li>向mq_message消息表插入消息，消息类型: course_publish</li>
</ol>
<p>约束：</p>
<ol>
<li>课程审核通过方可发布</li>
<li>本机构只允许发布本机构的课程</li>
</ol>
<p>以上功能使用自动生成的mapper接口即可完成</p>
<p>1、在内容管理数据库创建mq_message消息表及消息历史消息表（历史表存储已经完成的消息）。</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222232839207.png" srcset="/img/loading.gif" lazyload alt="image-20231222232839207" style="zoom:50%;" />

<p>消息表记录如下：</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231222232921975.png" srcset="/img/loading.gif" lazyload alt="image-20231222232921975"></p>
<p>2、生成mq_message消息表、course_publish课程发布表的po和mapper接口</p>
<p>稍后会开发一个通用的消息处理组件，这里先不生成代码。</p>
<h5 id="Service开发"><a href="#Service开发" class="headerlink" title="Service开发"></a>Service开发</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//课程发布</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publish</span><span class="hljs-params">(Long companyId, Long courseId)</span> &#123;<br>    <span class="hljs-comment">//约束校验</span><br>    <span class="hljs-comment">//查询课程预发布表</span><br>    <span class="hljs-type">CoursePublishPre</span> <span class="hljs-variable">coursePublishPre</span> <span class="hljs-operator">=</span> coursePublishPreMapper.selectById(courseId);<br>    <span class="hljs-keyword">if</span>(coursePublishPre == <span class="hljs-literal">null</span>)&#123;<br>        XueChengPlusException.cast(<span class="hljs-string">&quot;请先提交课程审核，审核通过才可以发布&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">//本机构只允许提交本机构的课程</span><br>    <span class="hljs-keyword">if</span>(!coursePublishPre.getCompanyId().equals(companyId))&#123;<br>        XueChengPlusException.cast(<span class="hljs-string">&quot;不允许提交其它机构的课程。&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//课程审核状态</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">auditStatus</span> <span class="hljs-operator">=</span> coursePublishPre.getStatus();<br>    <span class="hljs-comment">//审核通过方可发布</span><br>    <span class="hljs-keyword">if</span>(!<span class="hljs-string">&quot;202004&quot;</span>.equals(auditStatus))&#123;<br>        XueChengPlusException.cast(<span class="hljs-string">&quot;操作失败，课程审核通过方可发布。&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//保存课程发布信息</span><br>    saveCoursePublish(courseId);<br><br>    <span class="hljs-comment">//保存消息表</span><br>    saveCoursePublishMessage(courseId);<br><br>    <span class="hljs-comment">//删除课程预发布表对应记录</span><br>    coursePublishPreMapper.deleteById(courseId);<br>&#125;<br><br><span class="hljs-comment">//保存课程发布信息</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveCoursePublish</span><span class="hljs-params">(Long courseId)</span> &#123;<br>    <span class="hljs-comment">//整合课程发布信息</span><br>    <span class="hljs-comment">//查询课程预发布表</span><br>    <span class="hljs-type">CoursePublishPre</span> <span class="hljs-variable">coursePublishPre</span> <span class="hljs-operator">=</span> coursePublishPreMapper.selectById(courseId);<br>    <span class="hljs-keyword">if</span> (coursePublishPre==<span class="hljs-literal">null</span>)&#123;<br>        XueChengPlusException.cast(<span class="hljs-string">&quot;课程预发布数据为空&quot;</span>);<br>    &#125;<br>    <span class="hljs-type">CoursePublish</span> <span class="hljs-variable">coursePublish</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CoursePublish</span>();<br>    BeanUtils.copyProperties(coursePublishPre, coursePublish);<br>    coursePublish.setStatus(<span class="hljs-string">&quot;203002&quot;</span>);<br>    <span class="hljs-type">CoursePublish</span> <span class="hljs-variable">coursePublishUpdate</span> <span class="hljs-operator">=</span> coursePublishMapper.selectById(courseId);<br>    <span class="hljs-keyword">if</span> (coursePublishUpdate==<span class="hljs-literal">null</span>)&#123;<br>        coursePublishMapper.insert(coursePublish);<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        coursePublishMapper.updateById(coursePublish);<br>    &#125;<br>    <span class="hljs-comment">//更新课程基本表的发布状态</span><br>    <span class="hljs-type">CourseBase</span> <span class="hljs-variable">courseBase</span> <span class="hljs-operator">=</span> courseBaseMapper.selectById(courseId);<br>    courseBase.setStatus(<span class="hljs-string">&quot;203002&quot;</span>);<br>    courseBaseMapper.updateById(courseBase);<br><br>&#125;<br><br><span class="hljs-comment">//保存消息表</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveCoursePublishMessage</span><span class="hljs-params">(Long courseId)</span> &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h5><p>httpclient测试</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs clean">Java<br>### 课程发布<br>POST &#123;&#123;content_host&#125;&#125;/content/coursepublish/<span class="hljs-number">2</span><br><br></code></pre></td></tr></table></figure>

<p>先测试约束条件：</p>
<p>1、在未提交审核时进行课程发布测试。</p>
<p>2、在课程未审核通过时进行发布。</p>
<p>正常流程测试：</p>
<p>1、提交审核课程</p>
<p>2、手动修改课程预发布表与课程基本信息的审核状态为审核通过。</p>
<p>3、执行课程发布</p>
<p>4、观察课程发布表记录是否正常，课程预发布表记录已经删除，课程基本信息表与课程发布表的发布状态为”发布“。</p>
<p>使用前后端联调方式测试。</p>
<h4 id="消息处理SDK"><a href="#消息处理SDK" class="headerlink" title="消息处理SDK"></a>消息处理SDK</h4><h5 id="消息处理模块技术方案"><a href="#消息处理模块技术方案" class="headerlink" title="消息处理模块技术方案"></a>消息处理模块技术方案</h5><p>课程发布操作执行后需要扫描消息表的记录，有关消息表处理的有哪些？</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223104855659.png" srcset="/img/loading.gif" lazyload alt="image-20231223104855659"  />

<p>上图中红框都是与消息处理相关的操作</p>
<ol>
<li>新增消息表</li>
<li>扫描消息表</li>
<li>更新消息表</li>
<li>删除消息表</li>
</ol>
<p>使用<strong>消息表</strong>这种方式实现<strong>最终事务一致性</strong>的地方除了课程发布还有其他业务场景</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223105105645.png" srcset="/img/loading.gif" lazyload alt="image-20231223105105645" style="zoom:50%;" />

<p>如果在每个地方都实现一套针对消息表定时扫描，处理的逻辑基本是重复的，软件的可复用性低，成本太高。</p>
<p>如何解决这个问题？</p>
<p>将消息处理相关的逻辑做成一个通用的东西，做成通用的服务还是通用的代码组件？</p>
<p>通用的服务是完成一个通用的独立功能，并提供独立的网络接口，比如：项目中的文件系统服务，提供文件的分布式存储服务。</p>
<p>代码组件也是完成一个通用的独立功能，通常提供API方式供外部系统使用，比如：fastjson Apache commons工具包等。</p>
<p>如果将消息处理做成一个通用的服务，该服务需要连接多个数据库，因为它要扫描微服务数据库下的消息表，并要提供与微服务通信的网络接口，单针对当前需求而言开发成本有点高</p>
<p>如果将消息处理做成一个SDK工具包相比通用服务不仅可以解决将消息处理通用化的需求，还可以降低成本</p>
<p>所以，本项目确定将对消息表相关的处理做成一个SDK组件供各微服务使用,如下图</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223105809135.png" srcset="/img/loading.gif" lazyload alt="image-20231223105809135" style="zoom:50%;" />

<p>下边对消息SDK的设计内容进行说明：</p>
<p><strong>sdk需要提供执行任务逻辑吗？</strong></p>
<p>拿课程发布任务举例，执行课程发布任务向redis，索引库等同步数据，其他任务的<strong>执行逻辑不同</strong>，所以执行任务在sdk中不用实现任务逻辑，只需要提供一个<strong>抽象方法</strong>由具体的执行任务方法去实现</p>
<p><strong>如何保证任务的幂等性？</strong></p>
<p>在视频处理章节介绍的视频处理的幂等性方案，这里可以采用类似方案，任务执行完成后<strong>从消息表删除</strong>，如果<strong>消息的状态是完成或不存在消息表中</strong>则不用执行</p>
<p><strong>如何保证任务不重复执行？</strong></p>
<p>采用和视频处理章节一致方案，除了保证任务的幂等性外，任务调度采用分片广播，根据分片参数去获取任务，另外阻塞调度策略为丢弃任务。</p>
<p>注意：这里是信息同步类任务，即使任务重复执行也没有关系，不再使用抢占任务的方式保证任务不重复执行。</p>
<p>另外，根据消息表记录是否存在或消息表中任务状态去保证任务的幂等性，如果一个任务由好几个小任务，比如：课程发布任务需要执行三个同步操作：存储课程到redis，存储课程到索引库，存储课程页面到文件系统。如果其中一个小任务已经完成也不应该去重复执行。这里如何设计？</p>
<p>将小任务作为任务的不同阶段，在消息表中设计阶段状态：</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223121811000.png" srcset="/img/loading.gif" lazyload alt="image-20231223121811000"></p>
<p>每完成一个阶段在相应的阶段状态字段打上完成标记，即使这个大任务没有完成再重新执行时，如果小阶段任务完成了也不会重复执行某个小阶段的任务</p>
<p>综上所述，除了消息表的增删改查功能外，消息SDK还具有如下接口功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs java">Java<br><span class="hljs-keyword">package</span> com.xuecheng.messagesdk.service;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;<br><span class="hljs-keyword">import</span> com.xuecheng.messagesdk.model.po.MqMessage;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * &lt;p&gt;</span><br><span class="hljs-comment"> *  服务类</span><br><span class="hljs-comment"> * &lt;/p&gt;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 2022-09-21</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MqMessageService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;MqMessage&gt; &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@description</span> 扫描消息表记录，采用与扫描视频处理表相同的思路</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shardIndex 分片序号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shardTotal 分片总数</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> count 扫描记录数</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> java.util.List 消息记录</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@date</span> 2022/9/21 18:55</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> List&lt;MqMessage&gt; <span class="hljs-title function_">getMessageList</span><span class="hljs-params">(<span class="hljs-type">int</span> shardIndex, <span class="hljs-type">int</span> shardTotal,  String messageType,<span class="hljs-type">int</span> count)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@description</span> 完成任务</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id 消息id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> int 更新成功：1</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@date</span> 2022/9/21 20:49</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">completed</span><span class="hljs-params">(<span class="hljs-type">long</span> id)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@description</span> 完成阶段任务</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id 消息id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> int 更新成功：1</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@date</span> 2022/9/21 20:49</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">completedStageOne</span><span class="hljs-params">(<span class="hljs-type">long</span> id)</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">completedStageTwo</span><span class="hljs-params">(<span class="hljs-type">long</span> id)</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">completedStageThree</span><span class="hljs-params">(<span class="hljs-type">long</span> id)</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">completedStageFour</span><span class="hljs-params">(<span class="hljs-type">long</span> id)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@description</span> 查询阶段状态</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> int</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@date</span> 2022/9/21 20:54</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getStageOne</span><span class="hljs-params">(<span class="hljs-type">long</span> id)</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getStageTwo</span><span class="hljs-params">(<span class="hljs-type">long</span> id)</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getStageThree</span><span class="hljs-params">(<span class="hljs-type">long</span> id)</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getStageFour</span><span class="hljs-params">(<span class="hljs-type">long</span> id)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>消息SDK提供消息处理抽象类，此抽象类使用方法继承使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs java">Java<br><span class="hljs-keyword">package</span> com.xuecheng.messagesdk.service;<br><br><span class="hljs-keyword">import</span> com.xuecheng.messagesdk.model.po.MqMessage;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.concurrent.*;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span> 消息处理抽象类</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022/9/21 19:44</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageProcessAbstract</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    MqMessageService mqMessageService;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> mqMessage 执行任务内容</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> boolean true:处理成功，false处理失败</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@description</span> 任务处理</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@date</span> 2022/9/21 19:47</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(MqMessage mqMessage)</span>;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@description</span> 扫描消息表多线程执行任务</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shardIndex 分片序号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shardTotal 分片总数</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> messageType  消息类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> count  一次取出任务总数</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> timeout 预估任务执行时间,到此时间如果任务还没有结束则强制结束 单位秒</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@date</span> 2022/9/21 20:35</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(<span class="hljs-type">int</span> shardIndex, <span class="hljs-type">int</span> shardTotal,  String messageType,<span class="hljs-type">int</span> count,<span class="hljs-type">long</span> timeout)</span> &#123;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//扫描消息表获取任务清单</span><br>            List&lt;MqMessage&gt; messageList = mqMessageService.getMessageList(shardIndex, shardTotal,messageType, count);<br>            <span class="hljs-comment">//任务个数</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> messageList.size();<br>            log.debug(<span class="hljs-string">&quot;取出待处理消息&quot;</span>+size+<span class="hljs-string">&quot;条&quot;</span>);<br>            <span class="hljs-keyword">if</span>(size&lt;=<span class="hljs-number">0</span>)&#123;<br>                <span class="hljs-keyword">return</span> ;<br>            &#125;<br><br>            <span class="hljs-comment">//创建线程池</span><br>            <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">threadPool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(size);<br>            <span class="hljs-comment">//计数器</span><br>            <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(size);<br>            messageList.forEach(message -&gt; &#123;<br>                threadPool.execute(() -&gt; &#123;<br>                    log.debug(<span class="hljs-string">&quot;开始任务:&#123;&#125;&quot;</span>,message);<br>                    <span class="hljs-comment">//处理任务</span><br>                    <span class="hljs-keyword">try</span> &#123;<br>                        <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> execute(message);<br>                        <span class="hljs-keyword">if</span>(result)&#123;<br>                            log.debug(<span class="hljs-string">&quot;任务执行成功:&#123;&#125;)&quot;</span>,message);<br>                            <span class="hljs-comment">//更新任务状态,删除消息表记录,添加到历史表</span><br>                            <span class="hljs-type">int</span> <span class="hljs-variable">completed</span> <span class="hljs-operator">=</span> mqMessageService.completed(message.getId());<br>                            <span class="hljs-keyword">if</span> (completed&gt;<span class="hljs-number">0</span>)&#123;<br>                                log.debug(<span class="hljs-string">&quot;任务执行成功:&#123;&#125;&quot;</span>,message);<br>                            &#125;<span class="hljs-keyword">else</span>&#123;<br>                                log.debug(<span class="hljs-string">&quot;任务执行失败:&#123;&#125;&quot;</span>,message);<br>                            &#125;<br>                        &#125;<br>                    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                        e.printStackTrace();<br>                        log.debug(<span class="hljs-string">&quot;任务出现异常:&#123;&#125;,任务:&#123;&#125;&quot;</span>,e.getMessage(),message);<br>                    &#125;<br>                    <span class="hljs-comment">//计数</span><br>                    countDownLatch.countDown();<br>                    log.debug(<span class="hljs-string">&quot;结束任务:&#123;&#125;&quot;</span>,message);<br><br>                &#125;);<br>            &#125;);<br><br>            <span class="hljs-comment">//等待,给一个充裕的超时时间,防止无限等待，到达超时时间还没有处理完成则结束任务</span><br>            countDownLatch.await(timeout,TimeUnit.SECONDS);<br>            System.out.println(<span class="hljs-string">&quot;结束....&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>           e.printStackTrace();<br><br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="消息模块SDK测试"><a href="#消息模块SDK测试" class="headerlink" title="消息模块SDK测试"></a>消息模块SDK测试</h5><p>1、在内容管理数据库创建消息表和消息历史表</p>
<p>2、拷贝课程资料中的xuecheng-plus-message-sdk到工程目录，如下图：</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223133359144.png" srcset="/img/loading.gif" lazyload alt="image-20231223133359144" style="zoom:50%;" />

<p>3、修改test下的bootstrap.yml中的数据库连接</p>
<p>下边测试消息SDK的接口：</p>
<p>1、继承MessageProcessAbstract 抽象类编写任务执行方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.messagesdk;<br><br><span class="hljs-keyword">import</span> com.xuecheng.messagesdk.model.po.MqMessage;<br><span class="hljs-keyword">import</span> com.xuecheng.messagesdk.service.MessageProcessAbstract;<br><span class="hljs-keyword">import</span> com.xuecheng.messagesdk.service.MqMessageService;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 消息处理测试类，继承MessageProcessAbstract</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 付广建 2023/12/23 14:25</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageProcessClass</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">MessageProcessAbstract</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    MqMessageService mqMessageService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(MqMessage mqMessage)</span> &#123;<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> mqMessage.getId();<br>        log.debug(<span class="hljs-string">&quot;开始执行任务:&#123;&#125;&quot;</span>,id);<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">5000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br><br>        <span class="hljs-comment">//取出阶段状态</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">stageOne</span> <span class="hljs-operator">=</span> mqMessageService.getStageOne(id);<br>        <span class="hljs-keyword">if</span>(stageOne&lt;<span class="hljs-number">1</span>)&#123;<br>            log.debug(<span class="hljs-string">&quot;开始执行第一阶段任务&quot;</span>);<br>            System.out.println();<br>            <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> mqMessageService.completedStageOne(id);<br>            <span class="hljs-keyword">if</span>(i&gt;<span class="hljs-number">0</span>)&#123;<br>                log.debug(<span class="hljs-string">&quot;完成第一阶段任务&quot;</span>);<br>            &#125;<br><br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            log.debug(<span class="hljs-string">&quot;无需执行第一阶段任务&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>2.编写测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.messagesdk;<br><br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 付广建 2023/12/23 14:27</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageProcessClassTest</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    MessageProcessClass messageProcessClass;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        System.out.println(<span class="hljs-string">&quot;开始执行-----》&quot;</span> + LocalDateTime.now());<br>        messageProcessClass.process(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-number">5</span>, <span class="hljs-number">30</span>);<br>        System.out.println(<span class="hljs-string">&quot;结束执行-----》&quot;</span> + LocalDateTime.now());<br>        Thread.sleep(<span class="hljs-number">9000000</span>);<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>3、准备测试数据，在消息表添加消息类型为”test”的消息</p>
<p>4、执行MessageProcessClassTest 类中的test()方法，观察控制台任务执行的日志信息。</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223143958631.png" srcset="/img/loading.gif" lazyload alt="image-20231223143958631"></p>
<p>mq_message表新建数据，执行程序，运行完成</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223144135450.png" srcset="/img/loading.gif" lazyload alt="image-20231223144135450" style="zoom:50%;" />

<p>mq_message_history</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223144251788.png" srcset="/img/loading.gif" lazyload alt="image-20231223144251788" style="zoom:50%;" />

<p>此时mq_message表数据没了</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223144319705.png" srcset="/img/loading.gif" lazyload alt="image-20231223144319705" style="zoom:50%;" />

<h5 id="集成消息SDK"><a href="#集成消息SDK" class="headerlink" title="集成消息SDK"></a>集成消息SDK</h5><h6 id="添加消息"><a href="#添加消息" class="headerlink" title="添加消息"></a>添加消息</h6><p>1、在内容管理数据库创建消息表和消息历史表</p>
<p>2、拷贝课程资料中的xuecheng-plus-message-sdk到工程目录，如下图：</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223144537156.png" srcset="/img/loading.gif" lazyload alt="image-20231223144537156" style="zoom:50%;" />

<ol start="3">
<li>在content的service模块添加sdk依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xuecheng-plus-message-sdk<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>4、课程发布操作使用本地事务保存课程发布信息、添加消息表</p>
<p>回到编写课程发布时的代码(publish方法)，填充saveCoursePublishMessage(courseId)方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//课程发布</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publish</span><span class="hljs-params">(Long companyId, Long courseId)</span> &#123;<br>    <span class="hljs-comment">//约束校验</span><br>    <span class="hljs-comment">//查询课程预发布表</span><br>    <span class="hljs-type">CoursePublishPre</span> <span class="hljs-variable">coursePublishPre</span> <span class="hljs-operator">=</span> coursePublishPreMapper.selectById(courseId);<br>    <span class="hljs-keyword">if</span>(coursePublishPre == <span class="hljs-literal">null</span>)&#123;<br>        XueChengPlusException.cast(<span class="hljs-string">&quot;请先提交课程审核，审核通过才可以发布&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">//本机构只允许提交本机构的课程</span><br>    <span class="hljs-keyword">if</span>(!coursePublishPre.getCompanyId().equals(companyId))&#123;<br>        XueChengPlusException.cast(<span class="hljs-string">&quot;不允许提交其它机构的课程。&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//课程审核状态</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">auditStatus</span> <span class="hljs-operator">=</span> coursePublishPre.getStatus();<br>    <span class="hljs-comment">//审核通过方可发布</span><br>    <span class="hljs-keyword">if</span>(!<span class="hljs-string">&quot;202004&quot;</span>.equals(auditStatus))&#123;<br>        XueChengPlusException.cast(<span class="hljs-string">&quot;操作失败，课程审核通过方可发布。&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//保存课程发布信息</span><br>    saveCoursePublish(courseId);<br><br>    <span class="hljs-comment">//保存消息表</span><br>    saveCoursePublishMessage(courseId);<br><br>    <span class="hljs-comment">//删除课程预发布表对应记录</span><br>    coursePublishPreMapper.deleteById(courseId);<br>&#125;<br><br><span class="hljs-comment">//保存课程发布信息</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveCoursePublish</span><span class="hljs-params">(Long courseId)</span> &#123;<br>    <span class="hljs-comment">//整合课程发布信息</span><br>    <span class="hljs-comment">//查询课程预发布表</span><br>    <span class="hljs-type">CoursePublishPre</span> <span class="hljs-variable">coursePublishPre</span> <span class="hljs-operator">=</span> coursePublishPreMapper.selectById(courseId);<br>    <span class="hljs-keyword">if</span> (coursePublishPre==<span class="hljs-literal">null</span>)&#123;<br>        XueChengPlusException.cast(<span class="hljs-string">&quot;课程预发布数据为空&quot;</span>);<br>    &#125;<br>    <span class="hljs-type">CoursePublish</span> <span class="hljs-variable">coursePublish</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CoursePublish</span>();<br>    BeanUtils.copyProperties(coursePublishPre, coursePublish);<br>    coursePublish.setStatus(<span class="hljs-string">&quot;203002&quot;</span>);<br>    <span class="hljs-type">CoursePublish</span> <span class="hljs-variable">coursePublishUpdate</span> <span class="hljs-operator">=</span> coursePublishMapper.selectById(courseId);<br>    <span class="hljs-keyword">if</span> (coursePublishUpdate==<span class="hljs-literal">null</span>)&#123;<br>        coursePublishMapper.insert(coursePublish);<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        coursePublishMapper.updateById(coursePublish);<br>    &#125;<br>    <span class="hljs-comment">//更新课程基本表的发布状态</span><br>    <span class="hljs-type">CourseBase</span> <span class="hljs-variable">courseBase</span> <span class="hljs-operator">=</span> courseBaseMapper.selectById(courseId);<br>    courseBase.setStatus(<span class="hljs-string">&quot;203002&quot;</span>);<br>    courseBaseMapper.updateById(courseBase);<br><br>&#125;<br><br><span class="hljs-comment">//保存消息表</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveCoursePublishMessage</span><span class="hljs-params">(Long courseId)</span> &#123;<br>    <span class="hljs-type">MqMessage</span> <span class="hljs-variable">mqMessage</span> <span class="hljs-operator">=</span> mqMessageService<br>            .addMessage(<span class="hljs-string">&quot;course_publish&quot;</span>, String.valueOf(courseId), <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>    <span class="hljs-keyword">if</span> (mqMessage==<span class="hljs-literal">null</span>)&#123;<br>        XueChengPlusException.cast(CommonError.UNKOWN_ERROR);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h6 id="课程发布任务处理"><a href="#课程发布任务处理" class="headerlink" title="课程发布任务处理"></a>课程发布任务处理</h6><p>0.0 在内容管理服务添加消息处理sdk的依赖即可使用它，实现sdk中的MessageProcessAbstract类，重写execte方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.content.service.jobhandler;<br><br><span class="hljs-keyword">import</span> com.xuecheng.messagesdk.model.po.MqMessage;<br><span class="hljs-keyword">import</span> com.xuecheng.messagesdk.service.MessageProcessAbstract;<br><span class="hljs-keyword">import</span> com.xuecheng.messagesdk.service.MqMessageService;<br><span class="hljs-keyword">import</span> com.xxl.job.core.context.XxlJobHelper;<br><span class="hljs-keyword">import</span> com.xxl.job.core.handler.annotation.XxlJob;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 付广建 2023/12/23 15:06</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CoursePublishTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">MessageProcessAbstract</span> &#123;<br><br>    <br>    <span class="hljs-comment">// 课程发布任务处理,如果此方法抛出异常,说明此任务执行失败</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(MqMessage mqMessage)</span> &#123;<br>        <span class="hljs-comment">// 获取消息相关的业务信息 - businessKey1 - courseId课程id</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">businessKey1</span> <span class="hljs-operator">=</span> mqMessage.getBusinessKey1();<br>        <span class="hljs-type">long</span> <span class="hljs-variable">courseId</span> <span class="hljs-operator">=</span> Long.parseLong(businessKey1);<br><br>        <span class="hljs-comment">// 课程静态化</span><br>        generateCourseHtml(mqMessage, courseId);<br><br>        <span class="hljs-comment">// 课程索引</span><br>        saveCourseIndex(mqMessage, courseId);<br><br>        <span class="hljs-comment">// 课程缓存</span><br>        saveCourseCache(mqMessage, courseId);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 向 redis 写入课程缓存</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveCourseCache</span><span class="hljs-params">(MqMessage mqMessage, <span class="hljs-type">long</span> courseId)</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-comment">// 向es课程写索引数据</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveCourseIndex</span><span class="hljs-params">(MqMessage mqMessage, <span class="hljs-type">long</span> courseId)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;开始向es课程写索引数据,课程id:&#123;&#125;&quot;</span>, courseId);<br>        <span class="hljs-comment">// 消息id</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> mqMessage.getId();<br>        <span class="hljs-comment">// 消息处理的service</span><br>        <span class="hljs-type">MqMessageService</span> <span class="hljs-variable">mqMessageService</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getMqMessageService();<br>        <span class="hljs-comment">// 消息幂等性处理  -&gt; 阶段1处理状态, 0:初始，1:成功</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">stageTwo</span> <span class="hljs-operator">=</span> mqMessageService.getStageTwo(id);<br>        <span class="hljs-keyword">if</span> (stageTwo &gt; <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// 1 成功,不处理</span><br>            log.debug(<span class="hljs-string">&quot;课程索引信息已经写入,无需执行...,课程id:&#123;&#125;&quot;</span>, courseId);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-comment">// 查询课程信息,调用搜索服务添加索引...</span><br><br>        <span class="hljs-comment">// 保存第2阶段状态(完成)</span><br>        mqMessageService.completedStageTwo(id);<br>        <br>        <br>    &#125;<br><br>    <span class="hljs-comment">// 生成课程静态化页面并上传到文件系统minio</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">generateCourseHtml</span><span class="hljs-params">(MqMessage mqMessage, <span class="hljs-type">long</span> courseId)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;开始进行课程静态化,课程id:&#123;&#125;&quot;</span>, courseId);<br>        <span class="hljs-comment">// 消息id</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> mqMessage.getId();<br>        <span class="hljs-comment">// 消息处理的service</span><br>        <span class="hljs-type">MqMessageService</span> <span class="hljs-variable">mqMessageService</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getMqMessageService();<br>        <span class="hljs-comment">// 消息幂等性处理  -&gt; 阶段1处理状态, 0:初始，1:成功</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">stageOne</span> <span class="hljs-operator">=</span> mqMessageService.getStageOne(id);<br>        <span class="hljs-keyword">if</span> (stageOne &gt; <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// 1 成功,不处理</span><br>            log.debug(<span class="hljs-string">&quot;课程静态化已处理直接返回,课程id:&#123;&#125;&quot;</span>, courseId);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-comment">//开始进行课程静态化</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> / <span class="hljs-number">0</span>; <span class="hljs-comment">//制造一个异常表示任务执行有问题</span><br><br>        <span class="hljs-comment">//保存第一阶段状态(完成)</span><br>        mqMessageService.completedStageOne(id);<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>0.5   content-service模块加入xxl-job依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- xxl_job 任务调度 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuxueli<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xxl-job-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>1  在nacos中在content-service-dev.yaml中配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs YAML"><span class="hljs-attr">xxl:</span><br>  <span class="hljs-attr">job:</span><br>    <span class="hljs-attr">admin:</span> <br>      <span class="hljs-attr">addresses:</span> <span class="hljs-string">http://192.168.101.65:8088/xxl-job-admin</span><br>    <span class="hljs-attr">executor:</span><br>      <span class="hljs-attr">appname:</span> <span class="hljs-string">coursepublish-job</span><br>      <span class="hljs-attr">address:</span> <br>      <span class="hljs-attr">ip:</span> <br>      <span class="hljs-attr">port:</span> <span class="hljs-number">8999</span><br>      <span class="hljs-attr">logpath:</span> <span class="hljs-string">/data/applogs/xxl-job/jobhandler</span><br>      <span class="hljs-attr">logretentiondays:</span> <span class="hljs-number">30</span><br>    <span class="hljs-attr">accessToken:</span> <span class="hljs-string">default_token</span><br></code></pre></td></tr></table></figure>

<p>2、从媒资管理服务层工程中拷贝一个XxlJobConfig配置类到内容管理service工程中</p>
<p>在xxl-job-admin控制台中添加执行器</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223162502680.png" srcset="/img/loading.gif" lazyload alt="image-20231223162502680"></p>
<p>3、编写任务调度入口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 任务调度入口</span><br><span class="hljs-meta">@XxlJob(&quot;CoursePublishJobHandler&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">coursePublishJobHandler</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">// 分片参数</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">shardIndex</span> <span class="hljs-operator">=</span> XxlJobHelper.getShardIndex();<span class="hljs-comment">//执行器序号 before 0</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">shardTotal</span> <span class="hljs-operator">=</span> XxlJobHelper.getShardTotal();<span class="hljs-comment">//执行器总数</span><br>	log.debug(<span class="hljs-string">&quot;shardIndex=&quot;</span>+shardIndex+<span class="hljs-string">&quot;,shardTotal=&quot;</span>+shardTotal);<span class="hljs-comment">//参数:分片序号、分片总数、消息类型、一次最多取到的任务数量、一次任务调度执行的超时时间</span><br><br>    <span class="hljs-comment">// 调用抽象类方法执行任务 - 处理30个, 任务有问题等待60秒</span><br>    process(shardIndex, shardTotal, <span class="hljs-string">&quot;course_publish&quot;</span>, <span class="hljs-number">30</span>, <span class="hljs-number">60</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>4、在xxl-job添加任务</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223162706043.png" srcset="/img/loading.gif" lazyload alt="image-20231223162706043"></p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223162719752.png" srcset="/img/loading.gif" lazyload alt="image-20231223162719752"></p>
<p>5 .  数据库制造假数据</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223162749215.png" srcset="/img/loading.gif" lazyload alt="image-20231223162749215"></p>
<p>执行到课程静态化的除以0异常时，显示日志</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223162857611.png" srcset="/img/loading.gif" lazyload alt="image-20231223162857611"></p>
<p>到此SDK开发、集成完成，下一步添加课程发布后<strong>页面静态化、课程缓存、课程索引</strong>等任务。</p>
<h4 id="页面静态化"><a href="#页面静态化" class="headerlink" title="页面静态化"></a>页面静态化</h4><p>根据课程发布的操作流程，执行课程发布后要将课程详情信息页面<strong>静态化</strong>，生成html页面上传至文件系统</p>
<blockquote>
<p><strong>什么是页面静态化？</strong></p>
<p>课程预览功能通过模板引擎技术在页面模板中填充数据，生成html页面，这个过程是当客户端请求服务器时服务器才开始渲染生成html页面，最后响应给浏览器，服务端渲染的并发能力是有限的</p>
<p>页面静态化则强调将生成html页面的过程提前，提前使用模板引擎技术生成html页面，当客户端请求时直接请求html页面，由于静态页面可以使用nginx apache等高性能web服务器，并发性能高</p>
<p><strong>什么时候使用页面静态化技术？</strong></p>
<p>当数据变化不频繁，一旦生成静态页面很长时间内很少变化，此时可以使用页面静态化，因为如果数据变化频繁，一旦改变就需要重新生成静态页面，导致维护静态页面工作量变大</p>
<p>根据课程发布的业务需求，虽然课程发布后仍可以修改课程信息，但需要经过课程审核，且修改额度不大，所以适合使用页面静态化</p>
</blockquote>
<h4 id="静态化测试"><a href="#静态化测试" class="headerlink" title="静态化测试"></a>静态化测试</h4><p>使用freemarker技术对页面静态化生成html页面</p>
<p>在content-service模块添加freemarker依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml">XML<br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>编写测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.content;<br><br><span class="hljs-keyword">import</span> com.xuecheng.content.model.dto.CoursePreviewDto;<br><span class="hljs-keyword">import</span> com.xuecheng.content.service.CoursePublishService;<br><span class="hljs-keyword">import</span> freemarker.template.Configuration;<br><span class="hljs-keyword">import</span> freemarker.template.Template;<br><span class="hljs-keyword">import</span> org.apache.commons.io.IOUtils;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><span class="hljs-keyword">import</span> org.springframework.ui.freemarker.FreeMarkerTemplateUtils;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * freemarker测试</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 付广建 2023/12/23 16:58</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FreemarkerTest</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    CoursePublishService coursePublishService;<br><br>    <span class="hljs-comment">//测试页面静态化</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGenerateHtmlByTemplate</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-comment">//配置freemarker</span><br>        <span class="hljs-type">Configuration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>(Configuration.getVersion());<br><br>        <span class="hljs-comment">//加载模板</span><br>        <span class="hljs-comment">//选指定模板路径,classpath下的templates下</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getClass().getResource(<span class="hljs-string">&quot;/&quot;</span>).getPath();<br>        configuration.setDirectoryForTemplateLoading(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(path + <span class="hljs-string">&quot;/templates/&quot;</span>));<br>        <span class="hljs-comment">//设置字符编码</span><br>        configuration.setDefaultEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);<br><br>        <span class="hljs-comment">//设置模板文件名称</span><br>        <span class="hljs-type">Template</span> <span class="hljs-variable">template</span> <span class="hljs-operator">=</span> configuration.getTemplate(<span class="hljs-string">&quot;course_template.ftl&quot;</span>);<br>        <span class="hljs-comment">//准备数据 from DB</span><br>        <span class="hljs-type">CoursePreviewDto</span> <span class="hljs-variable">coursePreviewInfo</span> <span class="hljs-operator">=</span> coursePublishService.getCoursePreviewInfo(<span class="hljs-number">2L</span>);<br><br>        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;model&quot;</span>, coursePreviewInfo); <span class="hljs-comment">// 向模板填充数据</span><br><br>        <span class="hljs-comment">//静态化</span><br>        <span class="hljs-comment">//参数1: 模板, 参数2: 数据模型</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> FreeMarkerTemplateUtils.processTemplateIntoString(template, map);<br>        System.out.println(<span class="hljs-string">&quot;静态化内容   ===============   =&gt;&quot;</span>);<br>        System.out.println(content);<br><br>        <span class="hljs-comment">//将静态化内容输出到文件中</span><br>        <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> IOUtils.toInputStream(content);<br>        <span class="hljs-comment">//输出流</span><br>        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;D:\\develop\\test.html&quot;</span>);<br>        IOUtils.copy(inputStream,outputStream);<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>目录结构</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223171201518.png" srcset="/img/loading.gif" lazyload alt="image-20231223171201518" style="zoom:50%;" />

<p>执行测试方法，观察D:\develop\test.html 是否成功生成</p>
<p>生成文件</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223171216094.png" srcset="/img/loading.gif" lazyload alt="image-20231223171216094" style="zoom:50%;" />

<h4 id="上传文件测试"><a href="#上传文件测试" class="headerlink" title="上传文件测试"></a>上传文件测试</h4><h5 id="配置远程调用环境"><a href="#配置远程调用环境" class="headerlink" title="配置远程调用环境"></a>配置远程调用环境</h5><p>静态化生成的文件需要上传至分布式文件系统，根据微服务职责划分，媒资管理服务负责维护文件系统的文件，所以内容管理服务对页面静态化生成html需要调用媒资管理服务的<strong>上传文件接口</strong>， 如图</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223171716839.png" srcset="/img/loading.gif" lazyload alt="image-20231223171716839"></p>
<p>微服务之间难免会有远程调用，在springcloud中可以使用feign进行远程调用</p>
<p>Feign是一个声明式的http客户端  <a target="_blank" rel="noopener" href="https://github.com/OpenFeign/feign">https://github.com/OpenFeign/feign</a></p>
<p>作用： 帮我们优雅的实现http请求的发送， 解决上面跨服务调用接口问题</p>
<ol>
<li>添加依赖（content-service）</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- Feign --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- Spring Cloud 微服务远程调用 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.github.openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>feign-httpclient<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--feign支持Multipart格式传参--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.github.openfeign.form<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>feign-form<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.github.openfeign.form<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>feign-form-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>注意上面加了这个依赖spring-cloud-starter-alibaba-nacos-discovery, 相应的要在本地bootstrapl.yml更改逻辑</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223201446995.png" srcset="/img/loading.gif" lazyload alt="image-20231223201446995" style="zoom:50%;" />

<p>这里我跟着视频才排出这个错</p>
<ol start="2">
<li>nacos中配置feign-dev.yaml 公用配置文件</li>
</ol>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223172615572.png" srcset="/img/loading.gif" lazyload alt="image-20231223172615572"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">feign:</span><br>  <span class="hljs-attr">hystrix:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">circuitbreaker:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">hystrix:</span><br>  <span class="hljs-attr">command:</span><br>    <span class="hljs-attr">default:</span><br>      <span class="hljs-attr">execution:</span><br>        <span class="hljs-attr">isolation:</span><br>          <span class="hljs-attr">thread:</span><br>            <span class="hljs-attr">timeoutInMilliseconds:</span> <span class="hljs-number">30000</span>  <span class="hljs-comment">#熔断超时时间</span><br><span class="hljs-attr">ribbon:</span><br>  <span class="hljs-attr">ConnectTimeout:</span> <span class="hljs-number">60000</span> <span class="hljs-comment">#连接超时时间</span><br>  <span class="hljs-attr">ReadTimeout:</span> <span class="hljs-number">60000</span> <span class="hljs-comment">#读超时时间</span><br>  <span class="hljs-attr">MaxAutoRetries:</span> <span class="hljs-number">0</span> <span class="hljs-comment">#重试次数</span><br>  <span class="hljs-attr">MaxAutoRetriesNextServer:</span> <span class="hljs-number">1</span> <span class="hljs-comment">#切换实例的重试次数</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>在内容管理service工程和内容管理api工程都引入此配置文件</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">shared-configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">data-id:</span> <span class="hljs-string">feign-$&#123;spring.profiles.active&#125;.yaml</span><br>    <span class="hljs-attr">group:</span> <span class="hljs-string">xuecheng-plus-common</span><br>    <span class="hljs-attr">refresh:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>

<ol start="4">
<li>在内容管理service工程配置feign支持Multipart，拷贝课程资料下的MultipartSupportConfig 到content-service工程下的config包下。</li>
</ol>
<h5 id="扩充上传文件接口"><a href="#扩充上传文件接口" class="headerlink" title="扩充上传文件接口"></a>扩充上传文件接口</h5><p>将课程静态文件上传到minio，单独存储到course目录，文件objectname是”课程id.html”，原来的盛传文件接口需要增加一个参数 objectname</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223185858797.png" srcset="/img/loading.gif" lazyload alt="image-20231223185858797"></p>
<p>修改原有uploadFile方法，判断如果objectName为空则采取年月日样式的路径方式。</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223190340405.png" srcset="/img/loading.gif" lazyload alt="image-20231223190340405"></p>
<h5 id="远程调用测试"><a href="#远程调用测试" class="headerlink" title="远程调用测试"></a>远程调用测试</h5><ol>
<li>在content-service下编写feign接口</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 媒资管理服务远程接口</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 付广建 2023/12/23 19:06</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@FeignClient(value = &quot;media-api&quot;, configuration = MultipartSupportConfig.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MediaServiceClient</span> &#123;<br><br>    <span class="hljs-meta">@PostMapping(value = &quot;/media/upload/coursefile&quot;, consumes = MediaType.MULTIPART_FORM_DATA_VALUE)</span><br>    String <span class="hljs-title function_">uploadFile</span><span class="hljs-params">(<span class="hljs-meta">@RequestPart(&quot;filedata&quot;)</span> MultipartFile upload,</span><br><span class="hljs-params">                      <span class="hljs-meta">@RequestParam(value = &quot;objectName&quot;, required = false)</span> String objectName)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>在启动类添加@EnableFeignClients注解</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableFeignClients(basePackages = &#123;&quot;com.xuecheng.content.feignclient&quot;&#125;)</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ContentApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(ContentApplication.class);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>编写feign测试方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.content;<br><br><span class="hljs-keyword">import</span> com.xuecheng.content.config.MultipartSupportConfig;<br><span class="hljs-keyword">import</span> com.xuecheng.content.feignclient.MediaServiceClient;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 付广建 2023/12/23 19:29</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FeignUploadTest</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    MediaServiceClient mediaServiceClient;<br><br>    <span class="hljs-comment">//远程调用,上传文件</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">MultipartFile</span> <span class="hljs-variable">multipartFile</span> <span class="hljs-operator">=</span> MultipartSupportConfig.getMultipartFile(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;D:\\develop\\test.html&quot;</span>));<br>        mediaServiceClient.uploadFile(multipartFile,  <span class="hljs-string">&quot;course/test.html&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>上传成功</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223201536512.png" srcset="/img/loading.gif" lazyload alt="image-20231223201536512" style="zoom:50%;" />

<p>访问一下，查看是否可以正常访问</p>
<p><a target="_blank" rel="noopener" href="http://192.168.101.65:9000/mediafiles/course/test.html">http://192.168.101.65:9000/mediafiles/course/test.html</a></p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223201732623.png" srcset="/img/loading.gif" lazyload alt="image-20231223201732623" style="zoom: 33%;" />

<h5 id="熔断降级处理"><a href="#熔断降级处理" class="headerlink" title="熔断降级处理"></a>熔断降级处理</h5><h6 id="什么是熔断降级"><a href="#什么是熔断降级" class="headerlink" title="什么是熔断降级"></a>什么是熔断降级</h6><blockquote>
<p>熔断降级：</p>
<p>微服务难免存在服务之间的远程调用，当微服务运行不正常时导致无法正常调用微服务，此时会出现以后，如果这种异常不去处理可能会导致雪崩效应</p>
<p>微服务的雪崩效应表现在服务和服务之间的调用，当一个服务无法提供服务可能导致其他服务死掉，比如：服务B调用服务A，服务A异常导致B响应缓慢，最后B，C服务都不可用，这样由一个服务导致一连串多个服务无法正常运行的情况是微服务的雪崩效应</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223202126690.png" srcset="/img/loading.gif" lazyload alt="image-20231223202126690" style="zoom:50%;" />

<p>如何解决由于微服务异常引起的雪崩效应？</p>
<p>A：熔断	B：降级</p>
<p>熔断降级相同点是为了解决微服务系统崩溃的问题，但是他们是两个不同的技术，两者由又互相联系</p>
<p>熔断：</p>
<p>当下游服务异常而断开与上游服务的交互，相当于保险丝，下游服务异常触发了熔断，从而保证上游服务不收影响</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223202401031.png" srcset="/img/loading.gif" lazyload alt="image-20231223202401031" style="zoom:50%;" />

<p>降级：</p>
<p>当下游服务异常触发熔断后，上游服务不再去调用异常的微服务而是执行了<strong>降级处理逻辑</strong>（理解成后备隐藏能源），这个降级处理逻辑可以是本地一个单独的方法</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223202518923.png" srcset="/img/loading.gif" lazyload alt="image-20231223202518923" style="zoom:50%;" />

<p>两者都是为了保护系统，熔断是当下游服务异常时一种保护系统的手段，降级是熔断后上游服务处理熔断的方法		{<strong>和老婆离婚，和小三结婚</strong>}</p>
</blockquote>
<h6 id="熔断降级处理-1"><a href="#熔断降级处理-1" class="headerlink" title="熔断降级处理"></a>熔断降级处理</h6><p>项目使用 Hystrix 框架实现熔断，降级处理，在 feign-dev.yaml中配置</p>
<ol>
<li>开启Feign熔断保护</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">feign:</span><br>  <span class="hljs-attr">hystrix:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">circuitbreaker:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br><br></code></pre></td></tr></table></figure>



<ol start="2">
<li>设置熔断超时时间，为了防止一次处理时间较长触发熔断这里需要设置请求和连接的超时时间</li>
</ol>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs dts">Bash<br><span class="hljs-symbol">hystrix:</span><br><span class="hljs-symbol">  command:</span><br><span class="hljs-symbol">    default:</span><br><span class="hljs-symbol">      execution:</span><br><span class="hljs-symbol">        isolation:</span><br><span class="hljs-symbol">          thread:</span><br><span class="hljs-symbol">            timeoutInMilliseconds:</span> <span class="hljs-number">30000</span>  <span class="hljs-meta">#熔断超时时间</span><br><span class="hljs-symbol">ribbon:</span><br><span class="hljs-symbol">  ConnectTimeout:</span> <span class="hljs-number">60000</span> <span class="hljs-meta">#连接超时时间</span><br><span class="hljs-symbol">  ReadTimeout:</span> <span class="hljs-number">60000</span> <span class="hljs-meta">#读超时时间</span><br><span class="hljs-symbol">  MaxAutoRetries:</span> <span class="hljs-number">0</span> <span class="hljs-meta">#重试次数</span><br><span class="hljs-symbol">  MaxAutoRetriesNextServer:</span> <span class="hljs-number">1</span> <span class="hljs-meta">#切换实例的重试次数</span><br><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>定义熔断逻辑</li>
</ol>
<p>两种方式： </p>
<p>1）fallback</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@FeignClient(value = &quot;media-api&quot;,configuration = MultipartSupportConfig.class,fallback = MediaServiceClientFallback.class)</span><br><span class="hljs-meta">@RequestMapping(&quot;/media&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MediaServiceClient</span>&#123;<br>...<br><br></code></pre></td></tr></table></figure>

<p>定义一个fallback类MediaServiceClientFallback，此类实现了MediaServiceClient接口。</p>
<p>第一种方法无法取出熔断所抛出的异常，第二种方法定义MediaServiceClientFallbackFactory 可以解决这个问题</p>
<p>2）fallbackFactory </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FeignClient(value = &quot;media-api&quot;, </span><br><span class="hljs-meta">        configuration = MultipartSupportConfig.class,</span><br><span class="hljs-meta">        fallbackFactory = MediaServiceClientFallbackFactory.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MediaServiceClient</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.xuecheng.content.feignclient;<br><br><span class="hljs-keyword">import</span> feign.hystrix.FallbackFactory;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 付广建 2023/12/23 20:36</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MediaServiceClientFallbackFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FallbackFactory</span>&lt;MediaServiceClient&gt; &#123;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> MediaServiceClient <span class="hljs-title function_">create</span><span class="hljs-params">(Throwable throwable)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaServiceClient</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> String <span class="hljs-title function_">uploadFile</span><span class="hljs-params">(MultipartFile upload, String objectName)</span> &#123;<br>                <span class="hljs-comment">//降级方法</span><br>                log.debug(<span class="hljs-string">&quot;调用媒资管理服务上传文件时发生熔断，异常信息:&#123;&#125;&quot;</span>,throwable.toString(),throwable);<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>            &#125;<br>        &#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>降级处理逻辑：</p>
<p>返回一个null对象，上游服务请求接口得到一个null说明执行了降级处理。</p>
<p>测试：</p>
<p>停止媒资管理服务或人为制造异常观察是否执行降级逻辑。</p>
<h5 id="课程静态化开发"><a href="#课程静态化开发" class="headerlink" title="课程静态化开发"></a>课程静态化开发</h5><p>课程页面静态化和静态页面远程上传测试通过，下一步开发课程静态化功能，最终使用消息处理SDK去调度执行。</p>
<h6 id="静态化实现"><a href="#静态化实现" class="headerlink" title="静态化实现"></a>静态化实现</h6><p>课程静态化包括两部分工作：生成课程静态化页面，上传静态页面到文件系统。</p>
<p>在课程发布的service编写这两部分内容，最后通过消息去调度执行</p>
<ol>
<li>接口定义</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> File <span class="hljs-title function_">generateCourseHtml</span><span class="hljs-params">(Long courseId)</span> &#123;<br>        <span class="hljs-comment">//静态化文件</span><br>        <span class="hljs-type">File</span> <span class="hljs-variable">htmlFile</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//配置freemarker</span><br>            <span class="hljs-type">Configuration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>(Configuration.getVersion());<br><br>            <span class="hljs-comment">//加载模板</span><br>            <span class="hljs-comment">//选指定模板路径,classpath下templates下</span><br>            <span class="hljs-comment">//得到classpath路径</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">classpath</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getClass().getResource(<span class="hljs-string">&quot;/&quot;</span>).getPath();<br>            configuration.setDirectoryForTemplateLoading(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(classpath + <span class="hljs-string">&quot;/templates/&quot;</span>));<br>            <span class="hljs-comment">//设置字符编码</span><br>            configuration.setDefaultEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);<br><br>            <span class="hljs-comment">//指定模板文件名称</span><br>            <span class="hljs-type">Template</span> <span class="hljs-variable">template</span> <span class="hljs-operator">=</span> configuration.getTemplate(<span class="hljs-string">&quot;course_template.ftl&quot;</span>);<br><br>            <span class="hljs-comment">//准备数据</span><br>            <span class="hljs-type">CoursePreviewDto</span> <span class="hljs-variable">coursePreviewInfo</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getCoursePreviewInfo(courseId);<br><br>            Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>            map.put(<span class="hljs-string">&quot;model&quot;</span>, coursePreviewInfo);<br><br>            <span class="hljs-comment">//静态化</span><br>            <span class="hljs-comment">//参数1：模板，参数2：数据模型</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> FreeMarkerTemplateUtils.processTemplateIntoString(template, map);<br><span class="hljs-comment">//            System.out.println(content);</span><br>            <span class="hljs-comment">//将静态化内容输出到文件中</span><br>            <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> IOUtils.toInputStream(content);<br>            <span class="hljs-comment">//创建静态化文件</span><br>            htmlFile = File.createTempFile(<span class="hljs-string">&quot;course&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>);<br>            log.debug(<span class="hljs-string">&quot;课程静态化，生成静态文件:&#123;&#125;&quot;</span>,htmlFile.getAbsolutePath());<br>            <span class="hljs-comment">//输出流</span><br>            <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(htmlFile);<br>            IOUtils.copy(inputStream, outputStream);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;课程静态化异常:&#123;&#125;&quot;</span>,e.toString());<br>            XueChengPlusException.cast(<span class="hljs-string">&quot;课程静态化异常&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> htmlFile;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">uploadCourseHtml</span><span class="hljs-params">(Long courseId, File file)</span> &#123;<br>        <span class="hljs-type">MultipartFile</span> <span class="hljs-variable">multipartFile</span> <span class="hljs-operator">=</span> MultipartSupportConfig.getMultipartFile(file);<br>        mediaServiceClient.uploadFile(multipartFile, <span class="hljs-string">&quot;course/&quot;</span> + courseId + <span class="hljs-string">&quot;.html&quot;</span>);<br>        <span class="hljs-keyword">if</span> (courseId==<span class="hljs-literal">null</span>) &#123;<br>            XueChengPlusException.cast(<span class="hljs-string">&quot;上传静态文件异常&quot;</span>);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>完善课程发布任务CoursePublishTask类的代码：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 生成课程静态化页面并上传到文件系统minio</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">generateCourseHtml</span><span class="hljs-params">(MqMessage mqMessage, <span class="hljs-type">long</span> courseId)</span> &#123;<br>    log.info(<span class="hljs-string">&quot;开始进行课程静态化,课程id:&#123;&#125;&quot;</span>, courseId);<br>    <span class="hljs-comment">// 消息id</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> mqMessage.getId();<br>    <span class="hljs-comment">// 消息处理的service</span><br>    <span class="hljs-type">MqMessageService</span> <span class="hljs-variable">mqMessageService</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getMqMessageService();<br>    <span class="hljs-comment">// 消息幂等性处理  -&gt; 阶段1处理状态, 0:初始，1:成功</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">stageOne</span> <span class="hljs-operator">=</span> mqMessageService.getStageOne(id);<br>    <span class="hljs-keyword">if</span> (stageOne &gt; <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// 1 成功,不处理</span><br>        log.debug(<span class="hljs-string">&quot;课程静态化已处理直接返回,课程id:&#123;&#125;&quot;</span>, courseId);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//开始进行课程静态化</span><br>    <span class="hljs-comment">//1.生成静态化页面</span><br>    <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> coursePublishService.generateCourseHtml(courseId);<br>    <span class="hljs-comment">//2.上传静态化页面</span><br>    <span class="hljs-keyword">if</span> (file!=<span class="hljs-literal">null</span>)&#123;<br>        coursePublishService.uploadCourseHtml(courseId, file);<br>    &#125;<br>    <br>    <span class="hljs-comment">//保存第一阶段状态(完成)</span><br>    mqMessageService.completedStageOne(id);<br>&#125;<br></code></pre></td></tr></table></figure>

<h6 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h6><p>1、启动网关、媒资管理服务工程。</p>
<p>2、在内容管理api工程的启动类上配置FeignClient</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">Java<br><span class="hljs-meta">@EnableFeignClients(basePackages=&#123;<span class="hljs-string">&quot;com.xuecheng.content.feignclient&quot;</span>&#125;)</span><br></code></pre></td></tr></table></figure>

<p>在bootstrap.yml引用feign-dev.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">data-id:</span> <span class="hljs-string">feign-$&#123;spring.profiles.active&#125;.yaml</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">xuecheng-plus-common</span><br>  <span class="hljs-attr">refresh:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment">#profiles默认为dev</span><br><br></code></pre></td></tr></table></figure>

<p>启动内容管理接口工程。</p>
<p>在CoursePublishTask类的execute方法中打上断点</p>
<p>3、发布一门课程，保存消息表存在未处理的处理。</p>
<p>4、启动xxl-job调度中心、启动课程发布任务，等待定时调度。</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223205424732.png" srcset="/img/loading.gif" lazyload alt="image-20231223205424732" style="zoom:50%;" />

<p>5、观察任务调度日志，观察任务是否可以正常处理。</p>
<p>6、处理完成进入文件系统，查询mediafiles桶内是否存在以课程id命名的html文件</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223205446338.png" srcset="/img/loading.gif" lazyload alt="image-20231223205446338" style="zoom:50%;" />

<p>如果不存在说明课程静态化存在问题，再仔细查看执行日志，排查问题。</p>
<p>如果存在则说明课程静态化并上传到minio成功。</p>
<h6 id="浏览详细页面"><a href="#浏览详细页面" class="headerlink" title="浏览详细页面"></a>浏览详细页面</h6><p>课程静态化成功后可以用浏览器访问html文件是否可以正常浏览，下图表示可以正常浏览。</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223205549946.png" srcset="/img/loading.gif" lazyload alt="image-20231223205549946" style="zoom:50%;" />

<p>页面还没有样式，需要在nginx配置虚拟目录，在<a href="http://www.51xuecheng.cn下配置：">www.51xuecheng.cn下配置：</a></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /course/ &#123;  <br>        <span class="hljs-attribute">proxy_pass</span> http://fileserver/mediafiles/course/;<br>&#125; <br><br></code></pre></td></tr></table></figure>

<p>加载nginx配置文件</p>
<p>访问：<a target="_blank" rel="noopener" href="http://www.51xuecheng.cn/course/2.html">http://www.51xuecheng.cn/course/2.html</a></p>
<p>2.html为以课程id命名的html文件。</p>
<h3 id="视频搜索"><a href="#视频搜索" class="headerlink" title="视频搜索"></a>视频搜索</h3><h4 id="需求分析-4"><a href="#需求分析-4" class="headerlink" title="需求分析"></a>需求分析</h4><h5 id="模块介绍"><a href="#模块介绍" class="headerlink" title="模块介绍"></a>模块介绍</h5><p>搜索功能是一个系统的重要功能，是信息查询的方式。课程搜索是课程展示的渠道，用户通过课程搜索找到课程信息，进一步去查看课程的详细信息，进行选课、支付、学习。</p>
<p>本项目的课程搜索支持全文检索技术</p>
<p>什么是全文检索？</p>
<p><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2/8028630?fromModule=lemma_inlink">全文检索</a>是指计算机索引程序通过扫描文章中的每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置，当用户查询时，检索程序就根据事先建立的索引进行查找，并将查找的结果反馈给用户的检索方式。这个过程类似于通过字典中的检索字表查字的过程。</p>
<p>全文检索可以简单理解为通过<strong>索引</strong>搜索文章</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223220342249.png" srcset="/img/loading.gif" lazyload alt="image-20231223220342249" style="zoom:50%;" />

<p>全文检索的速度非常快，早期应用在搜索引擎技术中，比如：百度、google等，现在通常一些大型网站的搜索功能都是采用全文检索技术</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223220451365.png" srcset="/img/loading.gif" lazyload alt="image-20231223220451365"></p>
<p>课程搜索也要将课程信息建立索引，在课程发布时建立课程索引，索引建立好用户可通过搜索网页去查询课程信息</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223220540803.png" srcset="/img/loading.gif" lazyload alt="image-20231223220540803" style="zoom:50%;" />

<p>所以，课程搜索模块包括两部分：课程索引、课程搜索。</p>
<p>课程索引是将课程信息建立索引。</p>
<p>课程搜索是通过前端网页，通过关键字等条件去搜索课程。</p>
<h5 id="业务流程-2"><a href="#业务流程-2" class="headerlink" title="业务流程"></a>业务流程</h5><p>根据模块介绍的内容，课程搜索模块包括课程索引、课程搜索两部分。</p>
<p>1、课程索引</p>
<p>在课程发布操作执行后通过<strong>消息处理</strong>方式创建课程索引，如下图</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223220635687.png" srcset="/img/loading.gif" lazyload alt="image-20231223220635687"></p>
<p>本项目使用elasticsearch作为索引及搜索服务。</p>
<p>2、课程搜索</p>
<p>课程索引创建完成，用户才可以通过前端搜索课程信息。</p>
<p>课程搜索可以从首页进入搜索页面</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223220721183.png" srcset="/img/loading.gif" lazyload alt="image-20231223220721183"></p>
<p>下图是搜索界面，可以通过课程分类、课程难度等级等条件进行搜索。</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223220743738.png" srcset="/img/loading.gif" lazyload alt="image-20231223220743738"></p>
<h4 id="准备环境"><a href="#准备环境" class="headerlink" title="准备环境"></a>准备环境</h4><h5 id="搭建elasticsearch"><a href="#搭建elasticsearch" class="headerlink" title="搭建elasticsearch"></a>搭建elasticsearch</h5><p>在课前下发的虚拟中已经在docker容器中安装了elasticsearch和kibana。</p>
<p>kibana 是 ELK（Elasticsearch , Logstash, Kibana ）之一，kibana 一款开源的数据分析和可视化平台，通过可视化界面访问elasticsearch的索引库，并可以生成一个数据报表。</p>
<p>开发中主要使用kibana通过api对elasticsearch进行索引和搜索操作</p>
<p>通过浏览器访问 <a target="_blank" rel="noopener" href="http://192.168.101.65:5601/app/dev_tools#/console%E8%BF%9B%E5%85%A5kibana%E7%9A%84%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%95%8C%E9%9D%A2%E3%80%82">http://192.168.101.65:5601/app/dev_tools#/console进入kibana的开发工具界面。</a></p>
<p>修改虚拟机中的启动脚本restart.sh添加</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223221152059.png" srcset="/img/loading.gif" lazyload alt="image-20231223221152059" style="zoom:50%;" />

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_52477733/article/details/129847700?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170334156716800227452169%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=170334156716800227452169&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-129847700-null-null.142%5Ev96%5Epc_search_result_base2&utm_term=%E8%A7%A3%E5%86%B3%E9%BB%91%E9%A9%AC%E9%A1%B9%E7%9B%AE%E3%80%8A%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E3%80%8B%E7%9A%84p106%E4%B8%AD%E7%9A%84kibana%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E5%90%AF%E5%8A%A8&spm=1018.2226.3001.4187">kibana启动失败:server is not ready yet 解决办法</a></p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223224918738.png" srcset="/img/loading.gif" lazyload alt="image-20231223224918738" style="zoom: 33%;" />

<p>可通过命令：GET &#x2F;_cat&#x2F;indices?v 查看所有的索引，通过此命令判断kibana是否正常连接elasticsearch</p>
<p>索引相当于MySQL中的表，Elasticsearch与MySQL之间概念的对应关系见下表：</p>
<table>
<thead>
<tr>
<th>MySQL</th>
<th>ElasticSearch</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Table</td>
<td>Index</td>
<td>索引，是文档的集合，类似数据库的表</td>
</tr>
<tr>
<td>Row</td>
<td>Document</td>
<td>文档，就是一条条数据，类似数据库的行，文档是JSON格式</td>
</tr>
<tr>
<td>Column</td>
<td>Field</td>
<td>字段，是JSON文档中的字段，类似数据库的列</td>
</tr>
<tr>
<td>Schema</td>
<td>Mapping</td>
<td>映射，是索引中文档的约束，例如字段类型约束，类似数据库的表结构</td>
</tr>
<tr>
<td>SQL</td>
<td>DSL</td>
<td>DSL是es提供的JSON风格的请求语句，用来操作es，实现CRUD</td>
</tr>
</tbody></table>
<p>要使用elasticsearch需要建立索引，Mapping相当于表结构，Mapping创建后其字段不能删除，如果要删除需要删除整个索引，下边介绍创建索引、查询索引、删除索引的方法：</p>
<p>1、创建索引，并指定Mapping</p>
<p>PUT &#x2F;course-publish</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;number_of_shards&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;number_of_replicas&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;mappings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;keyword&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;companyId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;keyword&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;companyName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_max_word&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;search_analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_smart&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_max_word&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;search_analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_smart&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;users&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;tags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_max_word&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;search_analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_smart&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;mt&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;keyword&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;mtName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;keyword&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;st&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;keyword&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;stName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;keyword&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;grade&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;keyword&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;teachmode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;keyword&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;pic&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_max_word&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;search_analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_smart&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;createDate&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;format&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;date&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;keyword&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;remark&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;charge&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;keyword&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;scaled_float&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;scaling_factor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;originalPrice&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;scaled_float&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;scaling_factor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;validDays&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;integer&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br><br></code></pre></td></tr></table></figure>

<p>2、查询索引</p>
<p>通过 GET &#x2F;_cat&#x2F;indices?v 查询所有的索引，查找course-publish是否创建成功。</p>
<p>通过GET &#x2F;course-publish&#x2F;_mapping 查询course-publish的索引结构</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#123;<br>  <span class="hljs-string">&quot;course-publish&quot;</span> : &#123;<br>    <span class="hljs-string">&quot;mappings&quot;</span> : &#123;<br>      <span class="hljs-string">&quot;properties&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;charge&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : &quot;<span class="hljs-type">keyword</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>companyId<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>keyword<span class="hljs-string">&quot;</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>companyName<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>text<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>analyzer<span class="hljs-string">&quot; : &quot;</span>ik_max_word<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>search_analyzer<span class="hljs-string">&quot; : &quot;</span>ik_smart<span class="hljs-string">&quot;</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>createDate<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>date<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>format<span class="hljs-string">&quot; : &quot;</span>yyyy-MM-dd HH:mm:ss<span class="hljs-string">&quot;</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>description<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>text<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>analyzer<span class="hljs-string">&quot; : &quot;</span>ik_max_word<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>search_analyzer<span class="hljs-string">&quot; : &quot;</span>ik_smart<span class="hljs-string">&quot;</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>grade<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>keyword<span class="hljs-string">&quot;</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>id<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>keyword<span class="hljs-string">&quot;</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>mt<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>keyword<span class="hljs-string">&quot;</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>mtName<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>keyword<span class="hljs-string">&quot;</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>name<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>text<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>analyzer<span class="hljs-string">&quot; : &quot;</span>ik_max_word<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>search_analyzer<span class="hljs-string">&quot; : &quot;</span>ik_smart<span class="hljs-string">&quot;</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>originalPrice<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>scaled_float<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>scaling_factor<span class="hljs-string">&quot; : 100.0</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>pic<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>text<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>index<span class="hljs-string">&quot; : false</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>price<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>scaled_float<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>scaling_factor<span class="hljs-string">&quot; : 100.0</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>remark<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>text<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>index<span class="hljs-string">&quot; : false</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>st<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>keyword<span class="hljs-string">&quot;</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>stName<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>keyword<span class="hljs-string">&quot;</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>status<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>keyword<span class="hljs-string">&quot;</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>tags<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>text<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>analyzer<span class="hljs-string">&quot; : &quot;</span>ik_max_word<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>search_analyzer<span class="hljs-string">&quot; : &quot;</span>ik_smart<span class="hljs-string">&quot;</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>teachmode<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>keyword<span class="hljs-string">&quot;</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>users<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>text<span class="hljs-string">&quot;,</span><br><span class="hljs-string">          &quot;</span>index<span class="hljs-string">&quot; : false</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>validDays<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">          &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>integer<span class="hljs-string">&quot;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>

<p>3、删除索引</p>
<p>如果发现创建的course-publish不正确可以删除重新创建。</p>
<p>删除索引后当中的文档数据也同时删除，一定要谨慎操作！</p>
<p>删除索引命令：DELETE &#x2F;course-publish</p>
<h5 id="部署搜索工程"><a href="#部署搜索工程" class="headerlink" title="部署搜索工程"></a>部署搜索工程</h5><p>拷贝课程资料中的xuecheng-plus-search搜索工程到自己的工程目录</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223231154129.png" srcset="/img/loading.gif" lazyload alt="image-20231223231154129" style="zoom:50%;" />

<p>修改bootstrap.xml中nacos的namespace为自己的命名空间。</p>
<p>启动网关、搜索服务。</p>
<p>部署完成通过httpclient进行测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">Java<br><span class="hljs-comment">### 添加课程索引</span><br>POST &#123;&#123;search_host&#125;&#125;/search/index/course<br>Content-Type: application/json<br><br>&#123;<br>  <span class="hljs-string">&quot;charge&quot;</span> : <span class="hljs-string">&quot;201000&quot;</span>,<br>  <span class="hljs-string">&quot;companyId&quot;</span> : 100000,<br>  <span class="hljs-string">&quot;companyName&quot;</span> : <span class="hljs-string">&quot;北京黑马程序&quot;</span>,<br>  <span class="hljs-string">&quot;createDate&quot;</span> : <span class="hljs-string">&quot;2022-09-25 09:36:11&quot;</span>,<br>  <span class="hljs-string">&quot;description&quot;</span> : <span class="hljs-string">&quot;《Spring编程思想》是2007年6月1日机械工业出版社出版的图书，作者是埃克尔，译者是陈昊鹏。主要内容本书赢得了全球程序员的广泛赞誉，即使是最晦涩的概念，在Bruce Eckel的文字亲和力和小而直接的编程示例面前也会化解于无形。从Java的基础语法到最高级特性（深入的面向对象概念、多线程、自动项目构建、单元测试和调试等），本书都能逐步指导你轻松掌握。从本书获得的各项大奖以及来自世界各地的读者评论中，不难看出这是一本经典之作&quot;</span>,<br>  <span class="hljs-string">&quot;grade&quot;</span> : <span class="hljs-string">&quot;204001&quot;</span>,<br>  <span class="hljs-string">&quot;id&quot;</span> : 102,<br>  <span class="hljs-string">&quot;mt&quot;</span> : <span class="hljs-string">&quot;1-3&quot;</span>,<br>  <span class="hljs-string">&quot;mtName&quot;</span> : <span class="hljs-string">&quot;编程开发&quot;</span>,<br>  <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Spring编程思想&quot;</span>,<br>  <span class="hljs-string">&quot;originalPrice&quot;</span> : 200.0,<br>  <span class="hljs-string">&quot;pic&quot;</span> : <span class="hljs-string">&quot;/mediafiles/2022/09/20/1d0f0e6ed8a0c4a89bfd304b84599d9c.png&quot;</span>,<br>  <span class="hljs-string">&quot;price&quot;</span> : 100.0,<br>  <span class="hljs-string">&quot;remark&quot;</span> : <span class="hljs-string">&quot;没有备注&quot;</span>,<br>  <span class="hljs-string">&quot;st&quot;</span> : <span class="hljs-string">&quot;1-3-2&quot;</span>,<br>  <span class="hljs-string">&quot;stName&quot;</span> : <span class="hljs-string">&quot;Java语言&quot;</span>,<br>  <span class="hljs-string">&quot;status&quot;</span> : <span class="hljs-string">&quot;203002&quot;</span>,<br>  <span class="hljs-string">&quot;tags&quot;</span> : <span class="hljs-string">&quot;没有标签&quot;</span>,<br>  <span class="hljs-string">&quot;teachmode&quot;</span> : <span class="hljs-string">&quot;200002&quot;</span>,<br>  <span class="hljs-string">&quot;validDays&quot;</span> : 222<br>&#125;<br><br><br><br><span class="hljs-comment">### 搜索课程</span><br>GET &#123;&#123;search_host&#125;&#125;/search/course/list?pageNo=1&amp;keywords=spring<br>Content-Type: application/json<br><br><br><br></code></pre></td></tr></table></figure>

<p>进入前端搜索界面<a target="_blank" rel="noopener" href="http://www.51xuecheng.cn/course/search.html">http://www.51xuecheng.cn/course/search.html</a></p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231223231240118.png" srcset="/img/loading.gif" lazyload alt="image-20231223231240118" style="zoom:50%;" />

<h4 id="索引管理"><a href="#索引管理" class="headerlink" title="索引管理"></a>索引管理</h4><h5 id="REST-API"><a href="#REST-API" class="headerlink" title="REST API"></a>REST API</h5><h6 id="添加文档"><a href="#添加文档" class="headerlink" title="添加文档"></a>添加文档</h6><p>索引创建好就可以向其中添加文档，此时elasticsearch会根据索引的mapping配置对有些字段进行分词。</p>
<p>这里我们要向course_publish中添加课程信息。</p>
<p>使用rest api进行测试，如下：</p>
<p>使用post请求，&#x2F;course-publish&#x2F;_doc&#x2F;103 第一部分为索引名称，_doc固定，103为文档的主键id，这里为课程id。</p>
<p>课程内容使用json表示。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs json">POST /course-publish/_doc/<span class="hljs-number">103</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;charge&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;201001&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;companyId&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">100000</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;companyName&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;北京黑马程序&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;createDate&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2022-09-25 09:36:11&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;description&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;HTML/CSS&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;grade&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;204001&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;id&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">102</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;mt&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1-1&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;mtName&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;前端开发&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;name&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Html参考大全&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;originalPrice&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">200.0</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;pic&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/mediafiles/2022/09/20/e726b71ba99c70e8c9d2850c2a7019d7.jpg&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;price&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">100.0</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;remark&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;没有备注&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;st&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1-1-1&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;stName&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;HTML/CSS&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;status&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;203002&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;tags&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;没有标签&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;teachmode&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;200002&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;validDays&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">222</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>如果要修改文档的内容可以使用上边相同的方法，如果没有则添加，如果存在则更新（局部更新）</p>
<h6 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h6><p>添加文档成功后可以通过主键id查询该文档的信息。</p>
<p>语法如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JSON">GET /<span class="hljs-punctuation">&#123;</span>索引库名称<span class="hljs-punctuation">&#125;</span>/_doc/<span class="hljs-punctuation">&#123;</span>id<span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<h6 id="更新文档"><a href="#更新文档" class="headerlink" title="更新文档"></a>更新文档</h6><p>更新文档分为全量更新和局部更新。</p>
<p>全量更新是指先删除再更新，语法如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JSON">PUT /<span class="hljs-punctuation">&#123;</span>索引库名<span class="hljs-punctuation">&#125;</span>/_doc/文档id<br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;字段1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;值1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;字段2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;值2&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-comment">// ... 略</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>局部更新语法如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JSON">POST /<span class="hljs-punctuation">&#123;</span>索引库名<span class="hljs-punctuation">&#125;</span>/_update/文档id<br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;doc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>         <span class="hljs-attr">&quot;字段名&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;新的值&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<h6 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h6><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">DELETE /<span class="hljs-punctuation">&#123;</span>索引库名<span class="hljs-punctuation">&#125;</span>/_doc/id值<br></code></pre></td></tr></table></figure>

<h5 id="接口定义-3"><a href="#接口定义-3" class="headerlink" title="接口定义"></a>接口定义</h5><p>当课程发布时请求添加课程到索引，当课程下架时请求删除课程接口从索引中删除课程信息，这里现实现添加课程接口</p>
<p>根据课程索引的mapping结构创建po类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><code class="hljs java">Java<br><span class="hljs-keyword">package</span> com.xuecheng.search.po;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.annotation.JSONField;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * &lt;p&gt;</span><br><span class="hljs-comment"> * 课程索引信息</span><br><span class="hljs-comment"> * &lt;/p&gt;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> itcast</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CourseIndex</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 主键</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Long id;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 机构ID</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Long companyId;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 公司名称</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String companyName;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 课程名称</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 适用人群</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String users;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 标签</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String tags;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 大分类</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String mt;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 大分类名称</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String mtName;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 小分类</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String st;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 小分类名称</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String stName;<br><br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 课程等级</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String grade;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 教育模式</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String teachmode;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 课程图片</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String pic;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 课程介绍</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String description;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 发布时间</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@JSONField(format=&quot;yyyy-MM-dd HH:mm:ss&quot;)</span><br>    <span class="hljs-meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime createDate;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 状态</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String status;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 备注</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String remark;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 收费规则，对应数据字典--203</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String charge;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 现价</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Float price;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 原价</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Float originalPrice;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 课程有效期天数</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Integer validDays;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="接口开发-2"><a href="#接口开发-2" class="headerlink" title="接口开发"></a>接口开发</h5><p>定义service接口，请求elasticsearch添加课程信息。</p>
<p>注意：为了适应其它文档信息，将添加文档定义为通用的添加文档接口，此接口不仅适应添加课程还适应添加其它信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java">Java<br><span class="hljs-keyword">package</span> com.xuecheng.search.service;<br><br><span class="hljs-keyword">import</span> com.xuecheng.search.po.CourseIndex;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span> 课程索引service</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022/9/24 22:40</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IndexService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> indexName 索引名称</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id 主键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> object 索引对象</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> Boolean true表示成功,false失败</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@description</span> 添加索引</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@date</span> 2022/9/24 22:57</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">addCourseIndex</span><span class="hljs-params">(String indexName,String id,Object object)</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>接口实现如下</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Java<br>package com.xuecheng.<span class="hljs-keyword">search</span>.service.impl;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.xuecheng.base.execption.XueChengPlusException;<br><span class="hljs-keyword">import</span> com.xuecheng.<span class="hljs-keyword">search</span>.po.CourseIndex;<br><span class="hljs-keyword">import</span> com.xuecheng.<span class="hljs-keyword">search</span>.service.IndexService;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.DocWriteResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">delete</span>.DeleteRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">delete</span>.DeleteResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">index</span>.IndexRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">index</span>.IndexResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">update</span>.UpdateRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">update</span>.UpdateResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.common.xcontent.XContentType;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.<span class="hljs-keyword">Value</span>;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * @description 课程索引管理接口实现</span><br><span class="hljs-comment"> * @author Mr.M</span><br><span class="hljs-comment"> * @date 2022/9/25 7:23</span><br><span class="hljs-comment"> * @version 1.0</span><br><span class="hljs-comment"> */</span><br>@Slf4j<br>@Service<br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> IndexServiceImpl implements IndexService &#123;<br><br><br><br> @Autowired<br> RestHighLevelClient client;<br><br> @Override<br> <span class="hljs-built_in">public</span> <span class="hljs-type">Boolean</span> addCourseIndex(String indexName,String id,<span class="hljs-keyword">Object</span> <span class="hljs-keyword">object</span>) &#123;<br>  String jsonString = <span class="hljs-type">JSON</span>.toJSONString(<span class="hljs-keyword">object</span>);<br>  IndexRequest indexRequest = <span class="hljs-built_in">new</span> IndexRequest(indexName).id(id);<br>  //指定索引文档内容<br>  indexRequest.source(jsonString,XContentType.JSON);<br>  //索引响应对象<br>  IndexResponse indexResponse = <span class="hljs-keyword">null</span>;<br>  try &#123;<br>   indexResponse = client.<span class="hljs-keyword">index</span>(indexRequest, RequestOptions.<span class="hljs-keyword">DEFAULT</span>);<br>  &#125; catch (IOException e) &#123;<br>   <span class="hljs-keyword">log</span>.error(&quot;添加索引出错:&#123;&#125;&quot;,e.getMessage());<br>   e.printStackTrace();<br>   XueChengPlusException.cast(&quot;添加索引出错&quot;);<br>  &#125;<br>  String <span class="hljs-type">name</span> = indexResponse.getResult().name();<br>  <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-type">name</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-type">name</span>.equalsIgnoreCase(&quot;created&quot;) || <span class="hljs-type">name</span>.equalsIgnoreCase(&quot;updated&quot;);<br><br> &#125;<br><br> <br>&#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="接口完善"><a href="#接口完善" class="headerlink" title="接口完善"></a>接口完善</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">Java<br><span class="hljs-keyword">package</span> com.xuecheng.search.controller;<br><br><span class="hljs-keyword">import</span> com.xuecheng.base.execption.XueChengPlusException;<br><span class="hljs-keyword">import</span> com.xuecheng.search.po.CourseIndex;<br><span class="hljs-keyword">import</span> com.xuecheng.search.service.IndexService;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Value;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RequestBody;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span> 课程索引接口</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022/9/24 22:31</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Api(value = <span class="hljs-string">&quot;课程信息索引接口&quot;</span>, tags = <span class="hljs-string">&quot;课程信息索引接口&quot;</span>)</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(<span class="hljs-string">&quot;/index&quot;</span>)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CourseIndexController</span> &#123;<br><br>    <span class="hljs-meta">@Value(<span class="hljs-string">&quot;<span class="hljs-subst">$&#123;elasticsearch.course.index&#125;</span>&quot;</span>)</span><br>    <span class="hljs-keyword">private</span> String courseIndexStore;<br><br>    <span class="hljs-meta">@Autowired</span><br>    IndexService indexService;<br><br>    <span class="hljs-meta">@ApiOperation(<span class="hljs-string">&quot;添加课程索引&quot;</span>)</span><br>    <span class="hljs-meta">@PostMapping(<span class="hljs-string">&quot;course&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">Boolean</span> add(<span class="hljs-meta">@RequestBody</span> CourseIndex courseIndex) &#123;<br>    <br>        <span class="hljs-built_in">Long</span> id = courseIndex.getId();<br>        <span class="hljs-keyword">if</span>(id==<span class="hljs-literal">null</span>)&#123;<br>            XueChengPlusException.cast(<span class="hljs-string">&quot;课程id为空&quot;</span>);<br>        &#125;<br>        <span class="hljs-built_in">Boolean</span> result = indexService.addCourseIndex(courseIndexStore, String.valueOf(id), courseIndex);<br>        <span class="hljs-keyword">if</span>(!result)&#123;<br>            XueChengPlusException.cast(<span class="hljs-string">&quot;添加课程索引失败&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> result;<br>    <br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="接口测试-1"><a href="#接口测试-1" class="headerlink" title="接口测试"></a>接口测试</h5><p>使用httpclient进行测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">JSON<br><span class="hljs-comment">### 添加课程索引</span><br>POST &#123;&#123;search_host&#125;&#125;/search/index/course<br>Content-Type: application/json<br><br>&#123;<br>  <span class="hljs-string">&quot;charge&quot;</span> : <span class="hljs-string">&quot;201000&quot;</span>,<br>  <span class="hljs-string">&quot;companyId&quot;</span> : 100000,<br>  <span class="hljs-string">&quot;companyName&quot;</span> : <span class="hljs-string">&quot;北京黑马程序员&quot;</span>,<br>  <span class="hljs-string">&quot;createDate&quot;</span> : <span class="hljs-string">&quot;2022-09-25 09:36:11&quot;</span>,<br>  <span class="hljs-string">&quot;description&quot;</span> : <span class="hljs-string">&quot;《Java编程思想》是2007年6月1日机械工业出版社出版的图书，作者是埃克尔，译者是陈昊鹏。主要内容本书赢得了全球程序员的广泛赞誉，即使是最晦涩的概念，在Bruce Eckel的文字亲和力和小而直接的编程示例面前也会化解于无形。从Java的基础语法到最高级特性（深入的面向对象概念、多线程、自动项目构建、单元测试和调试等），本书都能逐步指导你轻松掌握。从本书获得的各项大奖以及来自世界各地的读者评论中，不难看出这是一本经典之作&quot;</span>,<br>  <span class="hljs-string">&quot;grade&quot;</span> : <span class="hljs-string">&quot;204001&quot;</span>,<br>  <span class="hljs-string">&quot;id&quot;</span> : 102,<br>  <span class="hljs-string">&quot;mt&quot;</span> : <span class="hljs-string">&quot;1-3&quot;</span>,<br>  <span class="hljs-string">&quot;mtName&quot;</span> : <span class="hljs-string">&quot;编程开发&quot;</span>,<br>  <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Java编程思想&quot;</span>,<br>  <span class="hljs-string">&quot;originalPrice&quot;</span> : 200.0,<br>  <span class="hljs-string">&quot;pic&quot;</span> : <span class="hljs-string">&quot;/mediafiles/2022/09/20/1d0f0e6ed8a0c4a89bfd304b84599d9c.png&quot;</span>,<br>  <span class="hljs-string">&quot;price&quot;</span> : 100.0,<br>  <span class="hljs-string">&quot;remark&quot;</span> : <span class="hljs-string">&quot;没有备注&quot;</span>,<br>  <span class="hljs-string">&quot;st&quot;</span> : <span class="hljs-string">&quot;1-3-2&quot;</span>,<br>  <span class="hljs-string">&quot;stName&quot;</span> : <span class="hljs-string">&quot;Java语言&quot;</span>,<br>  <span class="hljs-string">&quot;status&quot;</span> : <span class="hljs-string">&quot;203002&quot;</span>,<br>  <span class="hljs-string">&quot;tags&quot;</span> : <span class="hljs-string">&quot;没有标签&quot;</span>,<br>  <span class="hljs-string">&quot;teachmode&quot;</span> : <span class="hljs-string">&quot;200002&quot;</span>,<br>  <span class="hljs-string">&quot;validDays&quot;</span> : 222<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h4 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h4><h5 id="需求分析-5"><a href="#需求分析-5" class="headerlink" title="需求分析"></a>需求分析</h5><p>索引信息维护完成下一步定义搜索接口搜索课程信息，首先需要搞清楚搜索功能的需求。</p>
<p>进入搜索界面，如下图</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231224131504339.png" srcset="/img/loading.gif" lazyload alt="image-20231224131504339" style="zoom:70%;" />

<p>根据搜索界面可知需求如下：</p>
<p>1、根据一级分类、二级分类搜索课程信息。</p>
<p>2、根据关键字搜索课程信息，搜索方式为全文检索，关键字需要匹配课程的名称、 课程内容。</p>
<p>3、根据难度等级搜索课程。</p>
<p>4、搜索结点分页显示。</p>
<p>技术点：</p>
<p>1、整体采用布尔查询。</p>
<p>2、根据关键字搜索，采用MultiMatchQuery，搜索name、description字段。</p>
<p>3、根据分类、课程等级搜索采用过滤器实现。</p>
<p>4、分页查询。</p>
<p>5、高亮显示。</p>
<p>为什么课程分类、课程等级等查询使用过滤器方式？</p>
<p>使用关键字查询需要计算相关度得分，根据课程分类、课程等级去查询不需要计算相关度得分，使用过滤器实现根据课程分类、课程等级查询的过程不会计算相关度得分，效率更高。</p>
<h5 id="接口定义-4"><a href="#接口定义-4" class="headerlink" title="接口定义"></a>接口定义</h5><p>1、定义搜索条件DTO类</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-title class_">Java</span><br>package com.<span class="hljs-property">xuecheng</span>.<span class="hljs-property">search</span>.<span class="hljs-property">dto</span>;<br><br><span class="hljs-keyword">import</span> lombok.<span class="hljs-property">Data</span>;<br><span class="hljs-keyword">import</span> lombok.<span class="hljs-property">ToString</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span> 搜索课程参数dtl</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022/9/24 22:36</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br> <span class="hljs-meta">@Data</span><br> <span class="hljs-meta">@ToString</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SearchCourseParamDto</span> &#123;<br><br>  <span class="hljs-comment">//关键字</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> keywords;<br><br>  <span class="hljs-comment">//大分类</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> mt;<br><br>  <span class="hljs-comment">//小分类</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> st;<br>  <span class="hljs-comment">//难度等级</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> grade;<br><br><br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>2、为了适应后期的扩展，定义搜索结果类，让它继承PageResult</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java">Java<br><span class="hljs-keyword">package</span> com.xuecheng.search.dto;<br><br><span class="hljs-keyword">import</span> com.xuecheng.base.model.PageResult;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.ToString;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span> TODO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022/9/25 17:51</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ToString</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SearchPageResultDto</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PageResult</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SearchPageResultDto</span><span class="hljs-params">(List&lt;T&gt; items, <span class="hljs-type">long</span> counts, <span class="hljs-type">long</span> page, <span class="hljs-type">long</span> pageSize)</span> &#123;<br>        <span class="hljs-built_in">super</span>(items, counts, page, pageSize);<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>接口定义如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">Java<br><span class="hljs-keyword">package</span> com.xuecheng.search.controller;<br><br><span class="hljs-keyword">import</span> com.xuecheng.base.model.PageParams;<br><span class="hljs-keyword">import</span> com.xuecheng.base.model.PageResult;<br><span class="hljs-keyword">import</span> com.xuecheng.search.dto.SearchCourseParamDto;<br><span class="hljs-keyword">import</span> com.xuecheng.search.po.CourseIndex;<br><span class="hljs-keyword">import</span> com.xuecheng.search.service.CourseSearchService;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.*;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span> 课程搜索接口</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022/9/24 22:31</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Api(value = <span class="hljs-string">&quot;课程搜索接口&quot;</span>,tags = <span class="hljs-string">&quot;课程搜索接口&quot;</span>)</span><br> <span class="hljs-meta">@RestController</span><br> <span class="hljs-meta">@RequestMapping(<span class="hljs-string">&quot;/course&quot;</span>)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CourseSearchController</span> &#123;<br><br><br><br> <span class="hljs-meta">@ApiOperation(<span class="hljs-string">&quot;课程搜索列表&quot;</span>)</span><br>  <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/list&quot;</span>)</span><br> <span class="hljs-keyword">public</span> PageResult&lt;CourseIndex&gt; list(PageParams pageParams, SearchCourseParamDto searchCourseParamDto)&#123;<br><br>    <br>   <br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="基本功能实现"><a href="#基本功能实现" class="headerlink" title="基本功能实现"></a>基本功能实现</h5><p>定义service接口，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java">Java<br><span class="hljs-keyword">package</span> com.xuecheng.search.service;<br><br><span class="hljs-keyword">import</span> com.xuecheng.base.model.PageParams;<br><span class="hljs-keyword">import</span> com.xuecheng.base.model.PageResult;<br><span class="hljs-keyword">import</span> com.xuecheng.search.dto.SearchCourseParamDto;<br><span class="hljs-keyword">import</span> com.xuecheng.search.dto.SearchPageResultDto;<br><span class="hljs-keyword">import</span> com.xuecheng.search.po.CourseIndex;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span> 课程搜索service</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022/9/24 22:40</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CourseSearchService</span> &#123;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@description</span> 搜索课程列表</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageParams 分页参数</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> searchCourseParamDto 搜索条件</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> com.xuecheng.base.model.PageResult&lt;com.xuecheng.search.po.CourseIndex&gt; 课程列表</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@date</span> 2022/9/24 22:45</span><br><span class="hljs-comment">    */</span><br>    SearchPageResultDto&lt;CourseIndex&gt; <span class="hljs-title function_">queryCoursePubIndex</span><span class="hljs-params">(PageParams pageParams, SearchCourseParamDto searchCourseParamDto)</span>;<br><br> &#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="基本功能测试"><a href="#基本功能测试" class="headerlink" title="基本功能测试"></a><strong>基本功能测试</strong></h5><p>当输入查询条件时会查询全部课程信息并支持分页查询。</p>
<p>1、准备测试</p>
<p>启动nginx、网关、搜索服务。</p>
<p>使用kibana通过rest api向索引库添加课程信息，或通过httpclient添加课程信息，至少添加两条信息。</p>
<p>2、进入搜索界面</p>
<p>默认查询出刚才添加的课程信息。</p>
<p>3、修改分页参数测试分页</p>
<p>打开course&#x2F; search.html页面 ，找到如下图所示位置</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231224131757064.png" srcset="/img/loading.gif" lazyload alt="image-20231224131757064"></p>
<p>修改pageSize为1,即一页显示一条记录。</p>
<p>刷新搜索界面，每页显示一条记录，如下图：</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231224132427572.png" srcset="/img/loading.gif" lazyload alt="image-20231224132427572" style="zoom:80%;" />

<h5 id="根据条件搜索"><a href="#根据条件搜索" class="headerlink" title="根据条件搜索"></a><strong>根据条件搜索</strong></h5><p>下边实现根据关键、一级分类、二级分类、难度等级搜索。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs java">Java<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> SearchPageResultDto&lt;CourseIndex&gt; <span class="hljs-title function_">queryCoursePubIndex</span><span class="hljs-params">(PageParams pageParams, SearchCourseParamDto courseSearchParam)</span> &#123;<br><br>    <span class="hljs-comment">//设置索引</span><br>    <span class="hljs-type">SearchRequest</span> <span class="hljs-variable">searchRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchRequest</span>(courseIndexStore);<br><br>    <span class="hljs-type">SearchSourceBuilder</span> <span class="hljs-variable">searchSourceBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchSourceBuilder</span>();<br>    <span class="hljs-type">BoolQueryBuilder</span> <span class="hljs-variable">boolQueryBuilder</span> <span class="hljs-operator">=</span> QueryBuilders.boolQuery();<br>    <span class="hljs-comment">//source源字段过虑</span><br>    String[] sourceFieldsArray = sourceFields.split(<span class="hljs-string">&quot;,&quot;</span>);<br>    searchSourceBuilder.fetchSource(sourceFieldsArray, <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;&#125;);<br>    <span class="hljs-keyword">if</span>(courseSearchParam==<span class="hljs-literal">null</span>)&#123;<br>        courseSearchParam = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchCourseParamDto</span>();<br>    &#125;<br>    <span class="hljs-comment">//关键字</span><br>    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getKeywords()))&#123;<br>        <span class="hljs-comment">//匹配关键字</span><br>        <span class="hljs-type">MultiMatchQueryBuilder</span> <span class="hljs-variable">multiMatchQueryBuilder</span> <span class="hljs-operator">=</span> QueryBuilders.multiMatchQuery(courseSearchParam.getKeywords(), <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;description&quot;</span>);<br>        <span class="hljs-comment">//设置匹配占比</span><br>        multiMatchQueryBuilder.minimumShouldMatch(<span class="hljs-string">&quot;70%&quot;</span>);<br>        <span class="hljs-comment">//提升另个字段的Boost值</span><br>        multiMatchQueryBuilder.field(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-number">10</span>);<br>        boolQueryBuilder.must(multiMatchQueryBuilder);<br>    &#125;<br>    <span class="hljs-comment">//过虑</span><br>    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getMt()))&#123;<br>        boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">&quot;mtName&quot;</span>,courseSearchParam.getMt()));<br>    &#125;<br>    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getSt()))&#123;<br>        boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">&quot;stName&quot;</span>,courseSearchParam.getSt()));<br>    &#125;<br>    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getGrade()))&#123;<br>        boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">&quot;grade&quot;</span>,courseSearchParam.getGrade()));<br>    &#125;<br>    <span class="hljs-comment">//分页</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">pageNo</span> <span class="hljs-operator">=</span> pageParams.getPageNo();<br>    <span class="hljs-type">Long</span> <span class="hljs-variable">pageSize</span> <span class="hljs-operator">=</span> pageParams.getPageSize();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) ((pageNo-<span class="hljs-number">1</span>)*pageSize);<br>    searchSourceBuilder.from(start);<br>    searchSourceBuilder.size(Math.toIntExact(pageSize));<br>    <span class="hljs-comment">//布尔查询</span><br>    searchSourceBuilder.query(boolQueryBuilder);<br>    <br>    <span class="hljs-comment">//请求搜索</span><br>    searchRequest.source(searchSourceBuilder);<br>   <br>    <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">searchResponse</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);<br>    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>        e.printStackTrace();<br>        log.error(<span class="hljs-string">&quot;课程搜索异常：&#123;&#125;&quot;</span>,e.getMessage());<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchPageResultDto</span>&lt;CourseIndex&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>(),<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//结果集处理</span><br>    <span class="hljs-type">SearchHits</span> <span class="hljs-variable">hits</span> <span class="hljs-operator">=</span> searchResponse.getHits();<br>    SearchHit[] searchHits = hits.getHits();<br>    <span class="hljs-comment">//记录总数</span><br>    <span class="hljs-type">TotalHits</span> <span class="hljs-variable">totalHits</span> <span class="hljs-operator">=</span> hits.getTotalHits();<br>    <span class="hljs-comment">//数据列表</span><br>    List&lt;CourseIndex&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">for</span> (SearchHit hit : searchHits) &#123;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">sourceAsString</span> <span class="hljs-operator">=</span> hit.getSourceAsString();<br>        <span class="hljs-type">CourseIndex</span> <span class="hljs-variable">courseIndex</span> <span class="hljs-operator">=</span> JSON.parseObject(sourceAsString, CourseIndex.class);<br><br>        <br>        list.add(courseIndex);<br><br>    &#125;<br>    SearchPageResultDto&lt;CourseIndex&gt; pageResult = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchPageResultDto</span>&lt;&gt;(list, totalHits.value,pageNo,pageSize);<br><br>    <br><br>    <span class="hljs-keyword">return</span> pageResult;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="条件搜索测试"><a href="#条件搜索测试" class="headerlink" title="条件搜索测试"></a><strong>条件搜索测试</strong></h5><p>进入搜索界面，输入关键字进行测试。</p>
<p>一级分类、二级分类在下边的聚合搜索中测试。</p>
<h5 id="聚合搜索"><a href="#聚合搜索" class="headerlink" title="聚合搜索"></a><strong>聚合搜索</strong></h5><p>搜索界面上显示的一级分类、二级分类来源于搜索结果，使用聚合搜索实现找到搜索结果中的一级分类、二级分类。</p>
<p>1、首先在搜索结构DTO中添加一级分类、二级分类列表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java">Java<br><span class="hljs-keyword">package</span> com.xuecheng.search.dto;<br><br><span class="hljs-keyword">import</span> com.xuecheng.base.model.PageResult;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.ToString;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.M</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span> TODO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022/9/25 17:51</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ToString</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SearchPageResultDto</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PageResult</span> &#123;<br><br>    <span class="hljs-comment">//大分类列表</span><br>    List&lt;String&gt; mtList;<br>    <span class="hljs-comment">//小分类列表</span><br>    List&lt;String&gt; stList;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SearchPageResultDto</span><span class="hljs-params">(List&lt;T&gt; items, <span class="hljs-type">long</span> counts, <span class="hljs-type">long</span> page, <span class="hljs-type">long</span> pageSize)</span> &#123;<br>        <span class="hljs-built_in">super</span>(items, counts, page, pageSize);<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>2、搜索方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs java">Java<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> SearchPageResultDto&lt;CourseIndex&gt; <span class="hljs-title function_">queryCoursePubIndex</span><span class="hljs-params">(PageParams pageParams, SearchCourseParamDto courseSearchParam)</span> &#123;<br><br>    <span class="hljs-comment">//设置索引</span><br>    <span class="hljs-type">SearchRequest</span> <span class="hljs-variable">searchRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchRequest</span>(courseIndexStore);<br><br>    <span class="hljs-type">SearchSourceBuilder</span> <span class="hljs-variable">searchSourceBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchSourceBuilder</span>();<br>    <span class="hljs-type">BoolQueryBuilder</span> <span class="hljs-variable">boolQueryBuilder</span> <span class="hljs-operator">=</span> QueryBuilders.boolQuery();<br>    <span class="hljs-comment">//source源字段过虑</span><br>    String[] sourceFieldsArray = sourceFields.split(<span class="hljs-string">&quot;,&quot;</span>);<br>    searchSourceBuilder.fetchSource(sourceFieldsArray, <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;&#125;);<br>    <span class="hljs-keyword">if</span>(courseSearchParam==<span class="hljs-literal">null</span>)&#123;<br>        courseSearchParam = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchCourseParamDto</span>();<br>    &#125;<br>    <span class="hljs-comment">//关键字</span><br>    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getKeywords()))&#123;<br>        <span class="hljs-comment">//匹配关键字</span><br>        <span class="hljs-type">MultiMatchQueryBuilder</span> <span class="hljs-variable">multiMatchQueryBuilder</span> <span class="hljs-operator">=</span> QueryBuilders.multiMatchQuery(courseSearchParam.getKeywords(), <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;description&quot;</span>);<br>        <span class="hljs-comment">//设置匹配占比</span><br>        multiMatchQueryBuilder.minimumShouldMatch(<span class="hljs-string">&quot;70%&quot;</span>);<br>        <span class="hljs-comment">//提升另个字段的Boost值</span><br>        multiMatchQueryBuilder.field(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-number">10</span>);<br>        boolQueryBuilder.must(multiMatchQueryBuilder);<br>    &#125;<br>    <span class="hljs-comment">//过虑</span><br>    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getMt()))&#123;<br>        boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">&quot;mtName&quot;</span>,courseSearchParam.getMt()));<br>    &#125;<br>    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getSt()))&#123;<br>        boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">&quot;stName&quot;</span>,courseSearchParam.getSt()));<br>    &#125;<br>    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getGrade()))&#123;<br>        boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">&quot;grade&quot;</span>,courseSearchParam.getGrade()));<br>    &#125;<br>    <span class="hljs-comment">//分页</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">pageNo</span> <span class="hljs-operator">=</span> pageParams.getPageNo();<br>    <span class="hljs-type">Long</span> <span class="hljs-variable">pageSize</span> <span class="hljs-operator">=</span> pageParams.getPageSize();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) ((pageNo-<span class="hljs-number">1</span>)*pageSize);<br>    searchSourceBuilder.from(start);<br>    searchSourceBuilder.size(Math.toIntExact(pageSize));<br>    <span class="hljs-comment">//布尔查询</span><br>    searchSourceBuilder.query(boolQueryBuilder);<br>   <br>   <br>    <span class="hljs-comment">//请求搜索</span><br>    searchRequest.source(searchSourceBuilder);<br>    <span class="hljs-comment">//聚合设置</span><br>    buildAggregation(searchRequest);<br>    <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">searchResponse</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);<br>    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>        e.printStackTrace();<br>        log.error(<span class="hljs-string">&quot;课程搜索异常：&#123;&#125;&quot;</span>,e.getMessage());<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchPageResultDto</span>&lt;CourseIndex&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>(),<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//结果集处理</span><br>    <span class="hljs-type">SearchHits</span> <span class="hljs-variable">hits</span> <span class="hljs-operator">=</span> searchResponse.getHits();<br>    SearchHit[] searchHits = hits.getHits();<br>    <span class="hljs-comment">//记录总数</span><br>    <span class="hljs-type">TotalHits</span> <span class="hljs-variable">totalHits</span> <span class="hljs-operator">=</span> hits.getTotalHits();<br>    <span class="hljs-comment">//数据列表</span><br>    List&lt;CourseIndex&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">for</span> (SearchHit hit : searchHits) &#123;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">sourceAsString</span> <span class="hljs-operator">=</span> hit.getSourceAsString();<br>        <span class="hljs-type">CourseIndex</span> <span class="hljs-variable">courseIndex</span> <span class="hljs-operator">=</span> JSON.parseObject(sourceAsString, CourseIndex.class);<br><br>        <br><br>        list.add(courseIndex);<br><br>    &#125;<br>    SearchPageResultDto&lt;CourseIndex&gt; pageResult = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchPageResultDto</span>&lt;&gt;(list, totalHits.value,pageNo,pageSize);<br><br>    <span class="hljs-comment">//获取聚合结果</span><br>    List&lt;String&gt; mtList= getAggregation(searchResponse.getAggregations(), <span class="hljs-string">&quot;mtAgg&quot;</span>);<br>    List&lt;String&gt; stList = getAggregation(searchResponse.getAggregations(), <span class="hljs-string">&quot;stAgg&quot;</span>);<br><br>    pageResult.setMtList(mtList);<br>    pageResult.setStList(stList);<br><br>    <span class="hljs-keyword">return</span> pageResult;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="聚合搜索测试"><a href="#聚合搜索测试" class="headerlink" title="聚合搜索测试"></a><strong>聚合搜索测试</strong></h5><p>进入搜索界面，观察搜索请求的响应内容中是否存在mtList和stList.</p>
<p>观察页面一级分类、二级分类是否有分类信息。</p>
<p>注意：当选中一个一级分类时才会显示二级分类。</p>
<h5 id="高亮设置"><a href="#高亮设置" class="headerlink" title="高亮设置"></a><strong>高亮设置</strong></h5><p>最后实现关键词在课程名称中高亮显示。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs java">Java<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> SearchPageResultDto&lt;CourseIndex&gt; <span class="hljs-title function_">queryCoursePubIndex</span><span class="hljs-params">(PageParams pageParams, SearchCourseParamDto courseSearchParam)</span> &#123;<br><br>    <span class="hljs-comment">//设置索引</span><br>    <span class="hljs-type">SearchRequest</span> <span class="hljs-variable">searchRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchRequest</span>(courseIndexStore);<br><br>    <span class="hljs-type">SearchSourceBuilder</span> <span class="hljs-variable">searchSourceBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchSourceBuilder</span>();<br>    <span class="hljs-type">BoolQueryBuilder</span> <span class="hljs-variable">boolQueryBuilder</span> <span class="hljs-operator">=</span> QueryBuilders.boolQuery();<br>    <span class="hljs-comment">//source源字段过虑</span><br>    String[] sourceFieldsArray = sourceFields.split(<span class="hljs-string">&quot;,&quot;</span>);<br>    searchSourceBuilder.fetchSource(sourceFieldsArray, <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;&#125;);<br>    <span class="hljs-keyword">if</span>(courseSearchParam==<span class="hljs-literal">null</span>)&#123;<br>        courseSearchParam = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchCourseParamDto</span>();<br>    &#125;<br>    <span class="hljs-comment">//关键字</span><br>    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getKeywords()))&#123;<br>        <span class="hljs-comment">//匹配关键字</span><br>        <span class="hljs-type">MultiMatchQueryBuilder</span> <span class="hljs-variable">multiMatchQueryBuilder</span> <span class="hljs-operator">=</span> QueryBuilders.multiMatchQuery(courseSearchParam.getKeywords(), <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;description&quot;</span>);<br>        <span class="hljs-comment">//设置匹配占比</span><br>        multiMatchQueryBuilder.minimumShouldMatch(<span class="hljs-string">&quot;70%&quot;</span>);<br>        <span class="hljs-comment">//提升另个字段的Boost值</span><br>        multiMatchQueryBuilder.field(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-number">10</span>);<br>        boolQueryBuilder.must(multiMatchQueryBuilder);<br>    &#125;<br>    <span class="hljs-comment">//过虑</span><br>    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getMt()))&#123;<br>        boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">&quot;mtName&quot;</span>,courseSearchParam.getMt()));<br>    &#125;<br>    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getSt()))&#123;<br>        boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">&quot;stName&quot;</span>,courseSearchParam.getSt()));<br>    &#125;<br>    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getGrade()))&#123;<br>        boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">&quot;grade&quot;</span>,courseSearchParam.getGrade()));<br>    &#125;<br>    <span class="hljs-comment">//分页</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">pageNo</span> <span class="hljs-operator">=</span> pageParams.getPageNo();<br>    <span class="hljs-type">Long</span> <span class="hljs-variable">pageSize</span> <span class="hljs-operator">=</span> pageParams.getPageSize();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) ((pageNo-<span class="hljs-number">1</span>)*pageSize);<br>    searchSourceBuilder.from(start);<br>    searchSourceBuilder.size(Math.toIntExact(pageSize));<br>    <span class="hljs-comment">//布尔查询</span><br>    searchSourceBuilder.query(boolQueryBuilder);<br>    <span class="hljs-comment">//高亮设置</span><br>    <span class="hljs-type">HighlightBuilder</span> <span class="hljs-variable">highlightBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightBuilder</span>();<br>    highlightBuilder.preTags(<span class="hljs-string">&quot;&lt;font class=&#x27;eslight&#x27;&gt;&quot;</span>);<br>    highlightBuilder.postTags(<span class="hljs-string">&quot;&lt;/font&gt;&quot;</span>);<br>    <span class="hljs-comment">//设置高亮字段</span><br>    highlightBuilder.fields().add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightBuilder</span>.Field(<span class="hljs-string">&quot;name&quot;</span>));<br>    searchSourceBuilder.highlighter(highlightBuilder);<br>    <span class="hljs-comment">//请求搜索</span><br>    searchRequest.source(searchSourceBuilder);<br>    <span class="hljs-comment">//聚合设置</span><br>    buildAggregation(searchRequest);<br>    <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">searchResponse</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);<br>    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>        e.printStackTrace();<br>        log.error(<span class="hljs-string">&quot;课程搜索异常：&#123;&#125;&quot;</span>,e.getMessage());<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchPageResultDto</span>&lt;CourseIndex&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>(),<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//结果集处理</span><br>    <span class="hljs-type">SearchHits</span> <span class="hljs-variable">hits</span> <span class="hljs-operator">=</span> searchResponse.getHits();<br>    SearchHit[] searchHits = hits.getHits();<br>    <span class="hljs-comment">//记录总数</span><br>    <span class="hljs-type">TotalHits</span> <span class="hljs-variable">totalHits</span> <span class="hljs-operator">=</span> hits.getTotalHits();<br>    <span class="hljs-comment">//数据列表</span><br>    List&lt;CourseIndex&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">for</span> (SearchHit hit : searchHits) &#123;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">sourceAsString</span> <span class="hljs-operator">=</span> hit.getSourceAsString();<br>        <span class="hljs-type">CourseIndex</span> <span class="hljs-variable">courseIndex</span> <span class="hljs-operator">=</span> JSON.parseObject(sourceAsString, CourseIndex.class);<br><br>        <span class="hljs-comment">//取出source</span><br>        Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();<br><br>        <span class="hljs-comment">//课程id</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> courseIndex.getId();<br>        <span class="hljs-comment">//取出名称</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> courseIndex.getName();<br>        <span class="hljs-comment">//取出高亮字段内容</span><br>        Map&lt;String, HighlightField&gt; highlightFields = hit.getHighlightFields();<br>        <span class="hljs-keyword">if</span>(highlightFields!=<span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-type">HighlightField</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> highlightFields.get(<span class="hljs-string">&quot;name&quot;</span>);<br>            <span class="hljs-keyword">if</span>(nameField!=<span class="hljs-literal">null</span>)&#123;<br>                Text[] fragments = nameField.getFragments();<br>                <span class="hljs-type">StringBuffer</span> <span class="hljs-variable">stringBuffer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuffer</span>();<br>                <span class="hljs-keyword">for</span> (Text str : fragments) &#123;<br>                    stringBuffer.append(str.string());<br>                &#125;<br>                name = stringBuffer.toString();<br><br>            &#125;<br>        &#125;<br>        courseIndex.setId(id);<br>        courseIndex.setName(name);<br><br>        list.add(courseIndex);<br><br>    &#125;<br>    SearchPageResultDto&lt;CourseIndex&gt; pageResult = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchPageResultDto</span>&lt;&gt;(list, totalHits.value,pageNo,pageSize);<br><br>    <span class="hljs-comment">//获取聚合结果</span><br>    List&lt;String&gt; mtList= getAggregation(searchResponse.getAggregations(), <span class="hljs-string">&quot;mtAgg&quot;</span>);<br>    List&lt;String&gt; stList = getAggregation(searchResponse.getAggregations(), <span class="hljs-string">&quot;stAgg&quot;</span>);<br><br>    pageResult.setMtList(mtList);<br>    pageResult.setStList(stList);<br><br>    <span class="hljs-keyword">return</span> pageResult;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="高亮设置测试"><a href="#高亮设置测试" class="headerlink" title="高亮设置测试"></a><strong>高亮设置测试</strong></h5><p>输入关键字，观察搜索结果，标题中是否对关键字信息进行高亮显示。</p>
<h4 id="课程信息索引同步"><a href="#课程信息索引同步" class="headerlink" title="课程信息索引同步"></a><strong>课程信息索引同步</strong></h4><h5 id="技术方案"><a href="#技术方案" class="headerlink" title="技术方案"></a><strong>技术方案</strong></h5><p>通过向索引中添加课程信息最终实现了课程的搜索，我们发现课程信息是先保存在关系数据库中，而后再写入索引，这个过程是将关系数据中的数据同步到elasticsearch索引中的过程，可以简单成为索引同步。</p>
<p>通常项目中使用elasticsearch需要完成索引同步，索引同步的方法很多：</p>
<p>1、针对实时性非常高的场景需要满足数据的及时同步，可以同步调用，或使用Canal去实现。</p>
<p>1）同步调用即在向MySQL写数据后远程调用搜索服务的接口写入索引，此方法简单但是耦合代码太高。</p>
<p>2）可以使用一个中间的软件canal解决耦合性的问题，但存在学习与维护成本。</p>
<p>canal主要用途是基于 MySQL 数据库增量日志解析，并能提供增量数据订阅和消费，实现将MySQL的数据同步到消息队列、Elasticsearch、其它数据库等，应用场景十分丰富。 </p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231224133743094.png" srcset="/img/loading.gif" lazyload alt="image-20231224133743094" style="zoom:75%;" />

<p>它的地址：</p>
<p>github地址：<a target="_blank" rel="noopener" href="https://github.com/alibaba/canal">https://github.com/alibaba/canal</a> </p>
<p>版本下载地址：<a target="_blank" rel="noopener" href="https://github.com/alibaba/canal/releases">https://github.com/alibaba/canal/releases</a></p>
<p>文档地址：<a target="_blank" rel="noopener" href="https://github.com/alibaba/canal/wiki/Docker-QuickStart">https://github.com/alibaba/canal/wiki/Docker-QuickStart</a></p>
<p>Canal基于mysql的binlog技术实现数据同步，什么是binlog，它是一个文件，二进制格式，记录了对数据库更新的SQL语句，向数据库写数据的同时向binlog文件里记录对应的sql语句。当数据库服务器发生了故障就可以使用binlog文件对数据库进行恢复。</p>
<p>所以，使用canal是需要开启mysql的binlog写入功能，Canal工作原理如下：</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231224133815260.png" srcset="/img/loading.gif" lazyload alt="image-20231224133815260" style="zoom:67%;" />

<p>1、canal 模拟 MySQL slave 的交互协议，伪装自己为 MySQL slave ，向 MySQL master 发送dump </p>
<p>协议 </p>
<p>2、MySQL master 收到 dump 请求，开始推送 binary log 给 slave (即 canal ) </p>
<p>3、canal 解析 binary log 对象(原始为 byte 流)</p>
<p>详细使用Canal进行索引同步的步骤参考：Canal实现索引同步.pdf</p>
<p>2、当索引同步的实时性要求不高时可用的技术比较多，比如：MQ、Logstash、任务调度等。</p>
<p>MQ：向mysql写数据的时候向mq写入消息，搜索服务监听MQ，收到消息后写入索引。使用MQ的优势是代码解耦，但是需要处理消息可靠性的问题有一定的技术成本，做到消息可靠性需要做到生产者投递成功、消息持久化以及消费者消费成功三个方面，另外还要做好消息幂等性问题。</p>
<p>Logstash： 开源实时日志分析平台 ELK包括Elasticsearch、Kibana、Logstash，Logstash负责收集、解析和转换日志信息，可以实现MySQL与Elasticsearch之间的数据同步。也可以实现解耦合并且是官方推荐，但需要增加学习与维护成本。</p>
<p>任务调度：向mysql写数据的时候记录修改记录，开启一个定时任务根据修改记录将数据同步到Elasticsearch。</p>
<p>根据本项目的需求，课程发布后信息同步的实时性要求不高，从提交审核到发布成功一般两个工作日完成。综合比较以上技术方案本项目的索引同步技术使用任务调度的方法。</p>
<p>如下图：</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231224133839643.png" srcset="/img/loading.gif" lazyload alt="image-20231224133839643"></p>
<p>1、课程发布向消息表插入记录。</p>
<p>2、由任务调度程序通过消息处理SDK对消息记录进行处理。</p>
<p>3、向elasticsearch索引中保存课程信息。</p>
<p>如何向向elasticsearch索引中保存课程信息？</p>
<p>执行流程如下：</p>
<p>由内容管理服务远程调用搜索服务添加课程信息索引，搜索服务再请求elasticsearch向课程索引中添加文档。</p>
<h5 id="课程索引任务开发"><a href="#课程索引任务开发" class="headerlink" title="课程索引任务开发"></a><strong>课程索引任务开发</strong></h5><p>1、拷贝CourseIndex 模型类到内容管理model 工程的dto包下。</p>
<p>2、在内容管理服务中添加FeignClient</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">package</span> com.xuecheng.content.feignclient;<br><br><span class="hljs-keyword">import</span> com.xuecheng.content.model.dto.CourseIndex;<br><span class="hljs-keyword">import</span> org.springframework.cloud.openfeign.FeignClient;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RequestBody;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 搜索服务远程接口</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 付广建 2023/12/24 13:41</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@FeignClient(value = <span class="hljs-string">&quot;search&quot;</span>,fallbackFactory = SearchServiceClientFallbackFactory.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SearchServiceClient</span> &#123;<br>    <span class="hljs-meta">@PostMapping(<span class="hljs-string">&quot;/search/index/course&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">Boolean</span> add(<span class="hljs-meta">@RequestBody</span> CourseIndex courseIndex);<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>定义SearchServiceClientFallbackFactory ：</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">package</span> com.xuecheng.content.feignclient;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * @author 付广建 2023/12/24 13:42</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">import</span> com.xuecheng.content.model.dto.CourseIndex;<br><span class="hljs-keyword">import</span> feign.hystrix.FallbackFactory;<br><span class="hljs-keyword">import</span> lombok.<span class="hljs-keyword">extern</span>.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchServiceClientFallbackFactory</span> <span class="hljs-keyword"><span class="hljs-keyword">implements</span> <span class="hljs-type">FallbackFactory</span></span>&lt;<span class="hljs-title">SearchServiceClient</span>&gt; </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> SearchServiceClient create(Throwable throwable) &#123;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">SearchServiceClient</span>() &#123;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> Boolean add(CourseIndex courseIndex) &#123;<br>                throwable.printStackTrace();<br>                log.debug(<span class="hljs-string">&quot;调用搜索发生熔断走降级方法,熔断异常:&quot;</span>, throwable.getMessage());<br><br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>3、编写课程索引任务执行方法</p>
<p>完善CoursePublishTask类中的saveCourseIndex方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 向es课程写索引数据</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveCourseIndex</span><span class="hljs-params">(MqMessage mqMessage, <span class="hljs-type">long</span> courseId)</span> &#123;<br>    log.info(<span class="hljs-string">&quot;开始向es课程写索引数据,课程id:&#123;&#125;&quot;</span>, courseId);<br>    <span class="hljs-comment">// 消息id</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> mqMessage.getId();<br>    <span class="hljs-comment">// 消息处理的service</span><br>    <span class="hljs-type">MqMessageService</span> <span class="hljs-variable">mqMessageService</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getMqMessageService();<br>    <span class="hljs-comment">// 消息幂等性处理  -&gt; 阶段1处理状态, 0:初始，1:成功</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">stageTwo</span> <span class="hljs-operator">=</span> mqMessageService.getStageTwo(id);<br>    <span class="hljs-keyword">if</span> (stageTwo &gt; <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// 1 成功,不处理</span><br>        log.debug(<span class="hljs-string">&quot;课程索引信息已经写入,无需执行...,课程id:&#123;&#125;&quot;</span>, courseId);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-comment">// 查询课程信息,调用搜索服务添加索引...</span><br>    <span class="hljs-type">Boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> saveCourseIndex(courseId);<br><br>    <span class="hljs-comment">// 保存第2阶段状态(完成)</span><br>    mqMessageService.completedStageTwo(id);<br>&#125;<br><br><span class="hljs-keyword">private</span> Boolean <span class="hljs-title function_">saveCourseIndex</span><span class="hljs-params">(Long courseId)</span> &#123;<br>    <span class="hljs-comment">//取出课程发布信息</span><br>    <span class="hljs-type">CoursePublish</span> <span class="hljs-variable">coursePublish</span> <span class="hljs-operator">=</span> coursePublishMapper.selectById(courseId);<br>    <span class="hljs-comment">//拷贝至课程索引对象</span><br>    <span class="hljs-type">CourseIndex</span> <span class="hljs-variable">courseIndex</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CourseIndex</span>();<br>    BeanUtils.copyProperties(coursePublish, courseIndex);<br>    <span class="hljs-comment">//远程调用搜索服务api添加搜索信息到索引</span><br>    <span class="hljs-type">Boolean</span> <span class="hljs-variable">add</span> <span class="hljs-operator">=</span> searchServiceClient.add(courseIndex);<br>    <span class="hljs-keyword">if</span> (!add)&#123;<br>        XueChengPlusException.cast(<span class="hljs-string">&quot;添加索引失败&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> add;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="测试-2"><a href="#测试-2" class="headerlink" title="测试"></a><strong>测试</strong></h5><p>测试流程如下：</p>
<p>1、启动elasticsearch、kibana。</p>
<p>2、启动网关、内容管理、搜索服务、nginx。</p>
<p>3、启动xxl-job调度中心。</p>
<p>4、在任务调度中心开始课程发布任务。</p>
<p>5、发布一门课程，页面提示操作成功，查看发布课程任务是否写到任务表。</p>
<p>6、经过任务调度将课程信息写入索引。</p>
<p>7、通过门户进入搜索页面，查看课程信息是否展示</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E9%A1%B9%E7%9B%AE/" class="category-chain-item">项目</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/" class="print-no-link">#学成在线</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>学成在线课程发布模块</div>
      <div>http://example.com/2023/12/24/学成在线课程发布模块/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>fgj</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年12月24日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/12/24/%E7%A7%91%E7%9B%AE%E4%B8%80/" title="科目一">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">科目一</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/12/21/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97/" title="学成在线媒资管理模块">
                        <span class="hidden-mobile">学成在线媒资管理模块</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":173,"height":346},"mobile":{"show":true},"log":false});</script></body>
</html>
