

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="fgj">
  <meta name="keywords" content="">
  
    <meta name="description" content="学成在线项目部署模块什么是	DevOps（开发运维）一个软件的生命周期：需求分析，设计，开发，测试，上线，维护，升级，废弃 通过示例说明如下： 1、产品人员进行需求分析 2、设计人员进行软件架构设计和模块设计。 3、每个模块的开发人员并行开发，设计接口、进行编码，并进行单元测试 4、开发完毕，将代码集成部署到测试服务器，测试人员进行测试。 5、测试人员发现bug，提交bug、开发人员修改bug 6">
<meta property="og:type" content="article">
<meta property="og:title" content="学成在线项目部署模块">
<meta property="og:url" content="http://example.com/2023/12/28/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E6%A8%A1%E5%9D%97/index.html">
<meta property="og:site_name" content="FGJ">
<meta property="og:description" content="学成在线项目部署模块什么是	DevOps（开发运维）一个软件的生命周期：需求分析，设计，开发，测试，上线，维护，升级，废弃 通过示例说明如下： 1、产品人员进行需求分析 2、设计人员进行软件架构设计和模块设计。 3、每个模块的开发人员并行开发，设计接口、进行编码，并进行单元测试 4、开发完毕，将代码集成部署到测试服务器，测试人员进行测试。 5、测试人员发现bug，提交bug、开发人员修改bug 6">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228200355683.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228200603978.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228200627203.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228200636686.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228200738483.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228201552684.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228201732974.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228201836868.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228201933732.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228202154560.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228203839170.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228203901778.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228203911395.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228203918090.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228204051305.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228204058658.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228204113444.png">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/clip_image002.gif">
<meta property="og:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/clip_image004.gif">
<meta property="article:published_time" content="2023-12-28T12:44:26.000Z">
<meta property="article:modified_time" content="2023-12-28T12:44:46.414Z">
<meta property="article:author" content="fgj">
<meta property="article:tag" content="学成在线">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228200355683.png">
  
  
  
  <title>学成在线项目部署模块 - FGJ</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Home</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://fgj2.oss-cn-beijing.aliyuncs.com/ddd.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="学成在线项目部署模块"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-12-28 20:44" pubdate>
          2023年12月28日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          14k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          121 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">学成在线项目部署模块</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="学成在线"><a href="#学成在线" class="headerlink" title="学成在线"></a>学成在线</h1><h2 id="项目部署模块"><a href="#项目部署模块" class="headerlink" title="项目部署模块"></a>项目部署模块</h2><h3 id="什么是DevOps（开发运维）"><a href="#什么是DevOps（开发运维）" class="headerlink" title="什么是	DevOps（开发运维）"></a>什么是	DevOps（开发运维）</h3><p>一个软件的生命周期：需求分析，设计，开发，测试，上线，维护，升级，废弃</p>
<p>通过示例说明如下：</p>
<p>1、产品人员进行需求分析</p>
<p>2、设计人员进行软件架构设计和模块设计。</p>
<p>3、每个模块的开发人员并行开发，设计接口、进行编码，并进行单元测试</p>
<p>4、开发完毕，将代码集成部署到测试服务器，测试人员进行测试。</p>
<p>5、测试人员发现bug，提交bug、开发人员修改bug</p>
<p>6、bug修改完毕再次集成、测试。</p>
<p>7、测试完毕，项目上线。</p>
<p>8、运维人员进行安装部署、培训。</p>
<p>9、用户提出问题，返回给运维人员。</p>
<p>10、运维人员反馈给开发人员，开发人员进行问题处理。</p>
<p>11、再次提交测试。</p>
<p>12、测试完毕再次部署升级。</p>
<p>最后软件上线。</p>
<p>整体生命周期比较核心的两个阶段是：开发阶段，维护阶段，开发阶段的成果是软件开发完成并成功上线，运维阶段则负责对软件的维护和升级，而运维阶段通常在一个软件 的生命周期中占比最多。</p>
<p>提高开发阶段、运维阶段的工作效率是企业在进行软件项目管理的重点。</p>
<p>因此，专家提出了DevOps，DevOps是什么呢？</p>
<p>下边是摘自百度百科的定义：</p>
<p>DevOps（Development和Operations的组合词）是一组过程、方法与系统的统称，用于促进开发（<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/5985445?fromModule=lemma_inlink">应用程序</a>&#x2F;软件工程）、技术运营和质量保障（<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/QA/476016?fromModule=lemma_inlink">QA</a>）部门之间的沟通、协作与整合。</p>
<p>它是一种重视“<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/3448966?fromModule=lemma_inlink">软件开发</a>人员（Dev）”和“<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/IT%E8%BF%90%E7%BB%B4/5727814?fromModule=lemma_inlink">IT运维</a>技术人员（Ops）”之间沟通合作的<code>文化、运动或惯例</code>。透过自动化“<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%BD%AF%E4%BB%B6%E4%BA%A4%E4%BB%98/638479?fromModule=lemma_inlink">软件交付</a>”和“架构变更”的流程，来使得构建、测试、发布软件能够更加地快捷、频繁和可靠。</p>
<p>他的出现是由于软件行业日益清晰认识到：为了按时交付软件产品和服务，开发和运维工作必须紧密合作</p>
<p>DevOps是一个工具吗？</p>
<p>DevOps是一个工作职位吗？</p>
<p>都不是。</p>
<p>DevOps是一种思想理念，它涵盖开发、测试、运维的整个过程。DevOps追求的目标是提高软件开发、测试、运维、运营等各部门的沟通与协作质量，DevOps强调软件开发人员与软件测试、软件运维、质量保障（QA）部门之间有效的沟通与协作，强调通过自动化方法去管理软件变更，软件集成，使软件从构建到测试，发布更加快捷，可靠，最终按时交付软件。</p>
<h3 id="什么是CI-CD"><a href="#什么是CI-CD" class="headerlink" title="什么是CI&#x2F;CD"></a><strong>什么是CI&#x2F;CD</strong></h3><p>如何落地实现DevOps呢？</p>
<p>DevOps兴起于2009年，近年来由于云计算、互联网的发展，促进了DevOps的基础设施及工具链的发展，涌现了一大批优秀的工具，这些工具包括开发、测试、运维的各各领域，例如：GitHub、Docker、Jenkins、Hudson、K8S、Ant&#x2F;Maven&#x2F;Gradle、Selenium、QUnit、JMeter等。下图是DevOps相关的工具集：</p>
<img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228200355683.png" srcset="/img/loading.gif" lazyload alt="image-20231228200355683" style="zoom:150%;" />

<p>好的工具有利于DevOps的实施，但不代表实施DevOps一定需要引入一堆工具</p>
<p>问题的关键：如何解决问题，而不是具体应用工具。</p>
<p>CI&#x2F;CD 是近年来企业有效实施DevOps的具体方案。</p>
<p>CI&#x2F;CD 包含了一个 CI 和两个 CD，CI全称 Continuous Integration，表示<code>持续集成</code>，CD包含 Continuous Delivery和 Continuous Deployment，分别是<code>持续交付和持续部署</code>，三者具有前后依赖关系。</p>
<p>CI 持续集成：</p>
<p>持续集成倡导团队成员需要频繁的集成他们的工作，将开发分支合并到主分支，每次集成都通过自动化构建（包括编译、构建、自动化测试）来验证，从而尽快地发现集成中的错误，让产品可以快速迭代，同时还能保持高质量。</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228200603978.png" srcset="/img/loading.gif" lazyload alt="image-20231228200603978"></p>
<p>CD持续交付:</p>
<p>持续交付将集成后的代码部署到类生产环境(预发布)，除了交付到类生产环境之外，还会执行一些集成测试、API测试。持续交付强调的是“交付”，交付给测试、产品验收，不管怎么更新，软件是随时随地可以交付的。</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228200627203.png" srcset="/img/loading.gif" lazyload alt="image-20231228200627203"></p>
<p>CD持续部署：</p>
<p>在持续交付的基础上由开发人员或运维人员自助式的定期向生产环境部署稳定的构建版本，持续部署的目标是代码在任何时刻都是可部署的，并可自动进入到生产环境。</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228200636686.png" srcset="/img/loading.gif" lazyload alt="image-20231228200636686"></p>
<h3 id="DevOps-实战"><a href="#DevOps-实战" class="headerlink" title="DevOps 实战"></a>DevOps 实战</h3><h4 id="技术方案"><a href="#技术方案" class="headerlink" title="技术方案"></a><strong>技术方案</strong></h4><p>下图是比较流行的一种CI&#x2F;CD的技术方案：</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228200738483.png" srcset="/img/loading.gif" lazyload alt="image-20231228200738483"></p>
<p>下边我们参考该技术方案将学成在线项目使用Docker进行部署。</p>
<p>本次项目部署实战旨在理解CI&#x2F;CD的流程，考虑Kubernates的复杂性课堂上我们用Jenkins代替Kubernates完成容器部署。</p>
<h4 id="准备环境"><a href="#准备环境" class="headerlink" title="准备环境"></a><strong>准备环境</strong></h4><p>准备一台Centos7 虚拟机，安装Docker、jdk、maven，通过Docker容器安装jenkins、Docker私服软件，其它软件为学成在线项目所需要的，如下：</p>
<table>
<thead>
<tr>
<th>Mysql</th>
<th>8.x</th>
<th>docker</th>
</tr>
</thead>
<tbody><tr>
<td>nacos</td>
<td>1.4.1</td>
<td>docker</td>
</tr>
<tr>
<td>rabbitmq</td>
<td>3.8.34</td>
<td>docker</td>
</tr>
<tr>
<td>redis</td>
<td>6.2.7</td>
<td>docker</td>
</tr>
<tr>
<td>xxl-job-admin</td>
<td>2.3.1</td>
<td>docker</td>
</tr>
<tr>
<td>minio</td>
<td>RELEASE.2022-09-07</td>
<td>docker</td>
</tr>
<tr>
<td>elasticsearch</td>
<td>7.12.1</td>
<td>docker</td>
</tr>
<tr>
<td>kibana</td>
<td>7.12.1</td>
<td>docker</td>
</tr>
<tr>
<td>gogs</td>
<td>0.13.0</td>
<td>docker</td>
</tr>
<tr>
<td>nginx</td>
<td>1.12.2</td>
<td>docker</td>
</tr>
</tbody></table>
<p>在课堂资料中提供了安装以上软件的虚拟机，使用VMware导入即可使用。</p>
<h4 id="人工部署方式"><a href="#人工部署方式" class="headerlink" title="人工部署方式"></a><strong>人工部署方式</strong></h4><p>如果不使用CI&#x2F;CD则需要人工手动对工程进行测试、打包、部署。使用CI&#x2F;CD后通过自动化的工具去完成。</p>
<p>下边先演示手动部署方式，之后采用工具进行部署。</p>
<h5 id="项目打包"><a href="#项目打包" class="headerlink" title="项目打包"></a><strong>项目打包</strong></h5><p>1、在父工程聚合各模块</p>
<p>首先在父(parent)工程添加modules，聚合各个模块</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml">Bash<br><span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>../xuecheng-plus-base<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>../xuecheng-plus-checkcode<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>../xuecheng-plus-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>../xuecheng-plus-auth<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>../xuecheng-plus-content<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>../xuecheng-plus-learning<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>../xuecheng-plus-media<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>../xuecheng-plus-orders<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>../xuecheng-plus-message-sdk<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>../xuecheng-plus-search<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>../xuecheng-plus-system<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>2、配置打包插件</p>
<p>使用springboot打包插件进行打包，在需要打可执行包的工程中配置spring-boot-maven-plugin插件否则报 “jar中没有主清单属性” 。</p>
<p>注意：在要打可执行jar包的工程中配置该插件。需要运行的工程，比如base不用加</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">Bash</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">finalName</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;project.artifactId&#125;</span><span class="language-xml">-$</span><span class="hljs-template-variable">&#123;project.version&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">finalName</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;spring-boot.version&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span></span><br><span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span></span><br><span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>repackage<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span></span><br><span class="language-xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span></span><br><span class="language-xml"></span><br></code></pre></td></tr></table></figure>

<p>说明：</p>
<p>配置了springboot打包插件即可在maven窗口显示如下：</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228201552684.png" srcset="/img/loading.gif" lazyload alt="image-20231228201552684"></p>
<p>功能说明：</p>
<p>build-info：生成项目的构建信息文件 build-info.properties</p>
<p>repackage：这个是默认 goal，在 mvn package 执行之后，这个命令再次打包生成可执行的 jar，同时将 mvn package 生成的 jar 重命名为 *.origin</p>
<p>run：这个可以用来运行 Spring Boot 应用</p>
<p>start：这个在 mvn integration-test 阶段，进行 Spring Boot 应用生命周期的管理</p>
<p>stop：这个在 mvn integration-test 阶段，进行 Spring Boot 应用生命周期的管理</p>
<p>在父工程执行：<code>clean install -DskipTests -f pom.xml</code> 对所有工程进行打包</p>
<p>打包完成可在本地通过java -jar 运行jar包观察是否可以正常运行。</p>
<p>下边测试验证码服务：</p>
<p>进入验证码服务的target目录，cmd运行：</p>
<p><code>java -Dfile.encoding=utf-8 -jar xuecheng-plus-checkcode-0.0.1-SNAPSHOT.jar </code></p>
<p>如下图：</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228201732974.png" srcset="/img/loading.gif" lazyload alt="image-20231228201732974"></p>
<p>使用httpclient测试申请验证码：</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs clean">JavaScript<br>### 申请验证码<br>POST localhost:<span class="hljs-number">63075</span>/checkcode/pic<br><br></code></pre></td></tr></table></figure>

<h5 id="部署到Linux"><a href="#部署到Linux" class="headerlink" title="部署到Linux"></a><strong>部署到Linux</strong></h5><p>将打成的jar包拷贝到Linux，生成镜像，并创建容器。</p>
<p>1、编写Dockerfile文件</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">JavaScript<br><span class="hljs-keyword">FROM</span> java:<span class="hljs-number">8</span>u20<br><span class="hljs-keyword">MAINTAINER</span> docker_maven docker_maven@email.com<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /ROOT</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> xuecheng-plus-checkcode-0.0.1-SNAPSHOT.jar xuecheng-plus-checkcode.jar</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;java&quot;</span>, <span class="hljs-string">&quot;-version&quot;</span>]</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;java&quot;</span>, <span class="hljs-string">&quot;-Dfile.encoding=utf-8&quot;</span>,<span class="hljs-string">&quot;-jar&quot;</span>, <span class="hljs-string">&quot;xuecheng-plus-checkcode.jar&quot;</span>]</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">63075</span><br></code></pre></td></tr></table></figure>

<p>2、创建镜像</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">JavaScript</span><br><span class="hljs-attribute">docker</span> build -t checkcode:<span class="hljs-number">1</span>.<span class="hljs-number">0</span> .<br></code></pre></td></tr></table></figure>

<p>创建成功，查询镜像:</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228201836868.png" srcset="/img/loading.gif" lazyload alt="image-20231228201836868"></p>
<p>3、创建容器</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">JavaScript</span><br><span class="hljs-attribute">docker</span> run --name xuecheng-plus-checkcode -p <span class="hljs-number">63075</span>:<span class="hljs-number">63075</span> -idt checkcode:<span class="hljs-number">1</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>

<p>再次测试</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clean">JavaScript<br>### 申请验证码<br>POST <span class="hljs-number">192.168</span><span class="hljs-number">.101</span><span class="hljs-number">.65</span>:<span class="hljs-number">63075</span>/checkcode/pic<br></code></pre></td></tr></table></figure>

<h4 id="自动部署"><a href="#自动部署" class="headerlink" title="自动部署"></a><strong>自动部署</strong></h4><h5 id="实战流程"><a href="#实战流程" class="headerlink" title="实战流程"></a><strong>实战流程</strong></h5><p>下边使用jenkins实现CI&#x2F;CD的流程</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228201933732.png" srcset="/img/loading.gif" lazyload alt="image-20231228201933732"></p>
<ol>
<li>将代码使用Git托管</li>
<li>在jenkins创建任务，从Git拉取代码</li>
<li>拉取代码后进行自动构建：测试，打包，部署<ol>
<li>首先将代码打成镜像包上传到docker私服</li>
<li>自动创建容器，启动容器</li>
</ol>
</li>
<li>当有代码push到git实现自动构建</li>
</ol>
<h5 id="代码提交至Git"><a href="#代码提交至Git" class="headerlink" title="代码提交至Git"></a><strong>代码提交至Git</strong></h5><p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228202154560.png" srcset="/img/loading.gif" lazyload alt="image-20231228202154560"></p>
<h5 id="修改pom-xml文件"><a href="#修改pom-xml文件" class="headerlink" title="修改pom.xml文件"></a><strong>修改pom.xml文件</strong></h5><p>在pom.xml添加docker-maven-plugin插件实现将springboot工程创建镜像， 此pom.xml添加docker-maven-plugin插件用于生成镜像。</p>
<p>分别修改system-api、content-api、media-api、gateway、auth、checkcode服务的pom.xml文件。</p>
<p>插件的坐标如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.spotify<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>docker-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>修改pom.xml文件，以xuecheng-plus-checkcode为例，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">finalName</span>&gt;</span>$&#123;project.artifactId&#125;-$&#123;project.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">finalName</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>repackage<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.spotify<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>docker-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--修改imageName节点的内容，改为私有仓库地址和端口，再加上镜像id和 TAG,我们要直接传到私服--&gt;</span><br>                <span class="hljs-comment">&lt;!--配置最后生成的镜像名，docker images里的，我们这边取项目名:版本--&gt;</span><br>                <span class="hljs-comment">&lt;!--&lt;imageName&gt;$&#123;project.artifactId&#125;:$&#123;project.version&#125;&lt;/imageName&gt;--&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">imageName</span>&gt;</span>192.168.101.65:5000/$&#123;project.artifactId&#125;:$&#123;project.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">imageName</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--也可以通过以下方式定义image的tag信息。 --&gt;</span><br>                <span class="hljs-comment">&lt;!-- &lt;imageTags&gt;</span><br><span class="hljs-comment">                     &lt;imageTag&gt;$&#123;project.version&#125;&lt;/imageTag&gt;</span><br><span class="hljs-comment">                     &amp;lt;!&amp;ndash;build 时强制覆盖 tag，配合 imageTags 使用&amp;ndash;&amp;gt;</span><br><span class="hljs-comment">                     &lt;forceTags&gt;true&lt;/forceTags&gt;</span><br><span class="hljs-comment">                     &amp;lt;!&amp;ndash;build 完成后，push 指定 tag 的镜像，配合 imageTags 使用&amp;ndash;&amp;gt;</span><br><span class="hljs-comment">                     &lt;pushImageTag&gt;true&lt;/pushImageTag&gt;</span><br><span class="hljs-comment">                 &lt;/imageTags&gt;--&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">baseImage</span>&gt;</span>java:8u20<span class="hljs-tag">&lt;/<span class="hljs-name">baseImage</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">maintainer</span>&gt;</span>docker_maven docker_maven@email.com<span class="hljs-tag">&lt;/<span class="hljs-name">maintainer</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">workdir</span>&gt;</span>/root<span class="hljs-tag">&lt;/<span class="hljs-name">workdir</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">cmd</span>&gt;</span>[&quot;java&quot;, &quot;-version&quot;]<span class="hljs-tag">&lt;/<span class="hljs-name">cmd</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--来指明Dockerfile文件的所在目录，如果配置了dockerDirectory则忽略baseImage，maintainer等配置--&gt;</span><br>                <span class="hljs-comment">&lt;!--&lt;dockerDirectory&gt;./&lt;/dockerDirectory&gt;--&gt;</span><br>                <span class="hljs-comment">&lt;!--2375是docker的远程端口，插件生成镜像时连接docker，这里需要指定docker远程端口--&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">dockerHost</span>&gt;</span>http://192.168.101.65:2375<span class="hljs-tag">&lt;/<span class="hljs-name">dockerHost</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--入口点，project.build.finalName就是project标签下的build标签下 的filename标签内容，testDocker--&gt;</span><br>                <span class="hljs-comment">&lt;!--相当于启动容器后，会自动执行java -jar ...--&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">entryPoint</span>&gt;</span>[&quot;java&quot;, &quot;-Dfile.encoding=utf-8&quot;,&quot;-jar&quot;, &quot;/root/$&#123;project.build.finalName&#125;.jar&quot;]<span class="hljs-tag">&lt;/<span class="hljs-name">entryPoint</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--是否推送到docker私有仓库，旧版本插件要配置maven的settings文件。 --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">pushImage</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">pushImage</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">registryUrl</span>&gt;</span>192.168.101.65:5000<span class="hljs-tag">&lt;/<span class="hljs-name">registryUrl</span>&gt;</span>  <span class="hljs-comment">&lt;!-- 这里是复制 jar 包到 docker 容器指定目录配置 --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">targetPath</span>&gt;</span>/root<span class="hljs-tag">&lt;/<span class="hljs-name">targetPath</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>$&#123;project.build.directory&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br>                        <span class="hljs-comment">&lt;!--把哪个文件上传到docker，相当于Dockerfile里的add app.jar /--&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>$&#123;project.build.finalName&#125;.jar<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h5 id="自动构建测试"><a href="#自动构建测试" class="headerlink" title="自动构建测试"></a>自动构建测试</h5><p>找到jenkins_02任务，配置源码管理</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228203839170.png" srcset="/img/loading.gif" lazyload alt="image-20231228203839170"></p>
<p>配置完毕，开始构建</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228203901778.png" srcset="/img/loading.gif" lazyload alt="image-20231228203901778"></p>
<p>通过控制台输出日志观察构建情况 </p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228203911395.png" srcset="/img/loading.gif" lazyload alt="image-20231228203911395"></p>
<p>如果控制台有报错，根据错误信息进行调试。</p>
<p>部署成功后，进入服务器查看docker容器是否启动成功</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228203918090.png" srcset="/img/loading.gif" lazyload alt="image-20231228203918090"></p>
<h5 id="部署前端门户"><a href="#部署前端门户" class="headerlink" title="部署前端门户"></a>部署前端门户</h5><p>在虚拟机的docker中已经部署了nginx，修改nginx.conf的配置文件 </p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">JavaScript</span><br><br><span class="hljs-comment">#user  nobody;</span><br>worker_processes  <span class="hljs-number">1</span>;<br><br><span class="hljs-comment">#error_log  logs/error.log;</span><br><span class="hljs-comment">#error_log  logs/error.log  notice;</span><br><span class="hljs-comment">#error_log  logs/error.log  info;</span><br><br><span class="hljs-comment">#pid        logs/nginx.pid;</span><br><br><br><span class="hljs-section">events</span> &#123;<br>    <span class="hljs-attribute">worker_connections</span>  <span class="hljs-number">1024</span>;<br>&#125;<br><br><br><span class="hljs-section">http</span> &#123;<br>     <span class="hljs-attribute">server_names_hash_bucket_size</span> <span class="hljs-number">64</span>;<br>     <span class="hljs-attribute">client_max_body_size</span> <span class="hljs-number">100M</span>; <span class="hljs-comment"># 设置客户端请求体最大值</span><br>     <span class="hljs-attribute">client_body_buffer_size</span> <span class="hljs-number">128k</span>; <span class="hljs-comment"># 设置请求体缓存区大小</span><br>    <span class="hljs-attribute">include</span>       mime.types;<br>    <span class="hljs-attribute">default_type</span>  application/octet-stream;<br><br>    <span class="hljs-comment">#log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br>    <span class="hljs-comment">#                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br>    <span class="hljs-comment">#                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><br>    <span class="hljs-comment">#access_log  logs/access.log  main;</span><br><br>    <span class="hljs-attribute">sendfile</span>        <span class="hljs-literal">on</span>;<br>    <span class="hljs-comment">#tcp_nopush     on;</span><br><br>    <span class="hljs-comment">#keepalive_timeout  0;</span><br>    <span class="hljs-attribute">keepalive_timeout</span>  <span class="hljs-number">65</span>;<br>   <span class="hljs-comment">#文件服务</span><br>  <span class="hljs-section">upstream</span> fileserver&#123;<br>    <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.101.65:9000</span> weight=<span class="hljs-number">10</span>;<br>  &#125; <br>     <span class="hljs-comment">#后台网关</span><br>  <span class="hljs-section">upstream</span> gatewayserver&#123;<br>    <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.101.65:63010</span> weight=<span class="hljs-number">10</span>;<br>  &#125; <br>    <span class="hljs-comment">#gzip  on;</span><br><br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>        <span class="hljs-attribute">server_name</span>  www.51xuecheng.cn localhost;<br>        <span class="hljs-comment">#rewrite ^(.*) https://$server_name$1 permanent;</span><br>        <span class="hljs-comment">#charset koi8-r;</span><br>        <span class="hljs-attribute">ssi</span> <span class="hljs-literal">on</span>;<br>        <span class="hljs-attribute">ssi_silent_errors</span> <span class="hljs-literal">on</span>;<br>        <span class="hljs-comment">#access_log  logs/host.access.log  main;</span><br><br>        <span class="hljs-section">location</span> / &#123;<br>            <span class="hljs-attribute">alias</span>   /etc/nginx/html/;<br>            <span class="hljs-attribute">index</span>  index.html index.htm;<br>        &#125;<br>        <span class="hljs-comment">#api</span><br>        <span class="hljs-section">location</span> /api/ &#123;<br>                <span class="hljs-attribute">proxy_pass</span> http://gatewayserver/;<br>        &#125; <br>        <span class="hljs-comment">#静态资源</span><br>        <span class="hljs-section">location</span> /static/img/ &#123;  <br>                <span class="hljs-attribute">alias</span>  /etc/nginx/html/img/;<br>        &#125; <br>        <span class="hljs-section">location</span> /static/css/ &#123;  <br>                <span class="hljs-attribute">alias</span>   /etc/nginx/html/css/;<br>        &#125; <br>        <span class="hljs-section">location</span> /static/js/ &#123;  <br>                <span class="hljs-attribute">alias</span>   /etc/nginx/html/js/;<br>        &#125; <br>        <span class="hljs-section">location</span> /static/plugins/ &#123;  <br>                <span class="hljs-attribute">alias</span>   /etc/nginx/html/plugins/;<br>                <span class="hljs-attribute">add_header</span> Access-Control-Allow-Origin http://ucenter.51xuecheng.cn;  <br>                <span class="hljs-attribute">add_header</span> Access-Control-Allow-Credentials <span class="hljs-literal">true</span>;  <br>                <span class="hljs-attribute">add_header</span> Access-Control-Allow-Methods GET;<br>        &#125; <br>        <span class="hljs-section">location</span> /plugins/ &#123;  <br>                <span class="hljs-attribute">alias</span>   /etc/nginx/html/plugins/;<br>        &#125; <br>        <span class="hljs-section">location</span> /course/preview/learning.html &#123;<br>                <span class="hljs-attribute">alias</span> /etc/nginx/html/course/learning.html;<br>        &#125; <br>        <span class="hljs-section">location</span> /course/search.html &#123;  <br>                <span class="hljs-attribute">root</span>   /etc/nginx/html;<br>        &#125; <br>        <span class="hljs-section">location</span> /course/learning.html &#123;  <br>                <span class="hljs-attribute">root</span>   /etc/nginx/html;<br>        &#125; <br>        <span class="hljs-section">location</span> /course/ &#123;  <br>                <span class="hljs-attribute">proxy_pass</span> http://fileserver/mediafiles/course/;<br>        &#125; <br>        <span class="hljs-comment">#openapi</span><br>        <span class="hljs-section">location</span> /open/content/ &#123;<br>                <span class="hljs-attribute">proxy_pass</span> http://gatewayserver/content/open/;<br>        &#125; <br>        <span class="hljs-section">location</span> /open/media/ &#123;<br>                <span class="hljs-attribute">proxy_pass</span> http://gatewayserver/media/open/;<br>        &#125; <br><br>        <span class="hljs-comment">#error_page  404              /404.html;</span><br><br>        <span class="hljs-comment"># redirect server error pages to the static page /50x.html</span><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-attribute">error_page</span>   <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span>  /50x.html;<br>        <span class="hljs-section">location</span> = /50x.html &#123;<br>            <span class="hljs-attribute">root</span>   html;<br>        &#125;<br><br>        <span class="hljs-comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment">#location ~ \.php$ &#123;</span><br>        <span class="hljs-comment">#    proxy_pass   http://127.0.0.1;</span><br>        <span class="hljs-comment">#&#125;</span><br><br>        <span class="hljs-comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment">#location ~ \.php$ &#123;</span><br>        <span class="hljs-comment">#    root           html;</span><br>        <span class="hljs-comment">#    fastcgi_pass   127.0.0.1:9000;</span><br>        <span class="hljs-comment">#    fastcgi_index  index.php;</span><br>        <span class="hljs-comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br>        <span class="hljs-comment">#    include        fastcgi_params;</span><br>        <span class="hljs-comment">#&#125;</span><br><br>        <span class="hljs-comment"># deny access to .htaccess files, if Apache&#x27;s document root</span><br>        <span class="hljs-comment"># concurs with nginx&#x27;s one</span><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment">#location ~ /\.ht &#123;</span><br>        <span class="hljs-comment">#    deny  all;</span><br>        <span class="hljs-comment">#&#125;</span><br>    &#125;<br><br>   <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>        <span class="hljs-attribute">server_name</span>  file.51xuecheng.cn;<br>        <span class="hljs-comment">#charset koi8-r;</span><br>        <span class="hljs-attribute">ssi</span> <span class="hljs-literal">on</span>;<br>        <span class="hljs-attribute">ssi_silent_errors</span> <span class="hljs-literal">on</span>;<br>        <span class="hljs-comment">#access_log  logs/host.access.log  main;</span><br>        <span class="hljs-section">location</span> /video &#123;<br>            <span class="hljs-attribute">proxy_pass</span>   http://fileserver;<br>        &#125;<br><br>        <span class="hljs-section">location</span> /mediafiles &#123;<br>            <span class="hljs-attribute">proxy_pass</span>   http://fileserver;<br>        &#125;<br>   &#125;<br> <br>   <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>        <span class="hljs-attribute">server_name</span>  teacher.51xuecheng.cn;<br>        <span class="hljs-comment">#charset koi8-r;</span><br>        <span class="hljs-attribute">ssi</span> <span class="hljs-literal">on</span>;<br>        <span class="hljs-attribute">ssi_silent_errors</span> <span class="hljs-literal">on</span>;<br>        <span class="hljs-comment">#access_log  logs/host.access.log  main;</span><br>        <span class="hljs-section">location</span> / &#123;<br>            <span class="hljs-attribute">alias</span>   /etc/nginx/html/dist/;<br>            <span class="hljs-attribute">index</span>  index.html index.htm;<br>        &#125;<br>        <span class="hljs-comment">#location / &#123;</span><br>        <span class="hljs-comment">#    proxy_pass   http://uidevserver;</span><br>        <span class="hljs-comment">#&#125;</span><br><br>        <span class="hljs-section">location</span> /api/ &#123;<br>                <span class="hljs-attribute">proxy_pass</span> http://gatewayserver/;<br>        &#125; <br>        <br>        <br>   &#125;<br><br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>        <span class="hljs-attribute">server_name</span>  ucenter.51xuecheng.cn;<br>        <span class="hljs-comment">#charset koi8-r;</span><br>        <span class="hljs-attribute">ssi</span> <span class="hljs-literal">on</span>;<br>        <span class="hljs-attribute">ssi_silent_errors</span> <span class="hljs-literal">on</span>;<br>        <span class="hljs-comment">#access_log  logs/host.access.log  main;</span><br>        <span class="hljs-section">location</span> / &#123;<br>            <span class="hljs-attribute">alias</span>   /etc/nginx/html/ucenter/;<br>            <span class="hljs-attribute">index</span>  index.html index.htm;<br>        &#125;<br>        <span class="hljs-section">location</span> /include &#123;<br>            <span class="hljs-attribute">proxy_pass</span>   http://192.168.101.65;<br>        &#125;<br>        <span class="hljs-section">location</span> /img/ &#123;<br>            <span class="hljs-attribute">proxy_pass</span>   http://192.168.101.65/static/img/;<br>        &#125;<br>        <span class="hljs-section">location</span> /api/ &#123;<br>                <span class="hljs-attribute">proxy_pass</span> http://gatewayserver/;<br>        &#125; <br>   &#125;<br>    <span class="hljs-comment"># another virtual host using mix of IP-, name-, and port-based configuration</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment">#server &#123;</span><br>    <span class="hljs-comment">#    listen       8000;</span><br>    <span class="hljs-comment">#    listen       somename:8080;</span><br>    <span class="hljs-comment">#    server_name  somename  alias  another.alias;</span><br><br>    <span class="hljs-comment">#    location / &#123;</span><br>    <span class="hljs-comment">#        root   html;</span><br>    <span class="hljs-comment">#        index  index.html index.htm;</span><br>    <span class="hljs-comment">#    &#125;</span><br>    <span class="hljs-comment">#&#125;</span><br><br><br>    <span class="hljs-comment"># HTTPS server</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment">#server &#123;</span><br>    <span class="hljs-comment">#    listen       443 ssl;</span><br>    <span class="hljs-comment">#    server_name  localhost;</span><br><br>    <span class="hljs-comment">#    ssl_certificate      cert.pem;</span><br>    <span class="hljs-comment">#    ssl_certificate_key  cert.key;</span><br><br>    <span class="hljs-comment">#    ssl_session_cache    shared:SSL:1m;</span><br>    <span class="hljs-comment">#    ssl_session_timeout  5m;</span><br><br>    <span class="hljs-comment">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br>    <span class="hljs-comment">#    ssl_prefer_server_ciphers  on;</span><br><br>    <span class="hljs-comment">#    location / &#123;</span><br>    <span class="hljs-comment">#        root   html;</span><br>    <span class="hljs-comment">#        index  index.html index.htm;</span><br>    <span class="hljs-comment">#    &#125;</span><br>    <span class="hljs-comment">#&#125;</span><br><br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<p>将前端门户的静态页面拷贝到 &#x2F;data&#x2F;soft&#x2F;nginx&#x2F;xuecheng_portal_static</p>
<p>启动nginx容器：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">JavaScript<br>docker <span class="hljs-literal">start</span> nginx<br><br></code></pre></td></tr></table></figure>

<p>修改本机hosts文件：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">JavaScript</span><br><span class="hljs-attribute">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">101</span>.<span class="hljs-number">65</span>   www.<span class="hljs-number">51</span>xuecheng.cn <span class="hljs-number">51</span>xuecheng.cn ucenter.<span class="hljs-number">51</span>xuecheng.cn teacher.<span class="hljs-number">51</span>xuecheng.cn file.<span class="hljs-number">51</span>xuecheng.cn<br><br></code></pre></td></tr></table></figure>

<p>将本机的nginx服务停掉，访问<a target="_blank" rel="noopener" href="http://www.51xuecheng.cn./">www.51xuecheng.cn。</a></p>
<h5 id="部署机构端前端"><a href="#部署机构端前端" class="headerlink" title="部署机构端前端"></a>部署机构端前端</h5><p>将机构端的前端工程打包，运行yarn build</p>
<p>打包成功在工程目录生成dist目录</p>
<p>将此目录的内容拷贝到虚拟机的&#x2F;data&#x2F;soft&#x2F;nginx&#x2F;xuecheng_portal_static&#x2F;dist</p>
<h5 id="配置触发器"><a href="#配置触发器" class="headerlink" title="配置触发器"></a><strong>配置触发器</strong></h5><p>当向gogs提交代码时进行自动构建</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228204051305.png" srcset="/img/loading.gif" lazyload alt="image-20231228204051305"></p>
<p>在gogs配置钩子</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228204058658.png" srcset="/img/loading.gif" lazyload alt="image-20231228204058658"></p>
<p>推送地址设置jenkins的接口：</p>
<p><a target="_blank" rel="noopener" href="http://192.168.101.65:8888/gogs-webhook/?job=jenkins_02">http://192.168.101.65:8888/gogs-webhook/?job=jenkins_02</a></p>
<p>配置好可以测试一下：</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/image-20231228204113444.png" srcset="/img/loading.gif" lazyload alt="image-20231228204113444"></p>
<p>测试后观察jenkina是否重新构建任务。</p>
<p>提交代码测试：</p>
<p>修改代码提交到gogs，观察jenkins是否自动构建任务</p>
<h4 id="功能测试"><a href="#功能测试" class="headerlink" title="功能测试"></a><strong>功能测试</strong></h4><h5 id="测试认证功能"><a href="#测试认证功能" class="headerlink" title="测试认证功能"></a><strong>测试认证功能</strong></h5><p>部署成功后对功能进行测试。</p>
<p>1、首先测试认证功能</p>
<p>进入<a target="_blank" rel="noopener" href="http://www.51xuecheng.cn,点击登录,输入账号和密码进行登录./">www.51xuecheng.cn，点击登录，输入账号和密码进行登录。</a></p>
<p>账号和密码：t1&#x2F;111111</p>
<h5 id="测试内容管理"><a href="#测试内容管理" class="headerlink" title="测试内容管理"></a><strong>测试内容管理</strong></h5><p>1、测试课程列表</p>
<p>出现 Request failed with status code 503 错误</p>
<p>通过nacos排查，进入服务列表</p>
<p>缺少system-api</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/clip_image002.gif" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>排查system-api工程的bootstrap.yml配置文件、依赖包等内容。</p>
<p>修改代码后重新提交git</p>
<p>再次进行jenkins构建。</p>
<p>2、测试上传课程图片</p>
<p>首先测试修改课程，上传一个新图片。</p>
<p>3、测试课程发布</p>
<p>首先观察xxl-job调度中心是否成功注册执行器</p>
<p><img src="https://fgj2.oss-cn-beijing.aliyuncs.com/clip_image004.gif" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>启动课程发布任务</p>
<p>发布一门课程，观察content-api容器的日志</p>
<p>错误日志：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">JavaScript<br>java.io.FileNotFoundException: <span class="hljs-keyword">file</span>:<span class="hljs-regexp">/root/</span>xuecheng-<span class="hljs-keyword">plus</span>-content-api-<span class="hljs-number">0.0</span>.<span class="hljs-number">1</span>-SNAPSHOT.jar!<span class="hljs-regexp">/BOOT-INF/</span>classes!/templates does not exist.<br><br></code></pre></td></tr></table></figure>

<p>无法找到静态化的模板</p>
<p>屏蔽原来的方式，改如下方式</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">JavaScript<br><span class="hljs-string">//</span>            String classpath = this.getClass<span class="hljs-params">()</span><span class="hljs-string">.getResource</span><span class="hljs-params">(&quot;/&quot;)</span><span class="hljs-string">.getPath</span><span class="hljs-params">()</span>; <span class="hljs-string">//</span>打包jar无法获取模板<br><span class="hljs-string">//</span>            configuration.<span class="hljs-keyword">set</span>DirectoryForTemplateLoading<span class="hljs-params">(new File(classpath + &quot;/templates/&quot;)</span>);<br>        <span class="hljs-string">//</span>更改为如下方式<br>        configuration.<span class="hljs-keyword">set</span>TemplateLoader<span class="hljs-params">(new ClassTemplateLoader(this.getClass()</span><span class="hljs-string">.getClassLoader</span><span class="hljs-params">()</span>,<span class="hljs-string">&quot;/templates&quot;</span>));<br><br></code></pre></td></tr></table></figure>

<h5 id="测试媒资管理"><a href="#测试媒资管理" class="headerlink" title="测试媒资管理"></a><strong>测试媒资管理</strong></h5><p>1、配置ffmpeg的目录</p>
<p>将linux版本的ffmpeg拷贝到 &#x2F;data&#x2F;soft&#x2F;service 下，在nacos配置ffmpeg 的地址：</p>
<p>Ffmpeg linux版本下载地址：<a target="_blank" rel="noopener" href="https://johnvansickle.com/ffmpeg/">https://johnvansickle.com/ffmpeg/</a></p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dts">JavaScript<br><span class="hljs-symbol">videoprocess:</span><br><span class="hljs-symbol"> ffmpegpath:</span> <span class="hljs-keyword">/root/</span>soft/ffmpeg<br></code></pre></td></tr></table></figure>

<p>2、测试上传视频</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E9%A1%B9%E7%9B%AE/" class="category-chain-item">项目</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/" class="print-no-link">#学成在线</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>学成在线项目部署模块</div>
      <div>http://example.com/2023/12/28/学成在线项目部署模块/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>fgj</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年12月28日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/12/29/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96%E6%A8%A1%E5%9D%97/" title="学成在线项目优化模块">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">学成在线项目优化模块</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/12/28/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0%E6%A8%A1%E5%9D%97/" title="学成在线选课学习模块">
                        <span class="hidden-mobile">学成在线选课学习模块</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":173,"height":346},"mobile":{"show":true},"log":false});</script></body>
</html>
